<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="è¿™é‡Œæ˜¯ @Proconæ™®å…‰ çš„ä¸ªäººåšå®¢ï¼Œä¸ä½ ä¸€èµ·å‘ç°æ›´å¤§çš„ä¸–ç•Œ">
    <meta name="keywords" content="æ™®å…‰, Proconæ™®å…‰, åšå®¢, ä¸ªäººç½‘ç«™, äº’è”ç½‘, Java , åç«¯">
    <meta name="theme-color" content="#000000">

    <!-- Open Graph -->
    <meta property="og:title"
        content="pythonçˆ¬è™« - Procon's Tech Life Blog">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="Urllib
">
    
    <meta property="article:published_time" content=" 2020-04-06T12:00:00Z">
    
    
    <meta property="article:author" content="Procon">
    
    
    <meta property="article:tag" content="python">
    
    <meta property="article:tag" content="çˆ¬è™«">
    
    
    <meta property="og:image" content="https://blog.procon.cchttps://procon-note.oss-cn-guangzhou.aliyuncs.com/typora/avatar_m.jpg">
    <meta property="og:url" content="https://blog.procon.cc/2020/04/06/python%E7%88%AC%E8%99%AB/">
    <meta property="og:site_name" content="Procon's Tech Life Blog">

    <title>pythonçˆ¬è™« - Procon's Tech Life Blog</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://blog.procon.cc/2020/04/06/python%E7%88%AC%E8%99%AB/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href=" /css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href=" /css/hux-blog.min.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet"
        type="text/css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>

    <!-- Google AdSense -->
    <script data-ad-client="ca-pub-6487568398225121" async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->

<nav class="navbar navbar-default navbar-custom navbar-fixed-top invert">
    
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Procon's Tech Life Blog</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div id="huxblog_navbar">
                <div class="navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="/">Home</a>
                        </li>
                        
                        
                        
                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                        
                        
                        <li>
                            <a href="/archive/">Archive</a>
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <li class="search-icon">
                            <a href="javascript:void(0)">
                                <i class="fa fa-search"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <script>
        // Drop Bootstarp low-performance Navbar
        // Use customize navbar with high-quality material design animation
        // in high-perf jank-free CSS3 implementation
        var $body = document.body;
        var $toggle = document.querySelector('.navbar-toggle');
        var $navbar = document.querySelector('#huxblog_navbar');
        var $collapse = document.querySelector('.navbar-collapse');

        var __HuxNav__ = {
            close: function () {
                $navbar.className = " ";
                // wait until animation end.
                setTimeout(function () {
                    // prevent frequently toggle
                    if ($navbar.className.indexOf('in') < 0) {
                        $collapse.style.height = "0px"
                    }
                }, 400)
            },
            open: function () {
                $collapse.style.height = "auto"
                $navbar.className += " in";
            }
        }

        // Bind Event
        $toggle.addEventListener('click', function (e) {
            if ($navbar.className.indexOf('in') > 0) {
                __HuxNav__.close()
            } else {
                __HuxNav__.open()
            }
        })

        /**
         * Since Fastclick is used to delegate 'touchstart' globally
         * to hack 300ms delay in iOS by performing a fake 'click',
         * Using 'e.stopPropagation' to stop 'touchstart' event from 
         * $toggle/$collapse will break global delegation.
         * 
         * Instead, we use a 'e.target' filter to prevent handler
         * added to document close HuxNav.  
         *
         * Also, we use 'click' instead of 'touchstart' as compromise
         */
        document.addEventListener('click', function (e) {
            if (e.target == $toggle) return;
            if (e.target.className == 'icon-bar') return;
            __HuxNav__.close();
        })
    </script>
    <!-- Search -->
<div class="search-page">
  <div class="search-icon-close-container">
    <span class="search-icon-close">
      <i class="fa fa-chevron-down"></i>
    </span>
  </div>
  <div class="search-main container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <form></form>
        <input type="text" id="search-input" placeholder="$ grep...">
        </form>
        <div id="search-results" class="mini-post-list"></div>
      </div>
    </div>
  </div>
</div>

    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/home-bg-geek.jpg" width="0" height="0"> -->

<!-- Post Header -->



<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/home-bg-geek.jpg');
        background: ;
    }

    
</style>




<header class="intro-header style-text" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=python" title="python">python</a>
                        
                        <a class="tag" href="/archive/?tag=%E7%88%AC%E8%99%AB" title="çˆ¬è™«">çˆ¬è™«</a>
                        
                    </div>
                    <h1>pythonçˆ¬è™«</h1>
                    
                    <h2 class="subheading"></h2>
                    <span class="meta">Posted by Procon on April 6, 2020</span>
                </div>
            </div>
        </div>
    </div>
</header>







<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

				<h1 id="urllib">Urllib</h1>

<h2 id="1åçˆ¬æ‰‹æ®µ">1.åçˆ¬æ‰‹æ®µï¼Ÿ</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre>1.Userâ€Agentï¼š
	User Agentä¸­æ–‡åä¸ºç”¨æˆ·ä»£ç†ï¼Œç®€ç§° UAï¼Œå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ä¸²å¤´ï¼Œä½¿å¾—æœåŠ¡å™¨èƒ½å¤Ÿè¯†åˆ«å®¢æˆ·ä½¿ç”¨çš„æ“ä½œç³»ç»ŸåŠç‰ˆ
æœ¬ã€CPU ç±»å‹ã€æµè§ˆå™¨åŠç‰ˆæœ¬ã€æµè§ˆå™¨æ¸²æŸ“å¼•æ“ã€æµè§ˆå™¨è¯­è¨€ã€æµè§ˆå™¨æ’ä»¶ç­‰ã€‚

2.ä»£ç†IP
	è¥¿æ¬¡ä»£ç†
	å¿«ä»£ç†
	ä»€ä¹ˆæ˜¯é«˜åŒ¿åã€åŒ¿åå’Œé€æ˜ä»£ç†ï¼Ÿå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
		1.ä½¿ç”¨é€æ˜ä»£ç†ï¼Œå¯¹æ–¹æœåŠ¡å™¨å¯ä»¥çŸ¥é“ä½ ä½¿ç”¨äº†ä»£ç†ï¼Œå¹¶ä¸”ä¹ŸçŸ¥é“ä½ çš„çœŸå®IPã€‚
		2.ä½¿ç”¨åŒ¿åä»£ç†ï¼Œå¯¹æ–¹æœåŠ¡å™¨å¯ä»¥çŸ¥é“ä½ ä½¿ç”¨äº†ä»£ç†ï¼Œä½†ä¸çŸ¥é“ä½ çš„çœŸå®IPã€‚
		3.ä½¿ç”¨é«˜åŒ¿åä»£ç†ï¼Œå¯¹æ–¹æœåŠ¡å™¨ä¸çŸ¥é“ä½ ä½¿ç”¨äº†ä»£ç†ï¼Œæ›´ä¸çŸ¥é“ä½ çš„çœŸå®IPã€‚
3.éªŒè¯ç è®¿é—®
	æ‰“ç å¹³å°
	äº‘æ‰“ç å¹³å°
	è¶…çº§ğŸ¦…
4.åŠ¨æ€åŠ è½½ç½‘é¡µ ç½‘ç«™è¿”å›çš„æ˜¯jsæ•°æ® å¹¶ä¸æ˜¯ç½‘é¡µçš„çœŸå®æ•°æ®
	seleniumé©±åŠ¨çœŸå®çš„æµè§ˆå™¨å‘é€è¯·æ±‚
5.æ•°æ®åŠ å¯†
	åˆ†æjsä»£ç 
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="2urllibåº“ä½¿ç”¨">2.urllibåº“ä½¿ç”¨</h2>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">urlopen</span><span class="p">()</span> <span class="n">æ¨¡æ‹Ÿæµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚</span>
<span class="n">response</span> <span class="n">æœåŠ¡å™¨è¿”å›çš„æ•°æ®</span>
	<span class="n">responseçš„æ•°æ®ç±»å‹æ˜¯HttpResponse</span>
	<span class="n">å­—èŠ‚</span><span class="err">â€â€</span><span class="o">&gt;</span><span class="n">å­—ç¬¦ä¸²</span>
		<span class="n">è§£ç decode</span>
	<span class="n">å­—ç¬¦ä¸²</span><span class="err">â€â€</span><span class="o">&gt;</span><span class="n">å­—èŠ‚</span>
		<span class="n">ç¼–ç encode</span>
	<span class="nf">read</span><span class="p">()</span> <span class="n">å­—èŠ‚å½¢å¼è¯»å–äºŒè¿›åˆ¶</span> <span class="n">æ‰©å±•</span><span class="err">ï¼š</span><span class="nf">rede</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="n">è¿”å›å‰å‡ ä¸ªå­—èŠ‚</span>
	<span class="nf">readline</span><span class="p">()</span> <span class="n">è¯»å–ä¸€è¡Œ</span>
	<span class="nf">readlines</span><span class="p">()</span> <span class="n">ä¸€è¡Œä¸€è¡Œè¯»å–</span> <span class="n">ç›´è‡³ç»“æŸ</span>
	<span class="nf">getcode</span><span class="p">()</span> <span class="n">è·å–çŠ¶æ€ç </span>
	<span class="nf">geturl</span><span class="p">()</span> <span class="n">è·å–url</span>
	<span class="nf">getheaders</span><span class="p">()</span> <span class="n">è·å–headers</span>
	<span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">urlretrieve</span><span class="p">()</span>
		<span class="n">è¯·æ±‚ç½‘é¡µ</span>
		<span class="n">è¯·æ±‚å›¾ç‰‡</span>
		<span class="n">è¯·æ±‚è§†é¢‘</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="3è¯·æ±‚å¯¹è±¡çš„å®šåˆ¶">3.è¯·æ±‚å¯¹è±¡çš„å®šåˆ¶</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>UAä»‹ç»ï¼šUser Agentä¸­æ–‡åä¸ºç”¨æˆ·ä»£ç†ï¼Œç®€ç§° UAï¼Œå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ä¸²å¤´ï¼Œä½¿å¾—æœåŠ¡å™¨èƒ½å¤Ÿè¯†åˆ«å®¢æˆ·ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿ
åŠç‰ˆæœ¬ã€CPU ç±»å‹ã€æµè§ˆå™¨åŠç‰ˆæœ¬ã€‚æµè§ˆå™¨å†…æ ¸ã€æµè§ˆå™¨æ¸²æŸ“å¼•æ“ã€æµè§ˆå™¨è¯­è¨€ã€æµè§ˆå™¨æ’ä»¶ç­‰

è¯­æ³•ï¼šrequest = urllib.request.Request()
</pre></td></tr></tbody></table></code></pre></div></div>

<p>æ‰©å±•ï¼šç¼–ç çš„ç”±æ¥</p>

<h2 id="4ç¼–è§£ç ">4.ç¼–è§£ç </h2>

<p>1.getè¯·æ±‚æ–¹å¼ï¼šurllib.parse.quoteï¼ˆï¼‰</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">urllib.request</span>
<span class="kn">import</span> <span class="n">urllib.parse</span>

<span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">https://www.baidu.com/s?wd=</span><span class="sh">'</span>

<span class="c1"># urlçš„ç»„æˆ
# https://www.baidu.com/s?wd=å‘¨æ°ä¼¦
</span>
<span class="c1"># http/https    www.baidu.com   80/443     s      wd = å‘¨æ°ä¼¦     #
#    åè®®             ä¸»æœº        ç«¯å£å·     è·¯å¾„     å‚æ•°           é”šç‚¹
# http   80
# https  443
# mysql  3306
# oracle 1521
# redis  6379
# mongodb 27017
</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) </span><span class="sh">'</span>
                  <span class="sh">'</span><span class="s">Chrome/111.0.0.0 Safari/537.36 Edg/111.0.1661.51</span><span class="sh">'</span>
<span class="p">}</span>

<span class="c1"># å› ä¸ºurlopenæ–¹æ³•ä¸­ä¸èƒ½å­˜å‚¨å­—å…¸ æ‰€ä»¥headersä¸èƒ½ä¼ é€’è¿›å»
# è¯·æ±‚å¯¹è±¡çš„å®šåˆ¶
</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="nf">quote</span><span class="p">(</span><span class="sh">'</span><span class="s">æ€§äº¤</span><span class="sh">'</span><span class="p">)</span>

<span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

<span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf8</span><span class="sh">'</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>2.getè¯·æ±‚æ–¹å¼ï¼šurllib.parse.urlencodeï¼ˆï¼‰</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre>    <span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">https://www.baidu.com/s?</span><span class="sh">'</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">å°åˆš</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">sex</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">ç”·</span><span class="sh">'</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) </span><span class="sh">'</span>
                      <span class="sh">'</span><span class="s">Chrome/111.0.0.0 Safari/537.36 Edg/111.0.1661.51</span><span class="sh">'</span>
    <span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="nf">urlencode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="n">data</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf8</span><span class="sh">'</span><span class="p">)</span>

    <span class="nf">print</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>3.postè¯·æ±‚æ–¹å¼</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">urllib.parse</span>

<span class="kn">import</span> <span class="n">urllib.request</span>

<span class="kn">import</span> <span class="n">json</span>

<span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">https://fanyi.baidu.com/v2transapi?from=en&amp;to=zh</span><span class="sh">'</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) </span><span class="sh">'</span>
                  <span class="sh">'</span><span class="s">Chrome/111.0.0.0 Safari/537.36 Edg/111.0.1661.51</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">Cookie</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">BIDUPSID=DF9744CD34BAE05BB8671D82A507C548; PSTM=1678365929; newlogin=1; BDUSS=VhwWk9qV2ZtRzFmYndLRHBEMHJ0YlZpRWhkMDZKM295aEJYSTdISUY0Y1RaekZrSVFBQUFBJCQAAAAAAAAAAAEAAADdrDBA2K-7qML6wqXs4bniueIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABPaCWQT2glkM; BDUSS_BFESS=VhwWk9qV2ZtRzFmYndLRHBEMHJ0YlZpRWhkMDZKM295aEJYSTdISUY0Y1RaekZrSVFBQUFBJCQAAAAAAAAAAAEAAADdrDBA2K-7qML6wqXs4bniueIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABPaCWQT2glkM; BAIDUID=DF9744CD34BAE05BA1B7B38C3A014179:SL=0:NR=10:FG=1; BDORZ=B490B5EBF6F3CD402E515D22BCDA1598; BA_HECTOR=ak0h24a4240k212l2l2l858t1i1vf1q1m; ZFY=vprJv3LpLohE:BtuLaK:BL6qr1eZ3UZy27q1f4CAIHDeg:C; BAIDUID_BFESS=DF9744CD34BAE05BA1B7B38C3A014179:SL=0:NR=10:FG=1; BDRCVFR[feWj1Vr5u3D]=I67x6TjHwwYf0; PSINO=3; delPer=0; H_PS_PSSID=38185_36543_38410_38368_38403_37862_38468_38170_38290_38250_37924_38382_38040_26350_38418_38282_37881; APPGUIDE_10_0_2=1; REALTIME_TRANS_SWITCH=1; FANYI_WORD_SWITCH=1; HISTORY_SWITCH=1; SOUND_SPD_SWITCH=1; SOUND_PREFER_SWITCH=1; ab_sr=1.0.1_NDAzMGYwMzU3MTViM2Q4ODFiZWEyMzMyNWI1ZmVhOTI1ODEzMmI1MjEyMTVkYTJlZDQzNmM3MWRkMGIwNDUzNmQzMjljNmZiMTEwMmU4OTU1OTQ1Zjg0NWU2ZTU4NzQ2NzU2ZTkwNTNhMDY0NGZkNTA4ZjY4MDgxY2Y2YjRmMGQxZDYxMmMwOTY4YjliOTM4OGQwZDliZmY5OTU4NzBlOGQ1OGUyMDZiNWI1MGE3NWJmM2FiMDkwYzI0YTkwZTZi</span><span class="sh">'</span>
<span class="p">}</span>
<span class="n">keyword</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">è¯·è¾“å…¥è¦æŸ¥è¯¢çš„å•è¯ï¼š</span><span class="sh">"</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">from</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">zh</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">to</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">en</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">query</span><span class="sh">'</span><span class="p">:</span> <span class="n">keyword</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">transtype</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">translang</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">simple_means_flag</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">3</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">sign</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">569746.807587</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">token</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">03b7d79aace86efda4176a7e8edef1a1</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">domain</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">common</span><span class="sh">'</span>
<span class="p">}</span>
<span class="c1"># postè¯·æ±‚çš„å‚æ•°  å¿…é¡»è¿›è¡Œç¼–ç  å¹¶ä¸”è¦è°ƒç”¨encodeæ–¹æ³•
</span><span class="n">data</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="nf">urlencode</span><span class="p">(</span><span class="n">data</span><span class="p">).</span><span class="nf">encode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span>
<span class="c1"># è¯·æ±‚å¯¹è±¡çš„å®šåˆ¶
</span><span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

<span class="c1"># æ¨¡æ‹Ÿæµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚
</span><span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="c1"># è·å–å“åº”çš„æ•°æ®
</span><span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>æ€»ç»“ï¼špostå’ŒgetåŒºåˆ«ï¼Ÿ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>1ï¼šgetè¯·æ±‚æ–¹å¼çš„å‚æ•°å¿…é¡»ç¼–ç ï¼Œå‚æ•°æ˜¯æ‹¼æ¥åˆ°urlåé¢ï¼Œç¼–ç ä¹‹åä¸éœ€è¦è°ƒç”¨encodeæ–¹æ³•
2ï¼špostè¯·æ±‚æ–¹å¼çš„å‚æ•°å¿…é¡»ç¼–ç ï¼Œå‚æ•°æ˜¯æ”¾åœ¨è¯·æ±‚å¯¹è±¡å®šåˆ¶çš„æ–¹æ³•ä¸­ï¼Œç¼–ç ä¹‹åéœ€è¦è°ƒç”¨encodeæ–¹æ³•
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="5ajaxçš„getè¯·æ±‚">5.ajaxçš„getè¯·æ±‚</h2>

<p>æ¡ˆä¾‹ï¼šè±†ç“£ç”µå½±</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
</pre></td><td class="rouge-code"><pre><span class="c1"># https://movie.douban.com/j/chart/top_list?type=5&amp;interval_id=100%3A90&amp;action=&amp;
# start=0&amp;limit=20
</span>
<span class="c1"># https://movie.douban.com/j/chart/top_list?type=5&amp;interval_id=100%3A90&amp;action=&amp;
# start=20&amp;limit=20
</span>
<span class="c1"># https://movie.douban.com/j/chart/top_list?type=5&amp;interval_id=100%3A90&amp;action=&amp;
# start=40&amp;limit=20
</span>
<span class="c1"># https://movie.douban.com/j/chart/top_list?type=5&amp;interval_id=100%3A90&amp;action=&amp;
# start=60&amp;limit=20
</span>
<span class="c1"># page    1  2   3   4
# start   0  20  40  60
</span>
<span class="c1"># start ï¼ˆpage - 1ï¼‰*20
</span>

<span class="c1"># ä¸‹è½½è±†ç“£ç”µå½±å‰10é¡µçš„æ•°æ®
# ï¼ˆ1ï¼‰ è¯·æ±‚å¯¹è±¡çš„å®šåˆ¶
# ï¼ˆ2ï¼‰ è·å–å“åº”çš„æ•°æ®
# ï¼ˆ3ï¼‰ ä¸‹è½½æ•°æ®
</span>
<span class="kn">import</span> <span class="n">urllib.parse</span>
<span class="kn">import</span> <span class="n">urllib.request</span>


<span class="k">def</span> <span class="nf">create_request</span><span class="p">(</span><span class="n">page_no</span><span class="p">):</span>
    <span class="n">base_url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">https://movie.douban.com/j/chart/top_list?type=5&amp;interval_id=100%3A90&amp;action=&amp;</span><span class="sh">'</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">start</span><span class="sh">'</span><span class="p">:</span> <span class="p">(</span><span class="n">page_no</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">20</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">limit</span><span class="sh">'</span><span class="p">:</span> <span class="mi">20</span>
    <span class="p">}</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="nf">urlencode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">base_url</span> <span class="o">+</span> <span class="n">data</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) </span><span class="sh">'</span>
                      <span class="sh">'</span><span class="s">Chrome/92.0.4515.159 Safari/537.36</span><span class="sh">'</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_content</span><span class="p">(</span><span class="n">request_obj</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">urlopen</span><span class="p">(</span><span class="n">request_obj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">down_load</span><span class="p">(</span><span class="n">page_no</span><span class="p">,</span> <span class="n">res_content</span><span class="p">):</span>
    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">douban_</span><span class="sh">'</span> <span class="o">+</span> <span class="nf">str</span><span class="p">(</span><span class="n">page_no</span><span class="p">)</span> <span class="o">+</span> <span class="sh">'</span><span class="s">.json</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">fp</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">res_content</span><span class="p">)</span>


<span class="c1"># ç¨‹åºçš„å…¥å£
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="n">start_page</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">input</span><span class="p">(</span><span class="sh">'</span><span class="s">è¯·è¾“å…¥èµ·å§‹çš„é¡µç </span><span class="sh">'</span><span class="p">))</span>
    <span class="n">end_page</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">input</span><span class="p">(</span><span class="sh">'</span><span class="s">è¯·è¾“å…¥ç»“æŸçš„é¡µé¢</span><span class="sh">'</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">start_page</span><span class="p">,</span> <span class="n">end_page</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1">#         æ¯ä¸€é¡µéƒ½æœ‰è‡ªå·±çš„è¯·æ±‚å¯¹è±¡çš„å®šåˆ¶
</span>        <span class="n">request</span> <span class="o">=</span> <span class="nf">create_request</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
        <span class="c1">#         è·å–å“åº”çš„æ•°æ®
</span>        <span class="n">content</span> <span class="o">=</span> <span class="nf">get_content</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="c1">#         ä¸‹è½½
</span>        <span class="nf">down_load</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="6ajaxçš„postè¯·æ±‚">6.ajaxçš„postè¯·æ±‚</h2>

<p>æ¡ˆä¾‹ï¼šKFCå®˜ç½‘</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
</pre></td><td class="rouge-code"><pre><span class="c1"># 1é¡µ
# http://www.kfc.com.cn/kfccda/ashx/GetStoreList.ashx?op=cname
# post
# cname: åŒ—äº¬
# pid:
# pageIndex: 1
# pageSize: 10
</span>

<span class="c1"># 2é¡µ
# http://www.kfc.com.cn/kfccda/ashx/GetStoreList.ashx?op=cname
# post
# cname: åŒ—äº¬
# pid:
# pageIndex: 2
# pageSize: 10
</span>
<span class="kn">import</span> <span class="n">urllib.request</span>
<span class="kn">import</span> <span class="n">urllib.parse</span>


<span class="k">def</span> <span class="nf">create_request</span><span class="p">(</span><span class="n">page</span><span class="p">):</span>
    <span class="n">base_url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">http://www.kfc.com.cn/kfccda/ashx/GetStoreList.ashx?op=cname</span><span class="sh">'</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">cname</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">åŒ—äº¬</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">pid</span><span class="sh">'</span><span class="p">:</span> <span class="sh">''</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">pageIndex</span><span class="sh">'</span><span class="p">:</span> <span class="n">page</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">pageSize</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">10</span><span class="sh">'</span>
    <span class="p">}</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="nf">urlencode</span><span class="p">(</span><span class="n">data</span><span class="p">).</span><span class="nf">encode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) </span><span class="sh">'</span>
                      <span class="sh">'</span><span class="s">Chrome/92.0.4515.159 Safari/537.36</span><span class="sh">'</span>
    <span class="p">}</span>

    <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">base_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">request</span>


<span class="k">def</span> <span class="nf">get_content</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">content</span>


<span class="k">def</span> <span class="nf">down_load</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">kfc_</span><span class="sh">'</span> <span class="o">+</span> <span class="nf">str</span><span class="p">(</span><span class="n">page</span><span class="p">)</span> <span class="o">+</span> <span class="sh">'</span><span class="s">.json</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">fp</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="n">start_page</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">input</span><span class="p">(</span><span class="sh">'</span><span class="s">è¯·è¾“å…¥èµ·å§‹é¡µç </span><span class="sh">'</span><span class="p">))</span>
    <span class="n">end_page</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">input</span><span class="p">(</span><span class="sh">'</span><span class="s">è¯·è¾“å…¥ç»“æŸé¡µç </span><span class="sh">'</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">start_page</span><span class="p">,</span> <span class="n">end_page</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># è¯·æ±‚å¯¹è±¡çš„å®šåˆ¶
</span>        <span class="n">request</span> <span class="o">=</span> <span class="nf">create_request</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
        <span class="c1"># è·å–ç½‘é¡µæºç 
</span>        <span class="n">content</span> <span class="o">=</span> <span class="nf">get_content</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="c1"># ä¸‹è½½
</span>        <span class="nf">down_load</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="7urlerrorhttperror">7.URLError\HTTPError</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>ç®€ä»‹:
	1.HTTPErrorç±»æ˜¯URLErrorç±»çš„å­ç±»
	2.å¯¼å…¥çš„åŒ…urllib.error.HTTPError urllib.error.URLError
	3.httpé”™è¯¯ï¼šhttpé”™è¯¯æ˜¯é’ˆå¯¹æµè§ˆå™¨æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨è€Œå¢åŠ å‡ºæ¥çš„é”™è¯¯æç¤ºã€‚å¼•å¯¼å¹¶å‘Šè¯‰æµè§ˆè€…è¯¥é¡µæ˜¯å“ªé‡Œå‡º
äº†é—®é¢˜ã€‚
	4.é€šè¿‡urllibå‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½ä¼šå‘é€å¤±è´¥ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæƒ³è®©ä½ çš„ä»£ç æ›´åŠ çš„å¥å£®ï¼Œå¯ä»¥é€šè¿‡tryexcept
è¿›è¡Œæ•è·å¼‚å¸¸ï¼Œå¼‚å¸¸æœ‰ä¸¤ç±»ï¼ŒURLError\HTTPError
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">urllib.request</span>
<span class="kn">import</span> <span class="n">urllib.error</span>
<span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">https://blog.csdn.net/ityard/article/details/102646738</span><span class="sh">'</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) </span><span class="sh">'</span>
                  <span class="sh">'</span><span class="s">Chrome/111.0.0.0 Safari/537.36 Edg/111.0.1661.51</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">Cookie</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">uuid_tt_dd=10_30844396170-1678371350421-410462; c_adb=1; UserName=Solo_guanggaung; </span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">UserInfo=85bbd718ef3c428485beae0a3c34d10f; UserToken=85bbd718ef3c428485beae0a3c34d10f; </span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">UserNick=%E9%9A%90%E8%BA%AB%E6%89%8D%E6%98%AF%E6%9C%AC%E4%BD%93; AU=434; UN=Solo_guanggaung; </span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">BT=1678376092017; p_uid=U010000; </span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">Hm_up_6bcd52f51e9b3dce32bec4a3997715ac=%7B%22islogin%22%3A%7B%22value%22%3A%221%22%2C%22scope%22%3A1</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">%7D%2C%22isonline%22%3A%7B%22value%22%3A%221%22%2C%22scope%22%3A1%7D%2C%22isvip%22%3A%7B%22value%22%3A</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">%220%22%2C%22scope%22%3A1%7D%2C%22uid_%22%3A%7B%22value%22%3A%22Solo_guanggaung%22%2C%22scope%22%3A1</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">%7D%7D; firstDie=1; Hm_lvt_6bcd52f51e9b3dce32bec4a3997715ac=1678428902,1678886386,1679568376,</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">1679798814; Hm_ct_6bcd52f51e9b3dce32bec4a3997715ac=6525*1*10_30844396170-1678371350421-410462!5744*1</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">*Solo_guanggaung; c_segment=14; dc_sid=5a571b950c4ab749f0ca7cb220c9e13f; </span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">dc_session_id=10_1679815417602.564103; c_first_ref=www.google.com; </span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">c_first_page=https%3A//www.csdn.net/; c_dsid=11_1679817036063.303856; log_Id_view=249; </span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">log_Id_click=26; ssxmod_itna=Qqfx0iwxBDgD2Dl4iwlxjxCTkZRI+KDOI+e53sDBMhY4iNDnD8x7YDv+IvFQQ</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">=e17rKa5Keg2Yqj7jQEApqlA8EXPrDCPGnDB9DrV+DYAkDt4DTD34DYDixibCxi5GRD0KDFF5XUZ9Dm4GW9qDgn4GgDCiD0</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">+Uc3wiD4qDB+rdDKM0cDGY6YmUdpkG=sBhcD0UqxBd4WcGcICcF=iX=56nDaEQDzkHDtut5wMbDC2=/UdiTIiPb+05rU+DFmRhoDg</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">+bUFmTK7hPlKoGFYkr/DQolo1DGSxqmD1xD; </span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">ssxmod_itna2=Qqfx0iwxBDgD2Dl4iwlxjxCTkZRI+KDOI+e5ID8dZ+BxGXdPGazKFIHUuzx8gOIhOqzolyisDNblBrrov1Cxnz</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">+IZjoi+Kx+PAiXxvrGfcoWxbUEaI3MFQSMjYvsId1yBPyttRM0tbA6SqIM4TYDuM4nfxUwtkUvUk2DX+roMqRljLXxN</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">+RX8lUEQnrGbWj0ffIE88G8B2YL0GrNGTdqDnfOHeQdrj23qMc54M=GdjKVW9BGN1I7O9vHuAK=TPU1hbLkVagxN1kv2K7QqVAwpK7</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">/bX1ra/SuqcCXqsZUNl1yTKYtpdW/aNXOpFP3VENxzicefA6Nrm4DQ94U0q80dzGiUGxebqIitAAPsDinY5ZBqF0eD08DiQqYD===; </span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">csrfToken=bHS_4PaJf46yWMg799xXxgUb; c_pref=https%3A//www.google.com/; c_ref=https%3A//www.csdn.net/; </span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">c_page_id=default; dc_tos=rs4b4l; log_Id_pv=53</span><span class="sh">'</span>
<span class="p">}</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utfâ€8</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
<span class="k">except</span> <span class="n">urllib</span><span class="p">.</span><span class="n">error</span><span class="p">.</span><span class="n">HTTPError</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="mi">1111</span><span class="p">)</span>
<span class="k">except</span> <span class="n">urllib</span><span class="p">.</span><span class="n">error</span><span class="p">.</span><span class="n">URLError</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="mi">22222</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="8handlerå¤„ç†å™¨">8.Handlerå¤„ç†å™¨</h2>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre> <span class="n">ä¸ºä»€ä¹ˆè¦å­¦ä¹ handler</span><span class="err">ï¼Ÿ</span>
 	<span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
 		<span class="n">ä¸èƒ½å®šåˆ¶è¯·æ±‚å¤´</span>
 	<span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">headers</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
 		<span class="n">å¯ä»¥å®šåˆ¶è¯·æ±‚å¤´</span>
 	<span class="n">Handler</span>
 		<span class="n">å®šåˆ¶æ›´é«˜çº§çš„è¯·æ±‚å¤´</span><span class="err">ï¼ˆ</span><span class="n">éšç€ä¸šåŠ¡é€»è¾‘çš„å¤æ‚</span> <span class="n">è¯·æ±‚å¯¹è±¡çš„å®šåˆ¶å·²ç»æ»¡è¶³ä¸äº†æˆ‘ä»¬çš„éœ€æ±‚</span><span class="err">ï¼ˆ</span><span class="n">åŠ¨æ€cookieå’Œä»£ç†</span>
 <span class="n">ä¸èƒ½ä½¿ç”¨è¯·æ±‚å¯¹è±¡çš„å®šåˆ¶</span><span class="err">ï¼‰</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre>

<span class="c1"># éœ€æ±‚ ä½¿ç”¨handleræ¥è®¿é—®ç™¾åº¦  è·å–ç½‘é¡µæºç 
</span>
<span class="kn">import</span> <span class="n">urllib.request</span>

<span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">http://www.baidu.com</span><span class="sh">'</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36</span><span class="sh">'</span>
<span class="p">}</span>

<span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">Request</span><span class="p">(</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">,</span><span class="n">headers</span> <span class="o">=</span> <span class="n">headers</span><span class="p">)</span>

<span class="c1"># handler   build_opener  open
</span>
<span class="c1"># ï¼ˆ1ï¼‰è·å–hanlderå¯¹è±¡
</span><span class="n">handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">HTTPHandler</span><span class="p">()</span>

<span class="c1"># ï¼ˆ2ï¼‰è·å–openerå¯¹è±¡
</span><span class="n">opener</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">build_opener</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

<span class="c1"># (3) è°ƒç”¨openæ–¹æ³•
</span><span class="n">response</span> <span class="o">=</span> <span class="n">opener</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

<span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="9ä»£ç†æœåŠ¡å™¨">9.ä»£ç†æœåŠ¡å™¨</h2>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="mf">1.</span><span class="n">ä»£ç†çš„å¸¸ç”¨åŠŸèƒ½</span><span class="err">?</span>
	<span class="mf">1.</span><span class="n">çªç ´è‡ªèº«IPè®¿é—®é™åˆ¶</span><span class="err">ï¼Œ</span><span class="n">è®¿é—®å›½å¤–ç«™ç‚¹</span><span class="err">ã€‚</span>
	<span class="mf">2.</span><span class="n">è®¿é—®ä¸€äº›å•ä½æˆ–å›¢ä½“å†…éƒ¨èµ„æº</span>
		<span class="n">æ‰©å±•</span><span class="err">ï¼š</span><span class="n">æŸå¤§å­¦FTP</span><span class="p">(</span><span class="n">å‰ææ˜¯è¯¥ä»£ç†åœ°å€åœ¨è¯¥èµ„æºçš„å…è®¸è®¿é—®èŒƒå›´ä¹‹å†…</span><span class="p">)</span><span class="err">ï¼Œ</span><span class="n">ä½¿ç”¨æ•™è‚²ç½‘å†…åœ°å€æ®µå…è´¹ä»£ç†æœåŠ¡å™¨</span><span class="err">ï¼Œ</span><span class="n">å°±å¯ä»¥ç”¨äºå¯¹æ•™è‚²ç½‘å¼€æ”¾çš„å„ç±»FTPä¸‹è½½ä¸Šä¼ </span><span class="err">ï¼Œ</span><span class="n">ä»¥åŠå„ç±»èµ„æ–™æŸ¥è¯¢å…±äº«ç­‰æœåŠ¡</span><span class="err">ã€‚</span>
	<span class="mf">3.</span><span class="n">æé«˜è®¿é—®é€Ÿåº¦</span>
		<span class="n">æ‰©å±•</span><span class="err">ï¼š</span><span class="n">é€šå¸¸ä»£ç†æœåŠ¡å™¨éƒ½è®¾ç½®ä¸€ä¸ªè¾ƒå¤§çš„ç¡¬ç›˜ç¼“å†²åŒº</span><span class="err">ï¼Œ</span><span class="n">å½“æœ‰å¤–ç•Œçš„ä¿¡æ¯é€šè¿‡æ—¶</span><span class="err">ï¼Œ</span><span class="n">åŒæ—¶ä¹Ÿå°†å…¶ä¿å­˜åˆ°ç¼“å†²åŒºä¸­</span><span class="err">ï¼Œ</span><span class="n">å½“å…¶ä»–ç”¨æˆ·å†è®¿é—®ç›¸åŒçš„ä¿¡æ¯æ—¶</span><span class="err">ï¼Œ</span> <span class="n">åˆ™ç›´æ¥ç”±ç¼“å†²åŒºä¸­å–å‡ºä¿¡æ¯</span><span class="err">ï¼Œ</span><span class="n">ä¼ ç»™ç”¨æˆ·</span><span class="err">ï¼Œ</span><span class="n">ä»¥æé«˜è®¿é—®é€Ÿåº¦</span><span class="err">ã€‚</span>
	<span class="mf">4.</span><span class="n">éšè—çœŸå®IP</span>
		<span class="n">æ‰©å±•</span><span class="err">ï¼š</span><span class="n">ä¸Šç½‘è€…ä¹Ÿå¯ä»¥é€šè¿‡è¿™ç§æ–¹æ³•éšè—è‡ªå·±çš„IP</span><span class="err">ï¼Œ</span><span class="n">å…å—æ”»å‡»</span><span class="err">ã€‚</span>
<span class="mf">2.</span><span class="n">ä»£ç é…ç½®ä»£ç†</span>
	<span class="n">åˆ›å»ºReuqestå¯¹è±¡</span>
	<span class="n">åˆ›å»ºProxyHandlerå¯¹è±¡</span>
	<span class="n">ç”¨handlerå¯¹è±¡åˆ›å»ºopenerå¯¹è±¡</span>
	<span class="n">ä½¿ç”¨opener</span><span class="p">.</span><span class="n">openå‡½æ•°å‘é€è¯·æ±‚æ±‚</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">urllib.request</span>

<span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">http://www.baidu.com/s?wd=ip</span><span class="sh">'</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36</span><span class="sh">'</span>
<span class="p">}</span>

<span class="c1"># è¯·æ±‚å¯¹è±¡çš„å®šåˆ¶
</span><span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">Request</span><span class="p">(</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span> <span class="n">headers</span><span class="p">)</span>

<span class="c1"># æ¨¡æ‹Ÿæµè§ˆå™¨è®¿é—®æœåŠ¡å™¨
# response = urllib.request.urlopen(request)
</span>
<span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">http</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">118.24.219.151:16817</span><span class="sh">'</span>
<span class="p">}</span>
<span class="c1"># handler  build_opener  open
</span><span class="n">handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">ProxyHandler</span><span class="p">(</span><span class="n">proxies</span> <span class="o">=</span> <span class="n">proxies</span><span class="p">)</span>

<span class="n">opener</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">build_opener</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">opener</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

<span class="c1"># è·å–å“åº”çš„ä¿¡æ¯
</span><span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># ä¿å­˜
</span><span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">daili.html</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span><span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">fp</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>æ‰©å±•ï¼š1.ä»£ç†æ± 
2.å¿«ä»£ç†</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">urllib.request</span>

<span class="n">proxies_pool</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="sh">'</span><span class="s">http</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">118.24.219.151:16817</span><span class="sh">'</span><span class="p">},</span>
    <span class="p">{</span><span class="sh">'</span><span class="s">http</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">118.24.219.151:16817</span><span class="sh">'</span><span class="p">},</span>
<span class="p">]</span>

<span class="kn">import</span> <span class="n">random</span>

<span class="n">proxies</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">(</span><span class="n">proxies_pool</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">http://www.baidu.com/s?wd=ip</span><span class="sh">'</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36</span><span class="sh">'</span>
<span class="p">}</span>

<span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">Request</span><span class="p">(</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

<span class="n">handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">ProxyHandler</span><span class="p">(</span><span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">)</span>

<span class="n">opener</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">build_opener</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">opener</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

<span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span>

<span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">daili.html</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span><span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">fp</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="è§£æ">è§£æ</h1>

<h2 id="xpath">xpath</h2>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="n">xpathä½¿ç”¨</span><span class="err">ï¼š</span>
<span class="n">æ³¨æ„</span><span class="err">ï¼š</span><span class="n">æå‰å®‰è£…xpathæ’ä»¶</span>
<span class="err">ï¼ˆ</span><span class="mi">1</span><span class="err">ï¼‰</span><span class="n">æ‰“å¼€chromeæµè§ˆå™¨</span>
<span class="err">ï¼ˆ</span><span class="mi">2</span><span class="err">ï¼‰</span><span class="n">ç‚¹å‡»å³ä¸Šè§’å°åœ†ç‚¹</span>
<span class="err">ï¼ˆ</span><span class="mi">3</span><span class="err">ï¼‰</span><span class="n">æ›´å¤šå·¥å…·</span>
<span class="err">ï¼ˆ</span><span class="mi">4</span><span class="err">ï¼‰</span><span class="n">æ‰©å±•ç¨‹åº</span>
<span class="err">ï¼ˆ</span><span class="mi">5</span><span class="err">ï¼‰</span><span class="n">æ‹–æ‹½xpathæ’ä»¶åˆ°æ‰©å±•ç¨‹åºä¸­</span>
<span class="err">ï¼ˆ</span><span class="mi">6</span><span class="err">ï¼‰</span><span class="n">å¦‚æœcrxæ–‡ä»¶å¤±æ•ˆ</span><span class="err">ï¼Œ</span><span class="n">éœ€è¦å°†åç¼€ä¿®æ”¹zip</span>
<span class="err">ï¼ˆ</span><span class="mi">7</span><span class="err">ï¼‰</span><span class="n">å†æ¬¡æ‹–æ‹½</span>
<span class="err">ï¼ˆ</span><span class="mi">8</span><span class="err">ï¼‰</span><span class="n">å…³é—­æµè§ˆå™¨é‡æ–°æ‰“å¼€</span>
<span class="err">ï¼ˆ</span><span class="mi">9</span><span class="err">ï¼‰</span><span class="n">ctrl</span> <span class="o">+</span> <span class="n">shift</span> <span class="o">+</span> <span class="n">x</span>
<span class="err">ï¼ˆ</span><span class="mi">10</span><span class="err">ï¼‰</span><span class="n">å‡ºç°å°é»‘æ¡†</span>
<span class="mf">1.</span><span class="n">å®‰è£…lxmlåº“</span>
	<span class="n">pip</span> <span class="n">install</span> <span class="n">lxml</span> <span class="err">â€</span><span class="n">i</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pypi</span><span class="p">.</span><span class="n">douban</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">simple</span>
<span class="mf">2.</span><span class="n">å¯¼å…¥lxml</span><span class="p">.</span><span class="n">etree</span>
	<span class="kn">from</span> <span class="n">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="mf">3.</span><span class="n">etree</span><span class="p">.</span><span class="nf">parse</span><span class="p">()</span> <span class="n">è§£ææœ¬åœ°æ–‡ä»¶</span>
	<span class="n">html_tree</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="sh">'</span><span class="s">XX.html</span><span class="sh">'</span><span class="p">)</span>
<span class="mf">4.</span><span class="n">etree</span><span class="p">.</span><span class="nc">HTML</span><span class="p">()</span> <span class="n">æœåŠ¡å™¨å“åº”æ–‡ä»¶</span>
	<span class="n">html_tree</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="nc">HTML</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utfâ€8</span><span class="sh">'</span><span class="p">)</span>
<span class="mf">5.</span><span class="n">html_tree</span><span class="p">.</span><span class="nf">xpath</span><span class="p">(</span><span class="n">xpathè·¯å¾„</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="n">xpathåŸºæœ¬è¯­æ³•</span><span class="err">ï¼š</span>
	<span class="mf">1.</span><span class="n">è·¯å¾„æŸ¥è¯¢</span>
		<span class="o">//</span><span class="err">ï¼š</span><span class="n">æŸ¥æ‰¾æ‰€æœ‰å­å­™èŠ‚ç‚¹</span><span class="err">ï¼Œ</span><span class="n">ä¸è€ƒè™‘å±‚çº§å…³ç³»</span>
		<span class="o">/</span> <span class="err">ï¼š</span><span class="n">æ‰¾ç›´æ¥å­èŠ‚ç‚¹</span>
	<span class="mf">2.</span><span class="n">è°“è¯æŸ¥è¯¢</span>
		<span class="o">//</span><span class="n">div</span><span class="p">[</span><span class="nd">@id</span><span class="p">]</span>
		<span class="o">//</span><span class="n">div</span><span class="p">[</span><span class="nd">@id</span><span class="o">=</span><span class="sh">"</span><span class="s">maincontent</span><span class="sh">"</span><span class="p">]</span>
	<span class="mf">3.</span><span class="n">å±æ€§æŸ¥è¯¢</span>
		<span class="o">//</span><span class="nd">@class</span>
	<span class="mf">4.</span><span class="n">æ¨¡ç³ŠæŸ¥è¯¢</span>
		<span class="o">//</span><span class="n">div</span><span class="p">[</span><span class="nf">contains</span><span class="p">(</span><span class="nd">@id</span><span class="p">,</span> <span class="sh">"</span><span class="s">he</span><span class="sh">"</span><span class="p">)]</span>
		<span class="o">//</span><span class="n">div</span><span class="p">[</span><span class="n">starts</span><span class="err">â€</span><span class="nf">with</span><span class="p">(</span><span class="nd">@id</span><span class="p">,</span> <span class="sh">"</span><span class="s">he</span><span class="sh">"</span><span class="p">)]</span>
	<span class="mf">5.</span><span class="n">å†…å®¹æŸ¥è¯¢</span>
		<span class="o">//</span><span class="n">div</span><span class="o">/</span><span class="n">h1</span><span class="o">/</span><span class="nf">text</span><span class="p">()</span>
<span class="mf">6.</span><span class="n">é€»è¾‘è¿ç®—</span>
		<span class="o">//</span><span class="n">div</span><span class="p">[</span><span class="nd">@id</span><span class="o">=</span><span class="sh">"</span><span class="s">head</span><span class="sh">"</span> <span class="ow">and</span> <span class="nd">@class</span><span class="o">=</span><span class="sh">"</span><span class="s">s_down</span><span class="sh">"</span><span class="p">]</span>
		<span class="o">//</span><span class="n">title</span> <span class="o">|</span> <span class="o">//</span><span class="n">price</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="jsonpath">JsonPath</h2>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="n">jsonpathçš„å®‰è£…åŠä½¿ç”¨æ–¹å¼</span><span class="err">ï¼š</span>
	<span class="n">pipå®‰è£…</span><span class="err">ï¼š</span>
		<span class="n">pip</span> <span class="n">install</span> <span class="n">jsonpath</span>
	<span class="n">jsonpathçš„ä½¿ç”¨</span><span class="err">ï¼š</span>
		<span class="n">obj</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">jsonæ–‡ä»¶</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">utfâ€8</span><span class="sh">'</span><span class="p">))</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">jsonpath</span><span class="p">.</span><span class="nf">jsonpath</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sh">'</span><span class="s">jsonpathè¯­æ³•</span><span class="sh">'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>xmlæœ€å¤§çš„ä¼˜ç‚¹å°±æœ‰å¤§é‡çš„å·¥å…·å¯ä»¥åˆ†æï¼Œè½¬æ¢ï¼Œå’Œé€‰æ‹©æ€§çš„æå–æ–‡æ¡£ä¸­çš„æ•°æ®ã€‚XPathæ˜¯è¿™äº›æœ€å¼ºå¤§çš„å·¥å…·ä¹‹ä¸€ã€‚</p>

<p>å¦‚æœå¯ä»¥ä½¿ç”¨xpathæ¥è§£æjsonï¼Œä»¥ä¸‹çš„é—®é¢˜å¯ä»¥è¢«è§£å†³ï¼š</p>

<p>1ï¼Œæ•°æ®ä¸ä½¿ç”¨ç‰¹æ®Šçš„è„šæœ¬ï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯äº¤äº’çš„å‘ç°å¹¶å–å¹¶è·å–ã€‚</p>

<p>2ï¼Œå®¢æˆ·æœºè¯·æ±‚çš„JSONæ•°æ®å¯ä»¥å‡å°‘åˆ°æœåŠ¡å™¨ä¸Šçš„ç›¸å…³éƒ¨åˆ†ï¼Œè¿™æ ·å¯ä»¥æœ€å¤§é™åº¦åœ°å‡å°‘æœåŠ¡å™¨å“åº”çš„å¸¦å®½ä½¿ç”¨ç‡ã€‚</p>

<p>å¦‚æœæˆ‘ä»¬æ„¿æ„ï¼Œè¿™ä¸ªå¯ä»¥è§£æjsonæ•°æ®çš„å·¥å…·ä¼šå˜å¾—æœ‰æ„ä¹‰ã€‚éšä¹‹è€Œæ¥çš„é—®é¢˜æ˜¯å®ƒå¦‚ä½•å·¥ä½œï¼Œjsonpathçš„è¡¨è¾¾å¼çœ‹èµ·æ¥æ€ä¹ˆæ ·ã€‚</p>

<p>äº‹å®ä¸Šï¼Œjsonæ˜¯ç”±cç³»ç»Ÿç¼–ç¨‹è¯­è¨€è¡¨ç¤ºè‡ªç„¶æ•°æ®ï¼Œæœ‰ç‰¹å®šè¯­è¨€çš„ç‰¹å®šè¯­æ³•æ¥è®¿é—®jsonæ•°æ®ã€‚</p>

<p>xpathçš„è¡¨è¾¾å¼ï¼š</p>

<p>/store/book[1]/title</p>

<p>æˆ‘ä»¬å¯ä»¥çœ‹ä½œæ˜¯ï¼š</p>

<p>x.store.book[0].title</p>

<p>åœ¨Javascript, Python å’Œ PHP ä¸­ä¸€ä¸ªå˜é‡xè¡¨ç¤ºjsonæ•°æ®ã€‚ç»è¿‡è§‚å¯Ÿï¼Œç‰¹å®šçš„è¯­è¨€é‡Œæœ‰å†…ç½®xpathæ¥è§£ææ•°æ®ã€‚</p>

<p>JSONPathå·¥å…·çš„é—®é¢˜</p>

<p>-ä¾èµ–æŸç§ç‰¹å®šçš„è¯­è¨€</p>

<p>- éœ€è¦ä¾èµ–XPath 1.0</p>

<p>- å‡å°‘ä»£ç é‡å’Œå†…å­˜çš„æ¶ˆè€—</p>

<p>- åœ¨è¿è¡Œæ—¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre>JSONPath è¡¨è¾¾å¼

JSONPath æ˜¯å‚ç…§ï¼Œxpathè¡¨è¾¾å¼æ¥è§£æxmlæ–‡æ¡£çš„æ–¹å¼ï¼Œjsonæ•°æ®ç»“æ„é€šå¸¸æ˜¯åŒ¿åçš„å¹¶ä¸”ä¸ä¸€å®šéœ€è¦æœ‰æ ¹å…ƒç´ ã€‚JSONPaht ç”¨ä¸€ä¸ªæŠ½è±¡çš„åå­—$æ¥è¡¨ç¤ºæœ€å¤–å±‚å¯¹è±¡ã€‚

JOSNPath è¡¨è¾¾å¼å¯ä»¥ä½¿ç”¨.  ç¬¦å·å¦‚ä¸‹ï¼š
$.store.book[0].title

æˆ–è€…ä½¿ç”¨[] ç¬¦å·
$['store']['book'][0]['title']


ä»è¾“å…¥è·¯å¾„æ¥çœ‹ã€‚å†…éƒ¨æˆ–è€…è¾“å‡ºçš„è·¯å¾„éƒ½ä¼šè½¬åŒ–æˆ-ç¬¦å·ã€‚

JSONPath å…è®¸ä½¿ç”¨é€šé…ç¬¦ * è¡¨ç¤ºæ‰€ä»¥çš„å­å…ƒç´ åå’Œæ•°ç»„ç´¢å¼•ã€‚è¿˜å…è®¸ä½¿ç”¨ '..' ä»E4Xå‚ç…§è¿‡æ¥çš„å’Œæ•°ç»„åˆ‡åˆ†è¯­æ³• [start:end:step]æ˜¯ä»ECMASCRIPT 4 å‚ç…§è¿‡æ¥çš„ã€‚

è¡¨è¾¾å¼åœ¨ä¸‹é¢çš„è„šæœ¬è¯­è¨€ä¸­å¯ä»¥ä½¿ç”¨æ˜¾ç¤ºçš„åç§°æˆ–è€…ç´¢å¼•ï¼š
$.store.book[(@.length-1)].title


ä½¿ç”¨'@'ç¬¦å·è¡¨ç¤ºå½“å‰çš„å¯¹è±¡ï¼Œ?(&lt;åˆ¤æ–­è¡¨è¾¾å¼&gt;) ä½¿ç”¨é€»è¾‘è¡¨è¾¾å¼æ¥è¿‡æ»¤ã€‚
$.store.book[?(@.price &lt; 10)].title



è¿™é‡Œæœ‰ä¸ªè¡¨æ ¼ï¼Œè¯´æ˜JSONPathè¯­æ³•å…ƒç´ å’Œå¯¹åº”XPathå…ƒç´ çš„å¯¹æ¯”ã€‚

</pre></td></tr></tbody></table></code></pre></div></div>

<table>
  <thead>
    <tr>
      <th><strong>XPath</strong></th>
      <th><strong>JSONPath</strong></th>
      <th><strong>Description</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>/</td>
      <td>$</td>
      <td>è¡¨ç¤ºæ ¹å…ƒç´ </td>
    </tr>
    <tr>
      <td>.</td>
      <td>@</td>
      <td>å½“å‰å…ƒç´ </td>
    </tr>
    <tr>
      <td>/</td>
      <td>. or []</td>
      <td>å­å…ƒç´ </td>
    </tr>
    <tr>
      <td>..</td>
      <td>n/a</td>
      <td>çˆ¶å…ƒç´ </td>
    </tr>
    <tr>
      <td>//</td>
      <td>..</td>
      <td>é€’å½’ä¸‹é™ï¼ŒJSONPathæ˜¯ä»E4Xå€Ÿé‰´çš„ã€‚</td>
    </tr>
    <tr>
      <td>*</td>
      <td>*</td>
      <td>é€šé…ç¬¦ï¼Œè¡¨ç¤ºæ‰€æœ‰çš„å…ƒç´ </td>
    </tr>
    <tr>
      <td>@</td>
      <td>n/a</td>
      <td>å±æ€§è®¿é—®å­—ç¬¦</td>
    </tr>
    <tr>
      <td>[]</td>
      <td>[]</td>
      <td>å­å…ƒç´ æ“ä½œç¬¦</td>
    </tr>
    <tr>
      <td>|</td>
      <td>[,]</td>
      <td>è¿æ¥æ“ä½œç¬¦åœ¨XPath ç»“æœåˆå¹¶å…¶å®ƒç»“ç‚¹é›†åˆã€‚JSONPå…è®¸nameæˆ–è€…æ•°ç»„ç´¢å¼•ã€‚</td>
    </tr>
    <tr>
      <td>n/a</td>
      <td>[start: end :step]</td>
      <td>æ•°ç»„åˆ†å‰²æ“ä½œä»ES4å€Ÿé‰´ã€‚</td>
    </tr>
    <tr>
      <td>[]</td>
      <td>?()</td>
      <td>åº”ç”¨è¿‡æ»¤è¡¨ç¤ºå¼</td>
    </tr>
    <tr>
      <td>n/a</td>
      <td>()</td>
      <td>è„šæœ¬è¡¨è¾¾å¼ï¼Œä½¿ç”¨åœ¨è„šæœ¬å¼•æ“ä¸‹é¢ã€‚</td>
    </tr>
    <tr>
      <td>()</td>
      <td>n/a</td>
      <td>Xpathåˆ†ç»„</td>
    </tr>
  </tbody>
</table>

<p>XPathè¿˜æœ‰å¾ˆå¤šçš„è¯­æ³•ï¼ˆæœ¬åœ°è·¯å¾„ï¼Œæ“ä½œç¬¦ï¼Œå’Œå‡½æ•°ï¼‰æ²¡æœ‰åˆ—åœ¨è¿™é‡Œã€‚åªè¦çŸ¥é“xpathå’Œjsonpathè„šæœ¬ä¹‹ä¸­çš„ä¸åŒç‚¹å°±è¡Œäº†ã€‚</p>

<ul>
  <li>[]åœ¨xpathè¡¨è¾¾å¼æ€»æ˜¯ä»å‰é¢çš„è·¯å¾„æ¥æ“ä½œæ•°ç»„ï¼Œç´¢å¼•æ˜¯ä»1å¼€å§‹ã€‚</li>
  <li>ä½¿ç”¨JOSNPathçš„[]æ“ä½œç¬¦æ“ä½œä¸€ä¸ªå¯¹è±¡æˆ–è€…æ•°ç»„ï¼Œç´¢å¼•æ˜¯ä»0å¼€å§‹ã€‚</li>
</ul>

<p>æ¥ä¸‹æˆ‘ä»¬çœ‹jsonpathè¡¨ç¤ºçš„ä¾‹å­ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„jsonæ•°æ®ç»“æ„ä»£è¡¨ä¸€ä¸ªä¹¦åº—ï¼ˆåŸå§‹çš„xmlæ–‡ä»¶æ˜¯ï¼‰</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w"> </span><span class="nl">"store"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"book"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> 
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"reference"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Nigel Rees"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Sayings of the Century"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mf">8.95</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fiction"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Evelyn Waugh"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Sword of Honour"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mf">12.99</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fiction"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Herman Melville"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Moby Dick"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"isbn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0-553-21311-3"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mf">8.99</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fiction"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">"J. R. R. Tolkien"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The Lord of the Rings"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"isbn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0-395-19395-8"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mf">22.99</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"bicycle"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"color"</span><span class="p">:</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mf">19.95</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<table>
  <thead>
    <tr>
      <th><strong>XPath</strong></th>
      <th><strong>JSONPath</strong></th>
      <th><strong>ç»“æœ</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/store/book/author</code></td>
      <td><code class="language-plaintext highlighter-rouge">$.store.book[*].author</code></td>
      <td>ä¹¦ç‚¹æ‰€æœ‰ä¹¦çš„ä½œè€…</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">//author</code></td>
      <td><code class="language-plaintext highlighter-rouge">$..author</code></td>
      <td>æ‰€æœ‰çš„ä½œè€…</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/store/*</code></td>
      <td><code class="language-plaintext highlighter-rouge">$.store.*</code></td>
      <td>storeçš„æ‰€æœ‰å…ƒç´ ã€‚æ‰€æœ‰çš„bookstå’Œbicycle</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/store//price</code></td>
      <td><code class="language-plaintext highlighter-rouge">$.store..price</code></td>
      <td>storeé‡Œé¢æ‰€æœ‰ä¸œè¥¿çš„price</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">//book[3]</code></td>
      <td><code class="language-plaintext highlighter-rouge">$..book[2]</code></td>
      <td>ç¬¬ä¸‰ä¸ªä¹¦</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">//book[last()]</code></td>
      <td><code class="language-plaintext highlighter-rouge">$..book[(@.length-1)]</code></td>
      <td>æœ€åä¸€æœ¬ä¹¦</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">//book[position()&lt;3]</code></td>
      <td><code class="language-plaintext highlighter-rouge">$..book[0,1]</code><code class="language-plaintext highlighter-rouge">$..book[:2]</code></td>
      <td>å‰é¢çš„ä¸¤æœ¬ä¹¦ã€‚</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">//book[isbn]</code></td>
      <td><code class="language-plaintext highlighter-rouge">$..book[?(@.isbn)]</code></td>
      <td>è¿‡æ»¤å‡ºæ‰€æœ‰çš„åŒ…å«isbnçš„ä¹¦ã€‚</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">//book[price&lt;10]</code></td>
      <td><code class="language-plaintext highlighter-rouge">$..book[?(@.price&lt;10)]</code></td>
      <td>è¿‡æ»¤å‡ºä»·æ ¼ä½äº10çš„ä¹¦ã€‚</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">//*</code></td>
      <td><code class="language-plaintext highlighter-rouge">$..*</code></td>
      <td>æ‰€æœ‰å…ƒç´ ã€‚</td>
    </tr>
  </tbody>
</table>

<p>æ¡ˆä¾‹ç»ƒä¹ :1.æ·˜ç¥¨ç¥¨
2.boosç›´è˜
3.ä¸­åè‹±æ‰
4.æ±½è½¦ä¹‹å®¶</p>

<h2 id="beautifulsoup">BeautifulSoup</h2>

<p>1.åŸºæœ¬ç®€ä»‹</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="mf">1.</span><span class="n">BeautifulSoupç®€ç§°</span><span class="err">ï¼š</span>
	<span class="n">bs4</span>
<span class="mf">2.</span><span class="n">ä»€ä¹ˆæ˜¯BeatifulSoup</span><span class="err">ï¼Ÿ</span>
	<span class="n">BeautifulSoup</span><span class="err">ï¼Œ</span><span class="n">å’Œlxmlä¸€æ ·</span><span class="err">ï¼Œ</span><span class="n">æ˜¯ä¸€ä¸ªhtmlçš„è§£æå™¨</span><span class="err">ï¼Œ</span><span class="n">ä¸»è¦åŠŸèƒ½ä¹Ÿæ˜¯è§£æå’Œæå–æ•°æ®</span>
<span class="mf">3.</span><span class="n">ä¼˜ç¼ºç‚¹</span><span class="err">ï¼Ÿ</span>
	<span class="n">ç¼ºç‚¹</span><span class="err">ï¼š</span><span class="n">æ•ˆç‡æ²¡æœ‰lxmlçš„æ•ˆç‡é«˜</span>
	<span class="n">ä¼˜ç‚¹</span><span class="err">ï¼š</span><span class="n">æ¥å£è®¾è®¡äººæ€§åŒ–</span><span class="err">ï¼Œ</span><span class="n">ä½¿ç”¨æ–¹ä¾¿</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>2.å®‰è£…ä»¥åŠåˆ›å»º</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>1.å®‰è£…
	pip install bs4
2.å¯¼å…¥
	from bs4 import BeautifulSoup
3.åˆ›å»ºå¯¹è±¡
	æœåŠ¡å™¨å“åº”çš„æ–‡ä»¶ç”Ÿæˆå¯¹è±¡
		soup = BeautifulSoup(response.read().decode(), 'lxml')
	æœ¬åœ°æ–‡ä»¶ç”Ÿæˆå¯¹è±¡
		soup = BeautifulSoup(open('1.html'), 'lxml')
		æ³¨æ„ï¼šé»˜è®¤æ‰“å¼€æ–‡ä»¶çš„ç¼–ç æ ¼å¼gbkæ‰€ä»¥éœ€è¦æŒ‡å®šæ‰“å¼€ç¼–ç æ ¼å¼
</pre></td></tr></tbody></table></code></pre></div></div>

<p>3.èŠ‚ç‚¹å®šä½</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre><span class="mf">1.</span><span class="n">æ ¹æ®æ ‡ç­¾åæŸ¥æ‰¾èŠ‚ç‚¹</span>
		<span class="n">soup</span><span class="p">.</span><span class="n">a</span> <span class="err">ã€</span><span class="n">æ³¨</span><span class="err">ã€‘</span><span class="n">åªèƒ½æ‰¾åˆ°ç¬¬ä¸€ä¸ªa</span>
			<span class="n">soup</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">name</span>
			<span class="n">soup</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">attrs</span>
<span class="mf">2.</span><span class="n">å‡½æ•°</span>
		<span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">find</span><span class="p">(</span><span class="n">è¿”å›ä¸€ä¸ªå¯¹è±¡</span><span class="p">)</span>
				<span class="nf">find</span><span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">)</span><span class="err">ï¼š</span><span class="n">åªæ‰¾åˆ°ç¬¬ä¸€ä¸ªaæ ‡ç­¾</span>
        		<span class="nf">find</span><span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sh">'</span><span class="s">åå­—</span><span class="sh">'</span><span class="p">)</span>
				<span class="nf">find</span><span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="sh">'</span><span class="s">åå­—</span><span class="sh">'</span><span class="p">)</span>
		<span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">find_all</span><span class="p">(</span><span class="n">è¿”å›ä¸€ä¸ªåˆ—è¡¨</span><span class="p">)</span>
				<span class="nf">find_all</span><span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">)</span> <span class="n">æŸ¥æ‰¾åˆ°æ‰€æœ‰çš„a</span>
				<span class="nf">find_all</span><span class="p">([</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">span</span><span class="sh">'</span><span class="p">])</span> <span class="n">è¿”å›æ‰€æœ‰çš„aå’Œspan</span>
				<span class="nf">find_all</span><span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="n">åªæ‰¾å‰ä¸¤ä¸ªa</span>
		<span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nf">select</span><span class="p">(</span><span class="n">æ ¹æ®é€‰æ‹©å™¨å¾—åˆ°èŠ‚ç‚¹å¯¹è±¡</span><span class="p">)</span><span class="err">ã€</span><span class="n">æ¨è</span><span class="err">ã€‘</span>
				<span class="mf">1.</span><span class="n">element</span>
					<span class="n">eg</span><span class="p">:</span><span class="n">p</span>
				<span class="mf">2.</span><span class="p">.</span><span class="k">class</span>
					<span class="nc">eg</span><span class="p">:.</span><span class="n">firstname</span>
				<span class="mf">3.</span><span class="c1">#id
</span>					<span class="n">eg</span><span class="p">:</span><span class="c1">#firstname
</span>				<span class="mf">4.</span><span class="n">å±æ€§é€‰æ‹©å™¨</span>
					<span class="p">[</span><span class="n">attribute</span><span class="p">]</span>
                    	<span class="n">eg</span><span class="p">:</span><span class="n">li</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="sh">'</span><span class="s">li[class]</span><span class="sh">'</span><span class="p">)</span>
                    <span class="p">[</span><span class="n">attribute</span><span class="o">=</span><span class="n">value</span><span class="p">]</span>
						<span class="n">eg</span><span class="p">:</span><span class="n">li</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="sh">'</span><span class="s">li[class=</span><span class="sh">"</span><span class="s">hengheng1</span><span class="sh">"</span><span class="s">]</span><span class="sh">'</span><span class="p">)</span>
                <span class="mf">5.</span><span class="n">å±‚çº§é€‰æ‹©å™¨</span>
					<span class="n">element</span> <span class="n">element</span>
						<span class="n">div</span> <span class="n">p</span>
					<span class="n">element</span><span class="o">&gt;</span><span class="n">element</span>
						<span class="n">div</span><span class="o">&gt;</span><span class="n">p</span>
					<span class="n">element</span><span class="p">,</span><span class="n">element</span>
						<span class="n">div</span><span class="p">,</span><span class="n">p</span>
							<span class="n">eg</span><span class="p">:</span><span class="n">soup</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="sh">'</span><span class="s">a,span</span><span class="sh">'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>4.èŠ‚ç‚¹ä¿¡æ¯</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">è·å–èŠ‚ç‚¹å†…å®¹</span><span class="err">ï¼š</span><span class="n">é€‚ç”¨äºæ ‡ç­¾ä¸­åµŒå¥—æ ‡ç­¾çš„ç»“æ„</span>
		<span class="n">obj</span><span class="p">.</span><span class="n">string</span>
		<span class="n">obj</span><span class="p">.</span><span class="nf">get_text</span><span class="p">()</span><span class="err">ã€</span><span class="n">æ¨è</span><span class="err">ã€‘</span>
<span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">èŠ‚ç‚¹çš„å±æ€§</span>
		<span class="n">tag</span><span class="p">.</span><span class="n">name</span> <span class="n">è·å–æ ‡ç­¾å</span>
			<span class="n">eg</span><span class="p">:</span><span class="n">tag</span> <span class="o">=</span> <span class="nf">find</span><span class="p">(</span><span class="sh">'</span><span class="s">li)
				print(tag.name)
		tag.attrså°†å±æ€§å€¼ä½œä¸ºä¸€ä¸ªå­—å…¸è¿”å›
(3).è·å–èŠ‚ç‚¹å±æ€§
		obj.attrs.get(</span><span class="sh">'</span><span class="n">title</span><span class="sh">'</span><span class="s">)ã€å¸¸ç”¨ã€‘
		obj.get(</span><span class="sh">'</span><span class="n">title</span><span class="sh">'</span><span class="s">)
		obj[</span><span class="sh">'</span><span class="n">title</span><span class="sh">'</span><span class="s">]
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>åº”ç”¨å®ä¾‹ï¼š 1.è‚¡ç¥¨ä¿¡æ¯æå–ï¼ˆhttp://quote.stockstar.com/ï¼‰
2.ä¸­åè‹±æ‰ç½‘-æ—§ç‰ˆ
3 .è…¾è®¯å…¬å¸æ‹›è˜éœ€æ±‚æŠ“å–ï¼ˆhttps://hr.tencent.com/index.phpï¼‰</p>

<h1 id="selenium">Selenium</h1>

<p><strong>1.ä»€ä¹ˆæ˜¯seleniumï¼Ÿ</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>ï¼ˆ1ï¼‰Seleniumæ˜¯ä¸€ä¸ªç”¨äºWebåº”ç”¨ç¨‹åºæµ‹è¯•çš„å·¥å…·ã€‚ 
ï¼ˆ2ï¼‰Selenium æµ‹è¯•ç›´æ¥è¿è¡Œåœ¨æµè§ˆå™¨ä¸­ï¼Œå°±åƒçœŸæ­£çš„ç”¨æˆ·åœ¨æ“ä½œä¸€æ ·ã€‚ 
ï¼ˆ3ï¼‰æ”¯æŒé€šè¿‡å„ç§driverï¼ˆFirfoxDriverï¼ŒIternetExplorerDriverï¼ŒOperaDriverï¼ŒChromeDriverï¼‰é©±åŠ¨ çœŸå®æµè§ˆå™¨å®Œæˆæµ‹è¯•ã€‚ ï¼ˆ4ï¼‰seleniumä¹Ÿæ˜¯æ”¯æŒæ— ç•Œé¢æµè§ˆå™¨æ“ä½œçš„ã€‚
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>2.ä¸ºä»€ä¹ˆä½¿ç”¨seleniumï¼Ÿ</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> æ¨¡æ‹Ÿæµè§ˆå™¨åŠŸèƒ½ï¼Œè‡ªåŠ¨æ‰§è¡Œç½‘é¡µä¸­çš„jsä»£ç ï¼Œå®ç°åŠ¨æ€åŠ è½½
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>3.å¦‚ä½•å®‰è£…seleniumï¼Ÿ</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>ï¼ˆ1ï¼‰æ“ä½œè°·æ­Œæµè§ˆå™¨é©±åŠ¨ä¸‹è½½åœ°å€ http://chromedriver.storage.googleapis.com/index.html 
ï¼ˆ2ï¼‰è°·æ­Œé©±åŠ¨å’Œè°·æ­Œæµè§ˆå™¨ç‰ˆæœ¬ä¹‹é—´çš„æ˜ å°„è¡¨ http://blog.csdn.net/huilan_same/article/details/51896672 
ï¼ˆ3ï¼‰æŸ¥çœ‹è°·æ­Œæµè§ˆå™¨ç‰ˆæœ¬ è°·æ­Œæµè§ˆå™¨å³ä¸Šè§’â€â€&gt;å¸®åŠ©â€â€&gt;å…³äº 
ï¼ˆ4ï¼‰pip install selenium
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>4.seleniumçš„ä½¿ç”¨æ­¥éª¤ï¼Ÿ</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre> ï¼ˆ1ï¼‰å¯¼å…¥ï¼šfrom selenium import webdriver 
 ï¼ˆ2ï¼‰åˆ›å»ºè°·æ­Œæµè§ˆå™¨æ“ä½œå¯¹è±¡ï¼š path = è°·æ­Œæµè§ˆå™¨é©±åŠ¨æ–‡ä»¶è·¯å¾„ browser = webdriver.Chrome(path) 
 ï¼ˆ3ï¼‰è®¿é—®ç½‘å€ url = è¦è®¿é—®çš„ç½‘å€ browser.get(url)
 
å…ƒç´ å®šä½ï¼šè‡ªåŠ¨åŒ–è¦åšçš„å°±æ˜¯æ¨¡æ‹Ÿé¼ æ ‡å’Œé”®ç›˜æ¥æ“ä½œæ¥æ“ä½œè¿™äº›å…ƒç´ ï¼Œç‚¹å‡»ã€è¾“å…¥ç­‰ç­‰ã€‚æ“ä½œè¿™äº›å…ƒç´ å‰é¦–å…ˆ
è¦æ‰¾åˆ°å®ƒä»¬ï¼ŒWebDriveræä¾›å¾ˆå¤šå®šä½å…ƒç´ çš„æ–¹æ³•
æ–¹æ³•ï¼š
1.find_element_by_id
	eg:button = browser.find_element_by_id('su')

2.find_elements_by_name
	eg:name = browser.find_element_by_name('wd')

3.find_elements_by_xpath
	eg:xpath1 = browser.find_elements_by_xpath('//input[@id="su"]')

4.find_elements_by_tag_name
	eg:names = browser.find_elements_by_tag_name('input')

5.find_elements_by_css_selector
	eg:my_input = browser.find_elements_by_css_selector('#kw')[0]
	
6.find_elements_by_link_text
	eg:browser.find_element_by_link_text("æ–°é—»")

</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>4â€2:è®¿é—®å…ƒç´ ä¿¡æ¯
è·å–å…ƒç´ å±æ€§
	.get_attribute('class')
è·å–å…ƒç´ æ–‡æœ¬
	.text
è·å–æ ‡ç­¾å
	.tag_name
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>4â€3:äº¤äº’
	ç‚¹å‡»:click()
	è¾“å…¥:send_keys()
	åé€€æ“ä½œ:browser.back()
	å‰è¿›æ“ä½œ:browser.forword()
	æ¨¡æ‹ŸJSæ»šåŠ¨:
		js='document.documentElement.scrollTop=100000'
		browser.execute_script(js) æ‰§è¡Œjsä»£ç 
	è·å–ç½‘é¡µä»£ç ï¼špage_source
	é€€å‡ºï¼šbrowser.quit()xxxxxxxxxxÂ 
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>5.Chrome handless</strong></p>

<p>Chrome-headless æ¨¡å¼ï¼Œ Google é’ˆå¯¹ Chrome æµè§ˆå™¨ 59ç‰ˆ æ–°å¢åŠ çš„ä¸€ç§æ¨¡å¼ï¼Œå¯ä»¥è®©ä½ ä¸æ‰“å¼€UIç•Œé¢çš„æƒ…å†µä¸‹ ä½¿ç”¨ Chrome æµè§ˆå™¨ï¼Œæ‰€ä»¥è¿è¡Œæ•ˆæœä¸ Chrome ä¿æŒå®Œç¾ä¸€è‡´ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>1.ç³»ç»Ÿè¦æ±‚ï¼š
		Chrome
				Unix\Linux ç³»ç»Ÿéœ€è¦ chrome &gt;= 59
				Windows ç³»ç»Ÿéœ€è¦ chrome &gt;= 60
		Python3.6
		Selenium==3.4.*
		ChromeDriver==2.31
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="mf">2.</span><span class="n">é…ç½®</span><span class="err">ï¼š</span>
<span class="kn">from</span> <span class="n">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="n">chrome_options</span> <span class="o">=</span> <span class="nc">Options</span><span class="p">()</span>
<span class="n">chrome_options</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">â€â€headless</span><span class="sh">'</span><span class="p">)</span>
<span class="n">chrome_options</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">â€â€disableâ€gpu</span><span class="sh">'</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="sa">r</span><span class="sh">'</span><span class="s">C:\Program Files (x86)\Google\Chrome\Application\chrome.exe</span><span class="sh">'</span>
<span class="n">chrome_options</span><span class="p">.</span><span class="n">binary_location</span> <span class="o">=</span> <span class="n">path</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="nc">Chrome</span><span class="p">(</span><span class="n">chrome_options</span><span class="o">=</span><span class="n">chrome_options</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">http://www.baidu.com/</span><span class="sh">'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="mf">3.</span><span class="n">é…ç½®å°è£…</span><span class="err">ï¼š</span>
		<span class="kn">from</span> <span class="n">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
		<span class="c1">#è¿™ä¸ªæ˜¯æµè§ˆå™¨è‡ªå¸¦çš„ ä¸éœ€è¦æˆ‘ä»¬å†åšé¢å¤–çš„æ“ä½œ
</span>		<span class="kn">from</span> <span class="n">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
		<span class="k">def</span> <span class="nf">share_browser</span><span class="p">():</span>
			<span class="c1">#åˆå§‹åŒ–
</span>			<span class="n">chrome_options</span> <span class="o">=</span> <span class="nc">Options</span><span class="p">()</span>
			<span class="n">chrome_options</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">â€â€headless</span><span class="sh">'</span><span class="p">)</span>
			<span class="n">chrome_options</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">â€â€disableâ€gpu</span><span class="sh">'</span><span class="p">)</span>
			<span class="c1">#æµè§ˆå™¨çš„å®‰è£…è·¯å¾„ æ‰“å¼€æ–‡ä»¶ä½ç½®
</span>			<span class="c1">#è¿™ä¸ªè·¯å¾„æ˜¯ä½ è°·æ­Œæµè§ˆå™¨çš„è·¯å¾„
</span>			<span class="n">path</span> <span class="o">=</span> <span class="sa">r</span><span class="sh">'</span><span class="s">C:\Program Files (x86)\Google\Chrome\Application\chrome.exe</span><span class="sh">'</span>
			<span class="n">chrome_options</span><span class="p">.</span><span class="n">binary_location</span> <span class="o">=</span> <span class="n">path</span>
            <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="nc">Chrome</span><span class="p">(</span><span class="n">chrome_options</span><span class="o">=</span><span class="n">chrome_options</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">browser</span>
<span class="n">å°è£…è°ƒç”¨</span><span class="err">ï¼š</span>
		<span class="kn">from</span> <span class="n">handless</span> <span class="kn">import</span> <span class="n">share_browser</span>
		<span class="n">browser</span> <span class="o">=</span> <span class="nf">share_browser</span><span class="p">()</span>
		<span class="n">browser</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">http://www.baidu.com/</span><span class="sh">'</span><span class="p">)</span>
		<span class="n">browser</span><span class="p">.</span><span class="nf">save_screenshot</span><span class="p">(</span><span class="sh">'</span><span class="s">handless1.png</span><span class="sh">'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="requests">requests</h1>

<p><strong>1.åŸºæœ¬ä½¿ç”¨</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>1.æ–‡æ¡£ï¼š
	å®˜æ–¹æ–‡æ¡£
		http://cn.pythonâ€requests.org/zh_CN/latest/
	å¿«é€Ÿä¸Šæ‰‹
		http://cn.pythonâ€requests.org/zh_CN/latest/user/quickstart.html
2.å®‰è£…
	pip install requests
	
3.responseçš„å±æ€§ä»¥åŠç±»å‹
	ç±»å‹                          ï¼šmodels.Response
	r.text 						 : è·å–ç½‘ç«™æºç 
	r.encoding                   ï¼šè®¿é—®æˆ–å®šåˆ¶ç¼–ç æ–¹å¼
	r.url                        ï¼šè·å–è¯·æ±‚çš„url
	r.content                    ï¼šå“åº”çš„å­—èŠ‚ç±»å‹
	r.status_code                ï¼šå“åº”çš„çŠ¶æ€ç 
	r.headers                    ï¼šå“åº”çš„å¤´ä¿¡æ¯

</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>2.getè¯·æ±‚</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>requests.get()
	eg:
		import requests
		url = 'http://www.baidu.com/s?'
	headers = {
			'Userâ€Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML,
				like Gecko) Chrome/65.0.3325.181 Safari/537.36'
	}
	data = {
		'wd':'åŒ—äº¬'
	}
	response = requests.get(url,params=data,headers=headers)
å®šåˆ¶å‚æ•°
	å‚æ•°ä½¿ç”¨paramsä¼ é€’
	å‚æ•°æ— éœ€urlencodeç¼–ç 
	ä¸éœ€è¦è¯·æ±‚å¯¹è±¡çš„å®šåˆ¶
	è¯·æ±‚èµ„æºè·¯å¾„ä¸­ï¼Ÿå¯åŠ å¯ä¸åŠ 
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>3.postè¯·æ±‚</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">()</span>
<span class="n">ç™¾åº¦ç¿»è¯‘</span><span class="p">:</span>
	<span class="n">eg</span><span class="p">:</span>
		<span class="kn">import</span> <span class="n">requests</span>
		<span class="n">post_url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">http://fanyi.baidu.com/sug</span><span class="sh">'</span>
		<span class="n">headers</span><span class="o">=</span><span class="p">{</span>
			<span class="sh">'</span><span class="s">Userâ€Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
				(KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36</span><span class="sh">'</span>
		<span class="p">}</span>
		<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
			<span class="sh">'</span><span class="s">kw</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">eye</span><span class="sh">'</span>
		<span class="p">}</span>
		<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">url</span> <span class="o">=</span> <span class="n">post_url</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>6ï¼šgetå’ŒpoståŒºåˆ«ï¼Ÿ
	1ï¼š getè¯·æ±‚çš„å‚æ•°åå­—æ˜¯params postè¯·æ±‚çš„å‚æ•°çš„åå­—æ˜¯data
	2ï¼š è¯·æ±‚èµ„æºè·¯å¾„åé¢å¯ä»¥ä¸åŠ ?
	3ï¼š ä¸éœ€è¦æ‰‹åŠ¨ç¼–è§£ç 
	4ï¼š ä¸éœ€è¦åšè¯·æ±‚å¯¹è±¡çš„å®šåˆ¶

</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>4.ä»£ç†</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre>7ï¼šproxyå®šåˆ¶
	åœ¨è¯·æ±‚ä¸­è®¾ç½®proxieså‚æ•°
	å‚æ•°ç±»å‹æ˜¯ä¸€ä¸ªå­—å…¸ç±»å‹
	eg:
		import requests
		url = 'http://www.baidu.com/s?'
		headers = {
			'userâ€agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML,
		like Gecko) Chrome/65.0.3325.181 Safari/537.36'
		}
		data = {
			'wd':'ip'
		}
		proxy = {
			'http':'219.149.59.250:9797'
		}
		r = requests.get(url=url,params=data,headers=headers,proxies=proxy)
		with open('proxy.html','w',encoding='utfâ€8') as fp:
		fp.write(r.text)
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>5.cookieå®šåˆ¶</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>8:cookieå®šåˆ¶
	åº”ç”¨æ¡ˆä¾‹ï¼š
		ï¼ˆ1ï¼‰å¤è¯—æ–‡ç½‘ï¼ˆéœ€è¦éªŒè¯ï¼‰
		ï¼ˆ2ï¼‰äº‘æ‰“ç å¹³å°
			ç”¨æˆ·ç™»é™† actionuser action
			å¼€å‘è€…ç™»é™† actioncode action

</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="scrapy">scrapy</h1>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>ï¼ˆ1ï¼‰scrapyæ˜¯ä»€ä¹ˆï¼Ÿ
		Scrapyæ˜¯ä¸€ä¸ªä¸ºäº†çˆ¬å–ç½‘ç«™æ•°æ®ï¼Œæå–ç»“æ„æ€§æ•°æ®è€Œç¼–å†™çš„åº”ç”¨æ¡†æ¶ã€‚ å¯ä»¥åº”ç”¨åœ¨åŒ…æ‹¬æ•°æ®æŒ–æ˜ï¼Œä¿¡æ¯å¤„ç†
æˆ–å­˜å‚¨å†å²æ•°æ®ç­‰ä¸€ç³»åˆ—çš„ç¨‹åºä¸­ã€‚

</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre>ï¼ˆ2ï¼‰å®‰è£…scrapyï¼š
			pip install scrapy
	å®‰è£…è¿‡ç¨‹ä¸­å‡ºé”™ï¼š
			å¦‚æœå®‰è£…æœ‰é”™è¯¯ï¼ï¼ï¼ï¼
			pip install Scrapy
			building 'twisted.test.raiser' extension
			error: Microsoft Visual C++ 14.0 is required. Get it with "Microsoft Visual C++
			Build Tools": http://landinghub.visualstudio.com/visualâ€cppâ€buildâ€tools
	è§£å†³æ–¹æ¡ˆï¼š
			http://www.lfd.uci.edu/~gohlke/pythonlibs/#twisted
			ä¸‹è½½twistedå¯¹åº”ç‰ˆæœ¬çš„whlæ–‡ä»¶ï¼ˆå¦‚æˆ‘çš„Twistedâ€17.5.0â€cp36â€cp36mâ€win_amd64.whlï¼‰ï¼Œcpåé¢æ˜¯
			pythonç‰ˆæœ¬ï¼Œamd64ä»£è¡¨64ä½ï¼Œè¿è¡Œå‘½ä»¤ï¼š
			pip install C:\Users\...\Twistedâ€17.5.0â€cp36â€cp36mâ€win_amd64.whl
			pip install Scrapy
	å¦‚æœå†æŠ¥é”™
			python â€m pip install â€â€upgrade pip
	å¦‚æœå†æŠ¥é”™ win32
	è§£å†³æ–¹æ³•ï¼š
			pip install pypiwin32
    å†æŠ¥é”™ï¼šä½¿ç”¨anaconda
	ä½¿ç”¨æ­¥éª¤ï¼š
		æ‰“å¼€anaconda
		ç‚¹å‡»environments
		ç‚¹å‡»not installed
		è¾“å…¥scrapy
		apply
		åœ¨pycharmä¸­é€‰æ‹©anacondaçš„ç¯å¢ƒ
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="1scrapyé¡¹ç›®çš„åˆ›å»ºä»¥åŠè¿è¡Œ">1.scrapyé¡¹ç›®çš„åˆ›å»ºä»¥åŠè¿è¡Œ</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>1.åˆ›å»ºscrapyé¡¹ç›®ï¼š
	ç»ˆç«¯è¾“å…¥ scrapy startproject é¡¹ç›®åç§°
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>2.é¡¹ç›®ç»„æˆï¼š
	spiders
		__init__.py
		è‡ªå®šä¹‰çš„çˆ¬è™«æ–‡ä»¶.py â€â€â€ã€‹ç”±æˆ‘ä»¬è‡ªå·±åˆ›å»ºï¼Œæ˜¯å®ç°çˆ¬è™«æ ¸å¿ƒåŠŸèƒ½çš„æ–‡ä»¶
	__init__.py
	items.py â€â€â€ã€‹å®šä¹‰æ•°æ®ç»“æ„çš„åœ°æ–¹ï¼Œæ˜¯ä¸€ä¸ªç»§æ‰¿è‡ªscrapy.Itemçš„ç±»
	middlewares.py â€â€â€ã€‹ä¸­é—´ä»¶ ä»£ç†
	pipelines.py â€â€â€ã€‹ç®¡é“æ–‡ä»¶ï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ªç±»ï¼Œç”¨äºå¤„ç†ä¸‹è½½æ•°æ®çš„åç»­å¤„ç†é»˜è®¤æ˜¯300ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼ˆ1â€1000ï¼‰
	settings.py â€â€â€ã€‹é…ç½®æ–‡ä»¶ æ¯”å¦‚ï¼šæ˜¯å¦éµå®ˆrobotsåè®®ï¼ŒUserâ€Agentå®šä¹‰ç­‰

</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>3.åˆ›å»ºçˆ¬è™«æ–‡ä»¶ï¼š
			ï¼ˆ1ï¼‰è·³è½¬åˆ°spidersæ–‡ä»¶å¤¹ cd ç›®å½•åå­—/ç›®å½•åå­—/spiders
			ï¼ˆ2ï¼‰scrapy genspider çˆ¬è™«åå­— ç½‘é¡µçš„åŸŸå
çˆ¬è™«æ–‡ä»¶çš„åŸºæœ¬ç»„æˆï¼š
			ç»§æ‰¿scrapy.Spiderç±»
					name = 'baidu' â€â€â€ã€‹ è¿è¡Œçˆ¬è™«æ–‡ä»¶æ—¶ä½¿ç”¨çš„åå­—
					allowed_domains â€â€â€ã€‹ çˆ¬è™«å…è®¸çš„åŸŸåï¼Œåœ¨çˆ¬å–çš„æ—¶å€™ï¼Œå¦‚æœä¸æ˜¯æ­¤åŸŸåä¹‹ä¸‹çš„urlï¼Œä¼šè¢«è¿‡æ»¤æ‰
					start_urls â€â€â€ã€‹ å£°æ˜äº†çˆ¬è™«çš„èµ·å§‹åœ°å€ï¼Œå¯ä»¥å†™å¤šä¸ªurlï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸ª
					parse(self, response) â€â€â€ã€‹è§£ææ•°æ®çš„å›è°ƒå‡½æ•°
								response.text â€â€â€ã€‹å“åº”çš„æ˜¯å­—ç¬¦ä¸²
								response.body â€â€â€ã€‹å“åº”çš„æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶
								response.xpath()â€ã€‹xpathæ–¹æ³•çš„è¿”å›å€¼ç±»å‹æ˜¯selectoråˆ—è¡¨
								extract() â€â€â€ã€‹æå–çš„æ˜¯selectorå¯¹è±¡çš„æ˜¯data
								extract_first() â€â€â€ã€‹æå–çš„æ˜¯selectoråˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªæ•°æ®
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>4.è¿è¡Œçˆ¬è™«æ–‡ä»¶ï¼š
	scrapy crawl çˆ¬è™«åç§°
	æ³¨æ„ï¼šåº”åœ¨spidersæ–‡ä»¶å¤¹å†…æ‰§è¡Œ
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>3.scrapyæ¶æ„ç»„æˆ</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>	ï¼ˆ1ï¼‰å¼•æ“ â€â€â€ã€‹è‡ªåŠ¨è¿è¡Œï¼Œæ— éœ€å…³æ³¨ï¼Œä¼šè‡ªåŠ¨ç»„ç»‡æ‰€æœ‰çš„è¯·æ±‚å¯¹è±¡ï¼Œåˆ†å‘ç»™ä¸‹è½½å™¨
	ï¼ˆ2ï¼‰ä¸‹è½½å™¨ â€â€â€ã€‹ä»å¼•æ“å¤„è·å–åˆ°è¯·æ±‚å¯¹è±¡åï¼Œè¯·æ±‚æ•°æ®
	ï¼ˆ3ï¼‰spiders â€â€â€ã€‹Spiderç±»å®šä¹‰äº†å¦‚ä½•çˆ¬å–æŸä¸ª(æˆ–æŸäº›)ç½‘ç«™ã€‚åŒ…æ‹¬äº†çˆ¬å–çš„åŠ¨ä½œ(ä¾‹å¦‚:æ˜¯å¦è·Ÿè¿›é“¾æ¥)ä»¥åŠå¦‚ä½•ä»ç½‘é¡µçš„å†…å®¹ä¸­æå–ç»“æ„åŒ–æ•°æ®(çˆ¬å–item)ã€‚ æ¢å¥è¯è¯´ï¼ŒSpiderå°±æ˜¯æ‚¨å®šä¹‰çˆ¬å–çš„åŠ¨ä½œåŠåˆ†ææŸä¸ªç½‘é¡µ(æˆ–è€…æ˜¯æœ‰äº›ç½‘é¡µ)çš„åœ°æ–¹ã€‚
	ï¼ˆ4ï¼‰è°ƒåº¦å™¨ â€â€â€ã€‹æœ‰è‡ªå·±çš„è°ƒåº¦è§„åˆ™ï¼Œæ— éœ€å…³æ³¨
	ï¼ˆ5ï¼‰ç®¡é“ï¼ˆItem pipelineï¼‰ â€â€â€ã€‹æœ€ç»ˆå¤„ç†æ•°æ®çš„ç®¡é“ï¼Œä¼šé¢„ç•™æ¥å£ä¾›æˆ‘ä»¬å¤„ç†æ•°æ®
å½“Itemåœ¨Spiderä¸­è¢«æ”¶é›†ä¹‹åï¼Œå®ƒå°†ä¼šè¢«ä¼ é€’åˆ°Item Pipelineï¼Œä¸€äº›ç»„ä»¶ä¼šæŒ‰ç…§ä¸€å®šçš„é¡ºåºæ‰§è¡Œå¯¹Itemçš„å¤„ç†ã€‚
æ¯ä¸ªitem pipelineç»„ä»¶(æœ‰æ—¶ç§°ä¹‹ä¸ºâ€œItem Pipelineâ€)æ˜¯å®ç°äº†ç®€å•æ–¹æ³•çš„Pythonç±»ã€‚ä»–ä»¬æ¥æ”¶åˆ°Itemå¹¶é€šè¿‡å®ƒæ‰§è¡Œ
ä¸€äº›è¡Œä¸ºï¼ŒåŒæ—¶ä¹Ÿå†³å®šæ­¤Itemæ˜¯å¦ç»§ç»­é€šè¿‡pipelineï¼Œæˆ–æ˜¯è¢«ä¸¢å¼ƒè€Œä¸å†è¿›è¡Œå¤„ç†ã€‚
		ä»¥ä¸‹æ˜¯item pipelineçš„ä¸€äº›å…¸å‹åº”ç”¨ï¼š
				1. æ¸…ç†HTMLæ•°æ®
				2. éªŒè¯çˆ¬å–çš„æ•°æ®(æ£€æŸ¥itemåŒ…å«æŸäº›å­—æ®µ)
				3. æŸ¥é‡(å¹¶ä¸¢å¼ƒ)
				4. å°†çˆ¬å–ç»“æœä¿å­˜åˆ°æ•°æ®åº“ä¸­
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>4.scrapyå·¥ä½œåŸç†</strong></p>

<p><img src="https://procon-note.oss-cn-guangzhou.aliyuncs.com/typora/image-20230410151719563.png" alt="image-20230410151719563" /></p>

<h2 id="2scrapy-shell">2.scrapy shell</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>1.ä»€ä¹ˆæ˜¯scrapy shellï¼Ÿ
	Scrapyç»ˆç«¯ï¼Œæ˜¯ä¸€ä¸ªäº¤äº’ç»ˆç«¯ï¼Œä¾›æ‚¨åœ¨æœªå¯åŠ¨spiderçš„æƒ…å†µä¸‹å°è¯•åŠè°ƒè¯•æ‚¨çš„çˆ¬å–ä»£ç ã€‚ å…¶æœ¬æ„æ˜¯ç”¨æ¥æµ‹è¯•æå–æ•°æ®çš„ä»£ç ï¼Œä¸è¿‡æ‚¨å¯ä»¥å°†å…¶ä½œä¸ºæ­£å¸¸çš„Pythonç»ˆç«¯ï¼Œåœ¨ä¸Šé¢æµ‹è¯•ä»»ä½•çš„Pythonä»£ç ã€‚
	è¯¥ç»ˆç«¯æ˜¯ç”¨æ¥æµ‹è¯•XPathæˆ–CSSè¡¨è¾¾å¼ï¼ŒæŸ¥çœ‹ä»–ä»¬çš„å·¥ä½œæ–¹å¼åŠä»çˆ¬å–çš„ç½‘é¡µä¸­æå–çš„æ•°æ®ã€‚ åœ¨ç¼–å†™æ‚¨çš„spideræ—¶ï¼Œè¯¥ç»ˆç«¯æä¾›äº†äº¤äº’æ€§æµ‹è¯•æ‚¨çš„è¡¨è¾¾å¼ä»£ç çš„åŠŸèƒ½ï¼Œå…å»äº†æ¯æ¬¡ä¿®æ”¹åè¿è¡Œspiderçš„éº»çƒ¦ã€‚
	ä¸€æ—¦ç†Ÿæ‚‰äº†Scrapyç»ˆç«¯åï¼Œæ‚¨ä¼šå‘ç°å…¶åœ¨å¼€å‘å’Œè°ƒè¯•spideræ—¶å‘æŒ¥çš„å·¨å¤§ä½œç”¨ã€‚

</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>2.å®‰è£…ipython
	å®‰è£…ï¼špip install ipython
	ç®€ä»‹ï¼šå¦‚æœæ‚¨å®‰è£…äº† IPython ï¼ŒScrapyç»ˆç«¯å°†ä½¿ç”¨ IPython (æ›¿ä»£æ ‡å‡†Pythonç»ˆç«¯)ã€‚ IPython ç»ˆç«¯ä¸å…¶ä»–ç›¸
æ¯”æ›´ä¸ºå¼ºå¤§ï¼Œæä¾›æ™ºèƒ½çš„è‡ªåŠ¨è¡¥å…¨ï¼Œé«˜äº®è¾“å‡ºï¼ŒåŠå…¶ä»–ç‰¹æ€§ã€‚
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre>3.åº”ç”¨ï¼š ï¼ˆ1ï¼‰scrapy shell www.baidu.com
		ï¼ˆ2ï¼‰scrapy shell http://www.baidu.com
		 (3) scrapy shell "http://www.baidu.com"
		 (4) scrapy shell "www.baidu.com"
  è¯­æ³•ï¼š
  		ï¼ˆ1ï¼‰responseå¯¹è±¡ï¼š
					response.body
					response.text
					response.url
					response.status
		ï¼ˆ2ï¼‰responseçš„è§£æï¼š
					response.xpath() ï¼ˆå¸¸ç”¨ï¼‰
							ä½¿ç”¨xpathè·¯å¾„æŸ¥è¯¢ç‰¹å®šå…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªselectoråˆ—è¡¨å¯¹è±¡
					response.css()
							ä½¿ç”¨css_selectoræŸ¥è¯¢å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªselectoråˆ—è¡¨å¯¹è±¡
							è·å–å†…å®¹ ï¼šresponse.css('#su::text').extract_first()
							è·å–å±æ€§ ï¼šresponse.css('#su::attr(â€œvalueâ€)').extract_first()
		ï¼ˆ3ï¼‰selectorå¯¹è±¡ï¼ˆé€šè¿‡xpathæ–¹æ³•è°ƒç”¨è¿”å›çš„æ˜¯seletoråˆ—è¡¨ï¼‰
					extract()
								æå–selectorå¯¹è±¡çš„å€¼
								å¦‚æœæå–ä¸åˆ°å€¼ é‚£ä¹ˆä¼šæŠ¥é”™
								ä½¿ç”¨xpathè¯·æ±‚åˆ°çš„å¯¹è±¡æ˜¯ä¸€ä¸ªselectorå¯¹è±¡ï¼Œéœ€è¦è¿›ä¸€æ­¥ä½¿ç”¨extract()æ–¹æ³•æ‹†åŒ…ï¼Œè½¬æ¢ä¸º									unicodeå­—ç¬¦ä¸²
					extract_first()
								æå–seletoråˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå€¼
								å¦‚æœæå–ä¸åˆ°å€¼ ä¼šè¿”å›ä¸€ä¸ªç©ºå€¼
								è¿”å›ç¬¬ä¸€ä¸ªè§£æåˆ°çš„å€¼ï¼Œå¦‚æœåˆ—è¡¨ä¸ºç©ºï¼Œæ­¤ç§æ–¹æ³•ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œä¼šè¿”å›ä¸€ä¸ªç©ºå€¼
					xpath()
					css()
								æ³¨æ„ï¼šæ¯ä¸€ä¸ªselectorå¯¹è±¡å¯ä»¥å†æ¬¡çš„å»ä½¿ç”¨xpathæˆ–è€…cssæ–¹æ³•

</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="3yield">3.yield</h2>

<ol>
  <li>å¸¦æœ‰ yield çš„å‡½æ•°ä¸å†æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œè€Œæ˜¯ä¸€ä¸ªç”Ÿæˆå™¨generatorï¼Œå¯ç”¨äºè¿­ä»£</li>
  <li>
    <p>yield æ˜¯ä¸€ä¸ªç±»ä¼¼ return çš„å…³é”®å­—ï¼Œè¿­ä»£ä¸€æ¬¡é‡åˆ°yieldæ—¶å°±è¿”å›yieldåé¢(å³è¾¹)çš„å€¼ã€‚é‡ç‚¹æ˜¯ï¼šä¸‹ä¸€æ¬¡è¿­ä»£ æ—¶ï¼Œä»ä¸Šä¸€æ¬¡è¿­ä»£é‡åˆ°çš„yieldåé¢çš„ä»£ç (ä¸‹ä¸€è¡Œ)å¼€å§‹æ‰§è¡Œ</p>
  </li>
  <li>ç®€è¦ç†è§£ï¼šyieldå°±æ˜¯ return è¿”å›ä¸€ä¸ªå€¼ï¼Œå¹¶ä¸”è®°ä½è¿™ä¸ªè¿”å›çš„ä½ç½®ï¼Œä¸‹æ¬¡è¿­ä»£å°±ä»è¿™ä¸ªä½ç½®å(ä¸‹ä¸€è¡Œ)å¼€å§‹</li>
</ol>

<h2 id="4pymysqlçš„ä½¿ç”¨æ­¥éª¤">4.pymysqlçš„ä½¿ç”¨æ­¥éª¤</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>1.pip install pymysql
2.pymysql.connect(host,port,user,password,db,charset)
3.conn.cursor()
4.cursor.execute()
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="5crawlspider">5.CrawlSpider</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>1.ç»§æ‰¿è‡ªscrapy.Spider
2.ç‹¬é—¨ç§˜ç¬ˆ
	CrawlSpiderå¯ä»¥å®šä¹‰è§„åˆ™ï¼Œå†è§£æhtmlå†…å®¹çš„æ—¶å€™ï¼Œå¯ä»¥æ ¹æ®é“¾æ¥è§„åˆ™æå–å‡ºæŒ‡å®šçš„é“¾æ¥ï¼Œç„¶åå†å‘è¿™äº›é“¾æ¥å‘é€è¯·æ±‚
	æ‰€ä»¥ï¼Œå¦‚æœæœ‰éœ€è¦è·Ÿè¿›é“¾æ¥çš„éœ€æ±‚ï¼Œæ„æ€å°±æ˜¯çˆ¬å–äº†ç½‘é¡µä¹‹åï¼Œéœ€è¦æå–é“¾æ¥å†æ¬¡çˆ¬å–ï¼Œä½¿ç”¨CrawlSpideræ˜¯éå¸¸åˆé€‚çš„
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>3.æå–é“¾æ¥
	é“¾æ¥æå–å™¨ï¼Œåœ¨è¿™é‡Œå°±å¯ä»¥å†™è§„åˆ™æå–æŒ‡å®šé“¾æ¥
scrapy.linkextractors.LinkExtractor(
	allow = (), 			# æ­£åˆ™è¡¨è¾¾å¼ æå–ç¬¦åˆæ­£åˆ™çš„é“¾æ¥
	deny = (), 				# (ä¸ç”¨)æ­£åˆ™è¡¨è¾¾å¼ ä¸æå–ç¬¦åˆæ­£åˆ™çš„é“¾æ¥
	allow_domains = (), 	# ï¼ˆä¸ç”¨ï¼‰å…è®¸çš„åŸŸå
	deny_domains = (),  	# ï¼ˆä¸ç”¨ï¼‰ä¸å…è®¸çš„åŸŸå
	restrict_xpaths = (), 	# xpathï¼Œæå–ç¬¦åˆxpathè§„åˆ™çš„é“¾æ¥
	restrict_css = () 		# æå–ç¬¦åˆé€‰æ‹©å™¨è§„åˆ™çš„é“¾æ¥)
4.æ¨¡æ‹Ÿä½¿ç”¨
		æ­£åˆ™ç”¨æ³•ï¼šlinks1 = LinkExtractor(allow=r'list_23_\d+\.html')
		xpathç”¨æ³•ï¼šlinks2 = LinkExtractor(restrict_xpaths=r'//div[@class="x"]')
		cssç”¨æ³•ï¼šlinks3 = LinkExtractor(restrict_css='.x')
5.æå–è¿æ¥
		link.extract_links(response)
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>6.æ³¨æ„äº‹é¡¹
	ã€æ³¨1ã€‘callbackåªèƒ½å†™å‡½æ•°åå­—ç¬¦ä¸², callback='parse_item'
	ã€æ³¨2ã€‘åœ¨åŸºæœ¬çš„spiderä¸­ï¼Œå¦‚æœé‡æ–°å‘é€è¯·æ±‚ï¼Œé‚£é‡Œçš„callbackå†™çš„æ˜¯ callback=self.parse_item ã€æ³¨â€â€ç¨åçœ‹ã€‘follow=true æ˜¯å¦è·Ÿè¿› å°±æ˜¯æŒ‰ç…§æå–è¿æ¥è§„åˆ™è¿›è¡Œæå–
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¿è¡ŒåŸç†ï¼š</p>

<p><img src="https://procon-note.oss-cn-guangzhou.aliyuncs.com/typora/image-20230410152841465.png" alt="image-20230410152841465" /></p>

<h2 id="6crawlspideræ¡ˆä¾‹">6.CrawlSpideræ¡ˆä¾‹</h2>

<p>éœ€æ±‚ï¼šè¯»ä¹¦ç½‘æ•°æ®å…¥åº“</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>1.åˆ›å»ºé¡¹ç›®ï¼šscrapy startproject dushuproject
2.è·³è½¬åˆ°spidersè·¯å¾„ cd\dushuproject\dushuproject\spiders
3.åˆ›å»ºçˆ¬è™«ç±»ï¼šscrapy genspider â€t crawl read www.dushu.com
4.items
5.spiders
6.settings
7.pipelines
		æ•°æ®ä¿å­˜åˆ°æœ¬åœ°
		æ•°æ®ä¿å­˜åˆ°mysqlæ•°æ®åº“

</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="7æ•°æ®å…¥åº“">7.æ•°æ®å…¥åº“</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td><td class="rouge-code"><pre><span class="err">ï¼ˆ</span><span class="mi">1</span><span class="err">ï¼‰</span><span class="n">settingsé…ç½®å‚æ•°</span><span class="err">ï¼š</span>
			<span class="n">DB_HOST</span> <span class="o">=</span> <span class="sh">'</span><span class="s">192.168.231.128</span><span class="sh">'</span>
			<span class="n">DB_PORT</span> <span class="o">=</span> <span class="mi">3306</span>
			<span class="n">DB_USER</span> <span class="o">=</span> <span class="sh">'</span><span class="s">root</span><span class="sh">'</span>
			<span class="n">DB_PASSWORD</span> <span class="o">=</span> <span class="sh">'</span><span class="s">1234</span><span class="sh">'</span>
			<span class="n">DB_NAME</span> <span class="o">=</span> <span class="sh">'</span><span class="s">test</span><span class="sh">'</span>
			<span class="n">DB_CHARSET</span> <span class="o">=</span> <span class="sh">'</span><span class="s">utf8</span><span class="sh">'</span>
<span class="err">ï¼ˆ</span><span class="mi">2</span><span class="err">ï¼‰</span><span class="n">ç®¡é“é…ç½®</span>
			<span class="kn">from</span> <span class="n">scrapy.utils.project</span> <span class="kn">import</span> <span class="n">get_project_settings</span>
			<span class="kn">import</span> <span class="n">pymysql</span>
			<span class="k">class</span> <span class="nc">MysqlPipeline</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
			<span class="c1">#__init__æ–¹æ³•å’Œopen_spiderçš„ä½œç”¨æ˜¯ä¸€æ ·çš„
</span>			<span class="c1">#initæ˜¯è·å–settingsä¸­çš„è¿æ¥å‚æ•°
</span>				<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
					<span class="n">settings</span> <span class="o">=</span> <span class="nf">get_project_settings</span><span class="p">()</span>
					<span class="n">self</span><span class="p">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="sh">'</span><span class="s">DB_HOST</span><span class="sh">'</span><span class="p">]</span>
					<span class="n">self</span><span class="p">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="sh">'</span><span class="s">DB_PORT</span><span class="sh">'</span><span class="p">]</span>
					<span class="n">self</span><span class="p">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="sh">'</span><span class="s">DB_USER</span><span class="sh">'</span><span class="p">]</span>
					<span class="n">self</span><span class="p">.</span><span class="n">pwd</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="sh">'</span><span class="s">DB_PWD</span><span class="sh">'</span><span class="p">]</span>
					<span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="sh">'</span><span class="s">DB_NAME</span><span class="sh">'</span><span class="p">]</span>
					<span class="n">self</span><span class="p">.</span><span class="n">charset</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="sh">'</span><span class="s">DB_CHARSET</span><span class="sh">'</span><span class="p">]</span>
					<span class="n">self</span><span class="p">.</span><span class="nf">connect</span><span class="p">()</span>
			<span class="c1"># è¿æ¥æ•°æ®åº“å¹¶ä¸”è·å–cursorå¯¹è±¡
</span>				<span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
					<span class="n">self</span><span class="p">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">pymysql</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">port</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">user</span><span class="p">,</span>
												<span class="n">password</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">pwd</span><span class="p">,</span><span class="n">db</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="n">charset</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">charset</span><span class="p">)</span>
					<span class="n">self</span><span class="p">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">conn</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
				<span class="k">def</span> <span class="nf">process_item</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
					<span class="n">sql</span> <span class="o">=</span> <span class="sh">'</span><span class="s">insert into book(image_url, book_name, author, info) values(</span><span class="sh">"</span><span class="s">%s</span><span class="sh">"</span><span class="s">,</span><span class="sh">"</span><span class="s">%s</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">%s</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">%s</span><span class="sh">"</span><span class="s">)</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">image_url</span><span class="sh">'</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">book_name</span><span class="sh">'</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">author</span><span class="sh">'</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">info</span><span class="sh">'</span><span class="p">])</span>
					<span class="n">sql</span> <span class="o">=</span> <span class="sh">'</span><span class="s">insert into book(image_url,book_name,author,info) values
(</span><span class="sh">"</span><span class="s">{}</span><span class="sh">"</span><span class="s">,</span><span class="sh">"</span><span class="s">{}</span><span class="sh">"</span><span class="s">,</span><span class="sh">"</span><span class="s">{}</span><span class="sh">"</span><span class="s">,</span><span class="sh">"</span><span class="s">{}</span><span class="sh">"</span><span class="s">)</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">image_url</span><span class="sh">'</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">book_name</span><span class="sh">'</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">author</span><span class="sh">'</span><span class="p">],</span>
<span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">info</span><span class="sh">'</span><span class="p">])</span>
<span class="c1"># æ‰§è¡Œsqlè¯­å¥
</span>					<span class="n">self</span><span class="p">.</span><span class="n">cursor</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
					<span class="n">self</span><span class="p">.</span><span class="n">conn</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
					<span class="k">return</span> <span class="n">item</span>
				<span class="k">def</span> <span class="nf">close_spider</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
					<span class="n">self</span><span class="p">.</span><span class="n">conn</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
					<span class="n">self</span><span class="p">.</span><span class="n">cursor</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="8æ—¥å¿—ä¿¡æ¯å’Œæ—¥å¿—ç­‰çº§">8.æ—¥å¿—ä¿¡æ¯å’Œæ—¥å¿—ç­‰çº§</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>ï¼ˆ1ï¼‰æ—¥å¿—çº§åˆ«ï¼š
		CRITICALï¼šä¸¥é‡é”™è¯¯
		ERRORï¼š ä¸€èˆ¬é”™è¯¯
		WARNINGï¼š è­¦å‘Š
		INFO: ä¸€èˆ¬ä¿¡æ¯
		DEBUGï¼š è°ƒè¯•ä¿¡æ¯
		é»˜è®¤çš„æ—¥å¿—ç­‰çº§æ˜¯DEBUG
		åªè¦å‡ºç°äº†DEBUGæˆ–è€…DEBUGä»¥ä¸Šç­‰çº§çš„æ—¥å¿—
		é‚£ä¹ˆè¿™äº›æ—¥å¿—å°†ä¼šæ‰“å°
ï¼ˆ2ï¼‰settings.pyæ–‡ä»¶è®¾ç½®ï¼š
		é»˜è®¤çš„çº§åˆ«ä¸ºDEBUGï¼Œä¼šæ˜¾ç¤ºä¸Šé¢æ‰€æœ‰çš„ä¿¡æ¯
		åœ¨é…ç½®æ–‡ä»¶ä¸­ settings.py
		LOG_FILE : å°†å±å¹•æ˜¾ç¤ºçš„ä¿¡æ¯å…¨éƒ¨è®°å½•åˆ°æ–‡ä»¶ä¸­ï¼Œå±å¹•ä¸å†æ˜¾ç¤ºï¼Œæ³¨æ„æ–‡ä»¶åç¼€ä¸€å®šæ˜¯.log
		LOG_LEVEL : è®¾ç½®æ—¥å¿—æ˜¾ç¤ºçš„ç­‰çº§ï¼Œå°±æ˜¯æ˜¾ç¤ºå“ªäº›ï¼Œä¸æ˜¾ç¤ºå“ªäº›

</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="9scrapyçš„postè¯·æ±‚">9.scrapyçš„postè¯·æ±‚</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>ï¼ˆ1ï¼‰é‡å†™start_requestsæ–¹æ³•ï¼š
		def start_requests(self)
(2) start_requestsçš„è¿”å›å€¼ï¼š
		scrapy.FormRequest(url=url, headers=headers, callback=self.parse_item, formdata=data)
				url: è¦å‘é€çš„poståœ°å€
				headersï¼šå¯ä»¥å®šåˆ¶å¤´ä¿¡æ¯
				callback: å›è°ƒå‡½æ•°
				formdata: postæ‰€æºå¸¦çš„æ•°æ®ï¼Œè¿™æ˜¯ä¸€ä¸ªå­—å…¸	
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="10ä»£ç†">10.ä»£ç†</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>ï¼ˆ1ï¼‰åˆ°settings.pyä¸­ï¼Œæ‰“å¼€ä¸€ä¸ªé€‰é¡¹
	DOWNLOADER_MIDDLEWARES = {
		'postproject.middlewares.Proxy': 543,
	}
ï¼ˆ2ï¼‰åˆ°middlewares.pyä¸­å†™ä»£ç 
	def process_request(self, request, spider):
		request.meta['proxy'] = 'https://113.68.202.10:9999'
		return None
</pre></td></tr></tbody></table></code></pre></div></div>



                <hr style="visibility: hidden;">
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2020/04/01/python%E5%9F%BA%E7%A1%80/" data-toggle="tooltip" data-placement="top" title="pythonåŸºç¡€">
                        Previous<br>
                        <span>pythonåŸºç¡€</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2020/07/01/JetBrains-Idea%E5%BF%AB%E6%8D%B7%E9%94%AE/" data-toggle="tooltip" data-placement="top" title="Jetbrains Ideaå¿«æ·é”®">
                        Next<br>
                        <span>Jetbrains Ideaå¿«æ·é”®</span>
                        </a>
                    </li>
                    
                </ul>
                <hr style="visibility: hidden;">

                <!-- Gitalk è¯„è®º start  -->
                
                <!-- Link Gitalk çš„æ”¯æŒæ–‡ä»¶  -->
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
                <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

                <div id="gitalk-container"></div>
                <script type="text/javascript">
                    var gitalk = new Gitalk({

                        // gitalkçš„ä¸»è¦å‚æ•°
                        clientID: '2542452a44c3a8034a35',
                        clientSecret: '3119b189eb567a7a89c2440917078889d1689226',
                        repo: 'xprocon.github.io',
                        owner: 'xprocon',
                        admin: ['xprocon'],
                        id: 'post',
                        distractionFreeMode: true,  //æ˜¯å¦å¯ç”¨è¯„è®ºå…¨å±é®ç½©.
                        createIssueManually: true, //å¦‚æœå½“å‰é¡µé¢æ²¡æœ‰ç›¸åº”çš„ isssue ï¼Œä¸”ç™»å½•çš„ç”¨æˆ·å±äº adminï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ›å»º issueã€‚å¦‚æœè®¾ç½®ä¸º trueï¼Œåˆ™æ˜¾ç¤ºä¸€ä¸ªåˆå§‹åŒ–é¡µé¢ï¼Œåˆ›å»º issue éœ€è¦ç‚¹å‡» init æŒ‰é’®ã€‚
                        perPage: 15 //æ¯é¡µå¤šå°‘ä¸ªè¯„è®º
                    });
                    gitalk.render('gitalk-container');
                </script>
                
                <!-- Gitalk end -->

                

                
            </div>  

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                


<section>
    
        <hr class="hidden-sm hidden-xs">
    
    <h5><a href="/archive/">FEATURED TAGS</a></h5>
    <div class="tags">
        
        
        
        
        
        
                <a data-sort="0042" 
                    href="/archive/?tag=Java"
                    title="Java"
                    rel="6">Java</a>
        
                <a data-sort="0032" 
                    href="/archive/?tag=linux"
                    title="linux"
                    rel="16">linux</a>
        
                <a data-sort="0035" 
                    href="/archive/?tag=%E8%BF%90%E7%BB%B4"
                    title="è¿ç»´"
                    rel="13">è¿ç»´</a>
        
                <a data-sort="0036" 
                    href="/archive/?tag=%E5%AD%A6%E4%B9%A0"
                    title="å­¦ä¹ "
                    rel="12">å­¦ä¹ </a>
        
                <a data-sort="0037" 
                    href="/archive/?tag=java"
                    title="java"
                    rel="11">java</a>
        
                <a data-sort="0039" 
                    href="/archive/?tag=centos"
                    title="centos"
                    rel="9">centos</a>
        
                <a data-sort="0043" 
                    href="/archive/?tag=%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"
                    title="å¼€å‘ç¯å¢ƒ"
                    rel="5">å¼€å‘ç¯å¢ƒ</a>
        
                <a data-sort="0043" 
                    href="/archive/?tag=nginx"
                    title="nginx"
                    rel="5">nginx</a>
        
                <a data-sort="0044" 
                    href="/archive/?tag=%E5%AE%B9%E5%99%A8%E5%8C%96"
                    title="å®¹å™¨åŒ–"
                    rel="4">å®¹å™¨åŒ–</a>
        
                <a data-sort="0044" 
                    href="/archive/?tag=git"
                    title="git"
                    rel="4">git</a>
        
                <a data-sort="0044" 
                    href="/archive/?tag=spring"
                    title="spring"
                    rel="4">spring</a>
        
                <a data-sort="0045" 
                    href="/archive/?tag=%E4%BA%91%E5%8E%9F%E7%94%9F"
                    title="äº‘åŸç”Ÿ"
                    rel="3">äº‘åŸç”Ÿ</a>
        
                <a data-sort="0045" 
                    href="/archive/?tag=%E5%9F%BA%E7%A1%80"
                    title="åŸºç¡€"
                    rel="3">åŸºç¡€</a>
        
                <a data-sort="0045" 
                    href="/archive/?tag=jetbrains"
                    title="jetbrains"
                    rel="3">jetbrains</a>
        
                <a data-sort="0045" 
                    href="/archive/?tag=python"
                    title="python"
                    rel="3">python</a>
    </div>
</section>


                <!-- Friends Blog -->
                
<hr>
<h5>FRIENDS</h5>
<ul class="list-inline">
  
  <li><a href="https://www.baidu.com/">ç™¾åº¦ï¼ˆbaiduï¼‰</a></li>
  
  <li><a href="http://10.175.194.215:8080/">ITå·¥å…·ç®±ï¼ˆittoolsï¼‰</a></li>
  
  <li><a href="https://www.emojiall.com/zh-hans">emojiï¼ˆemojiæœç´¢ï¼‰</a></li>
  
  <li><a href="https://www.v2ex.com/">v2exï¼ˆv2exè®ºå›ï¼‰</a></li>
  
  <li><a href="https://www.reddit.com/r/China_irl/">redditï¼ˆæµæµªé˜²åŒºï¼‰</a></li>
  
</ul>

            </div>
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->









<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'right',
          // icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                


<ul class="list-inline text-center">


  
  
  <li>
    <a href="https://twitter.com/xprocon">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  <li>
    <a target="_blank" href="https://www.zhihu.com/people/procon">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa  fa-stack-1x fa-inverse">çŸ¥</i>
      </span>
    </a>
  </li>
  
  
  <li>
    <a target="_blank" href="http://weibo.com/huangpuguang1ni">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  
  <li>
    <a target="_blank" href="https://github.com/xprocon">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
</ul>

                <p class="copyright text-muted">
                    Copyright &copy; Procon's Tech Life Blog 2024
                    <br>
                    Powered by <a href="https://blog.procon.cc">Procon Blog</a>
<!--                    <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="100px"-->
<!--                        height="20px"-->
<!--                        src="https://ghbtns.com/github-btn.html?user=huxpro&repo=huxpro.github.io&type=star&count=true">-->
<!--                    </iframe>-->
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>

<!-- Simple Jekyll Search -->
<script src="/js/simple-jekyll-search.min.js"></script>

<!-- Service Worker -->


<!-- async load function -->
<script>
    function async(u, c) {
        var d = document, t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
        s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->







<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function () {
        var $nav = document.querySelector("nav");
        if ($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->



<!-- Baidu Tongji -->



<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog(selector) {

        // interop with multilangual 
        if ('' == 'true') {
            _containerSelector = 'div.post-container.active'
        } else {
            _containerSelector = 'div.post-container'
        }

        // init
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        // clean
        $(selector).html('')

        // appending
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>



<!-- Multi-Lingual -->


<!-- Simple Jekyll Search -->
<script>
    // https://stackoverflow.com/questions/1912501/unescape-html-entities-in-javascript
    function htmlDecode(input) {
        var e = document.createElement('textarea');
        e.innerHTML = input;
        // handle case of empty input
        return e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
    }

    SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('search-results'),
        json: '/search.json',
        searchResultTemplate: '<div class="post-preview item"><a href="{url}"><h2 class="post-title">{title}</h2><h3 class="post-subtitle">{subtitle}</h3><hr></a></div>',
        noResultsText: 'No results',
        limit: 50,
        fuzzy: false,
        // a hack to get escaped subtitle unescaped. for some reason, 
        // post.subtitle w/o escape filter nuke entire search.
        templateMiddleware: function (prop, value, template) {
            if (prop === 'subtitle' || prop === 'title') {
                if (value.indexOf("code")) {
                    return htmlDecode(value);
                } else {
                    return value;
                }
            }
        }
    });

    $(document).ready(function () {
        var $searchPage = $('.search-page');
        var $searchOpen = $('.search-icon');
        var $searchClose = $('.search-icon-close');
        var $searchInput = $('#search-input');
        var $body = $('body');

        $searchOpen.on('click', function (e) {
            e.preventDefault();
            $searchPage.toggleClass('search-active');
            var prevClasses = $body.attr('class') || '';
            setTimeout(function () {
                $body.addClass('no-scroll');
            }, 400)

            if ($searchPage.hasClass('search-active')) {
                $searchClose.on('click', function (e) {
                    e.preventDefault();
                    $searchPage.removeClass('search-active');
                    $body.attr('class', prevClasses);  // from closure 
                });
                $searchInput.focus();
            }
        });
    });
</script>


<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
