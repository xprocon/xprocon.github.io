<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="这里是 @Procon普光 的个人博客，与你一起发现更大的世界">
    <meta name="keywords" content="普光, Procon普光, 博客, 个人网站, 互联网, Java , 后端">
    <meta name="theme-color" content="#000000">

    <!-- Open Graph -->
    <meta property="og:title"
        content="python爬虫 - Procon's Tech Life Blog">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="Urllib
">
    
    <meta property="article:published_time" content=" 2020-04-06T12:00:00Z">
    
    
    <meta property="article:author" content="Procon">
    
    
    <meta property="article:tag" content="python">
    
    <meta property="article:tag" content="爬虫">
    
    
    <meta property="og:image" content="https://blog.procon.cchttps://procon-note.oss-cn-guangzhou.aliyuncs.com/typora/avatar_m.jpg">
    <meta property="og:url" content="https://blog.procon.cc/2020/04/06/python%E7%88%AC%E8%99%AB/">
    <meta property="og:site_name" content="Procon's Tech Life Blog">

    <title>python爬虫 - Procon's Tech Life Blog</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://blog.procon.cc/2020/04/06/python%E7%88%AC%E8%99%AB/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href=" /css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href=" /css/hux-blog.min.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet"
        type="text/css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>

    <!-- Google AdSense -->
    <script data-ad-client="ca-pub-6487568398225121" async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->

<nav class="navbar navbar-default navbar-custom navbar-fixed-top invert">
    
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Procon's Tech Life Blog</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div id="huxblog_navbar">
                <div class="navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="/">Home</a>
                        </li>
                        
                        
                        
                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                        
                        
                        <li>
                            <a href="/archive/">Archive</a>
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <li class="search-icon">
                            <a href="javascript:void(0)">
                                <i class="fa fa-search"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <script>
        // Drop Bootstarp low-performance Navbar
        // Use customize navbar with high-quality material design animation
        // in high-perf jank-free CSS3 implementation
        var $body = document.body;
        var $toggle = document.querySelector('.navbar-toggle');
        var $navbar = document.querySelector('#huxblog_navbar');
        var $collapse = document.querySelector('.navbar-collapse');

        var __HuxNav__ = {
            close: function () {
                $navbar.className = " ";
                // wait until animation end.
                setTimeout(function () {
                    // prevent frequently toggle
                    if ($navbar.className.indexOf('in') < 0) {
                        $collapse.style.height = "0px"
                    }
                }, 400)
            },
            open: function () {
                $collapse.style.height = "auto"
                $navbar.className += " in";
            }
        }

        // Bind Event
        $toggle.addEventListener('click', function (e) {
            if ($navbar.className.indexOf('in') > 0) {
                __HuxNav__.close()
            } else {
                __HuxNav__.open()
            }
        })

        /**
         * Since Fastclick is used to delegate 'touchstart' globally
         * to hack 300ms delay in iOS by performing a fake 'click',
         * Using 'e.stopPropagation' to stop 'touchstart' event from 
         * $toggle/$collapse will break global delegation.
         * 
         * Instead, we use a 'e.target' filter to prevent handler
         * added to document close HuxNav.  
         *
         * Also, we use 'click' instead of 'touchstart' as compromise
         */
        document.addEventListener('click', function (e) {
            if (e.target == $toggle) return;
            if (e.target.className == 'icon-bar') return;
            __HuxNav__.close();
        })
    </script>
    <!-- Search -->
<div class="search-page">
  <div class="search-icon-close-container">
    <span class="search-icon-close">
      <i class="fa fa-chevron-down"></i>
    </span>
  </div>
  <div class="search-main container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <form></form>
        <input type="text" id="search-input" placeholder="$ grep...">
        </form>
        <div id="search-results" class="mini-post-list"></div>
      </div>
    </div>
  </div>
</div>

    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/home-bg-geek.jpg" width="0" height="0"> -->

<!-- Post Header -->



<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/home-bg-geek.jpg');
        background: ;
    }

    
</style>




<header class="intro-header style-text" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=python" title="python">python</a>
                        
                        <a class="tag" href="/archive/?tag=%E7%88%AC%E8%99%AB" title="爬虫">爬虫</a>
                        
                    </div>
                    <h1>python爬虫</h1>
                    
                    <h2 class="subheading"></h2>
                    <span class="meta">Posted by Procon on April 6, 2020</span>
                </div>
            </div>
        </div>
    </div>
</header>







<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

				<h1 id="urllib">Urllib</h1>

<h2 id="1反爬手段">1.反爬手段？</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre>1.User‐Agent：
	User Agent中文名为用户代理，简称 UA，它是一个特殊字符串头，使得服务器能够识别客户使用的操作系统及版
本、CPU 类型、浏览器及版本、浏览器渲染引擎、浏览器语言、浏览器插件等。

2.代理IP
	西次代理
	快代理
	什么是高匿名、匿名和透明代理？它们有什么区别？
		1.使用透明代理，对方服务器可以知道你使用了代理，并且也知道你的真实IP。
		2.使用匿名代理，对方服务器可以知道你使用了代理，但不知道你的真实IP。
		3.使用高匿名代理，对方服务器不知道你使用了代理，更不知道你的真实IP。
3.验证码访问
	打码平台
	云打码平台
	超级🦅
4.动态加载网页 网站返回的是js数据 并不是网页的真实数据
	selenium驱动真实的浏览器发送请求
5.数据加密
	分析js代码
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="2urllib库使用">2.urllib库使用</h2>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">urlopen</span><span class="p">()</span> <span class="n">模拟浏览器向服务器发送请求</span>
<span class="n">response</span> <span class="n">服务器返回的数据</span>
	<span class="n">response的数据类型是HttpResponse</span>
	<span class="n">字节</span><span class="err">‐‐</span><span class="o">&gt;</span><span class="n">字符串</span>
		<span class="n">解码decode</span>
	<span class="n">字符串</span><span class="err">‐‐</span><span class="o">&gt;</span><span class="n">字节</span>
		<span class="n">编码encode</span>
	<span class="nf">read</span><span class="p">()</span> <span class="n">字节形式读取二进制</span> <span class="n">扩展</span><span class="err">：</span><span class="nf">rede</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="n">返回前几个字节</span>
	<span class="nf">readline</span><span class="p">()</span> <span class="n">读取一行</span>
	<span class="nf">readlines</span><span class="p">()</span> <span class="n">一行一行读取</span> <span class="n">直至结束</span>
	<span class="nf">getcode</span><span class="p">()</span> <span class="n">获取状态码</span>
	<span class="nf">geturl</span><span class="p">()</span> <span class="n">获取url</span>
	<span class="nf">getheaders</span><span class="p">()</span> <span class="n">获取headers</span>
	<span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">urlretrieve</span><span class="p">()</span>
		<span class="n">请求网页</span>
		<span class="n">请求图片</span>
		<span class="n">请求视频</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="3请求对象的定制">3.请求对象的定制</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>UA介绍：User Agent中文名为用户代理，简称 UA，它是一个特殊字符串头，使得服务器能够识别客户使用的操作系统
及版本、CPU 类型、浏览器及版本。浏览器内核、浏览器渲染引擎、浏览器语言、浏览器插件等

语法：request = urllib.request.Request()
</pre></td></tr></tbody></table></code></pre></div></div>

<p>扩展：编码的由来</p>

<h2 id="4编解码">4.编解码</h2>

<p>1.get请求方式：urllib.parse.quote（）</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">urllib.request</span>
<span class="kn">import</span> <span class="n">urllib.parse</span>

<span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">https://www.baidu.com/s?wd=</span><span class="sh">'</span>

<span class="c1"># url的组成
# https://www.baidu.com/s?wd=周杰伦
</span>
<span class="c1"># http/https    www.baidu.com   80/443     s      wd = 周杰伦     #
#    协议             主机        端口号     路径     参数           锚点
# http   80
# https  443
# mysql  3306
# oracle 1521
# redis  6379
# mongodb 27017
</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) </span><span class="sh">'</span>
                  <span class="sh">'</span><span class="s">Chrome/111.0.0.0 Safari/537.36 Edg/111.0.1661.51</span><span class="sh">'</span>
<span class="p">}</span>

<span class="c1"># 因为urlopen方法中不能存储字典 所以headers不能传递进去
# 请求对象的定制
</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="nf">quote</span><span class="p">(</span><span class="sh">'</span><span class="s">性交</span><span class="sh">'</span><span class="p">)</span>

<span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

<span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf8</span><span class="sh">'</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>2.get请求方式：urllib.parse.urlencode（）</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre>    <span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">https://www.baidu.com/s?</span><span class="sh">'</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">小刚</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">sex</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">男</span><span class="sh">'</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) </span><span class="sh">'</span>
                      <span class="sh">'</span><span class="s">Chrome/111.0.0.0 Safari/537.36 Edg/111.0.1661.51</span><span class="sh">'</span>
    <span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="nf">urlencode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="n">data</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf8</span><span class="sh">'</span><span class="p">)</span>

    <span class="nf">print</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>3.post请求方式</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">urllib.parse</span>

<span class="kn">import</span> <span class="n">urllib.request</span>

<span class="kn">import</span> <span class="n">json</span>

<span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">https://fanyi.baidu.com/v2transapi?from=en&amp;to=zh</span><span class="sh">'</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) </span><span class="sh">'</span>
                  <span class="sh">'</span><span class="s">Chrome/111.0.0.0 Safari/537.36 Edg/111.0.1661.51</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">Cookie</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">BIDUPSID=DF9744CD34BAE05BB8671D82A507C548; PSTM=1678365929; newlogin=1; BDUSS=VhwWk9qV2ZtRzFmYndLRHBEMHJ0YlZpRWhkMDZKM295aEJYSTdISUY0Y1RaekZrSVFBQUFBJCQAAAAAAAAAAAEAAADdrDBA2K-7qML6wqXs4bniueIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABPaCWQT2glkM; BDUSS_BFESS=VhwWk9qV2ZtRzFmYndLRHBEMHJ0YlZpRWhkMDZKM295aEJYSTdISUY0Y1RaekZrSVFBQUFBJCQAAAAAAAAAAAEAAADdrDBA2K-7qML6wqXs4bniueIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABPaCWQT2glkM; BAIDUID=DF9744CD34BAE05BA1B7B38C3A014179:SL=0:NR=10:FG=1; BDORZ=B490B5EBF6F3CD402E515D22BCDA1598; BA_HECTOR=ak0h24a4240k212l2l2l858t1i1vf1q1m; ZFY=vprJv3LpLohE:BtuLaK:BL6qr1eZ3UZy27q1f4CAIHDeg:C; BAIDUID_BFESS=DF9744CD34BAE05BA1B7B38C3A014179:SL=0:NR=10:FG=1; BDRCVFR[feWj1Vr5u3D]=I67x6TjHwwYf0; PSINO=3; delPer=0; H_PS_PSSID=38185_36543_38410_38368_38403_37862_38468_38170_38290_38250_37924_38382_38040_26350_38418_38282_37881; APPGUIDE_10_0_2=1; REALTIME_TRANS_SWITCH=1; FANYI_WORD_SWITCH=1; HISTORY_SWITCH=1; SOUND_SPD_SWITCH=1; SOUND_PREFER_SWITCH=1; ab_sr=1.0.1_NDAzMGYwMzU3MTViM2Q4ODFiZWEyMzMyNWI1ZmVhOTI1ODEzMmI1MjEyMTVkYTJlZDQzNmM3MWRkMGIwNDUzNmQzMjljNmZiMTEwMmU4OTU1OTQ1Zjg0NWU2ZTU4NzQ2NzU2ZTkwNTNhMDY0NGZkNTA4ZjY4MDgxY2Y2YjRmMGQxZDYxMmMwOTY4YjliOTM4OGQwZDliZmY5OTU4NzBlOGQ1OGUyMDZiNWI1MGE3NWJmM2FiMDkwYzI0YTkwZTZi</span><span class="sh">'</span>
<span class="p">}</span>
<span class="n">keyword</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">请输入要查询的单词：</span><span class="sh">"</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">from</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">zh</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">to</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">en</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">query</span><span class="sh">'</span><span class="p">:</span> <span class="n">keyword</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">transtype</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">translang</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">simple_means_flag</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">3</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">sign</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">569746.807587</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">token</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">03b7d79aace86efda4176a7e8edef1a1</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">domain</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">common</span><span class="sh">'</span>
<span class="p">}</span>
<span class="c1"># post请求的参数  必须进行编码 并且要调用encode方法
</span><span class="n">data</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="nf">urlencode</span><span class="p">(</span><span class="n">data</span><span class="p">).</span><span class="nf">encode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span>
<span class="c1"># 请求对象的定制
</span><span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

<span class="c1"># 模拟浏览器向服务器发送请求
</span><span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="c1"># 获取响应的数据
</span><span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>总结：post和get区别？</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>1：get请求方式的参数必须编码，参数是拼接到url后面，编码之后不需要调用encode方法
2：post请求方式的参数必须编码，参数是放在请求对象定制的方法中，编码之后需要调用encode方法
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="5ajax的get请求">5.ajax的get请求</h2>

<p>案例：豆瓣电影</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
</pre></td><td class="rouge-code"><pre><span class="c1"># https://movie.douban.com/j/chart/top_list?type=5&amp;interval_id=100%3A90&amp;action=&amp;
# start=0&amp;limit=20
</span>
<span class="c1"># https://movie.douban.com/j/chart/top_list?type=5&amp;interval_id=100%3A90&amp;action=&amp;
# start=20&amp;limit=20
</span>
<span class="c1"># https://movie.douban.com/j/chart/top_list?type=5&amp;interval_id=100%3A90&amp;action=&amp;
# start=40&amp;limit=20
</span>
<span class="c1"># https://movie.douban.com/j/chart/top_list?type=5&amp;interval_id=100%3A90&amp;action=&amp;
# start=60&amp;limit=20
</span>
<span class="c1"># page    1  2   3   4
# start   0  20  40  60
</span>
<span class="c1"># start （page - 1）*20
</span>

<span class="c1"># 下载豆瓣电影前10页的数据
# （1） 请求对象的定制
# （2） 获取响应的数据
# （3） 下载数据
</span>
<span class="kn">import</span> <span class="n">urllib.parse</span>
<span class="kn">import</span> <span class="n">urllib.request</span>


<span class="k">def</span> <span class="nf">create_request</span><span class="p">(</span><span class="n">page_no</span><span class="p">):</span>
    <span class="n">base_url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">https://movie.douban.com/j/chart/top_list?type=5&amp;interval_id=100%3A90&amp;action=&amp;</span><span class="sh">'</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">start</span><span class="sh">'</span><span class="p">:</span> <span class="p">(</span><span class="n">page_no</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">20</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">limit</span><span class="sh">'</span><span class="p">:</span> <span class="mi">20</span>
    <span class="p">}</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="nf">urlencode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">base_url</span> <span class="o">+</span> <span class="n">data</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) </span><span class="sh">'</span>
                      <span class="sh">'</span><span class="s">Chrome/92.0.4515.159 Safari/537.36</span><span class="sh">'</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_content</span><span class="p">(</span><span class="n">request_obj</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">urlopen</span><span class="p">(</span><span class="n">request_obj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">down_load</span><span class="p">(</span><span class="n">page_no</span><span class="p">,</span> <span class="n">res_content</span><span class="p">):</span>
    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">douban_</span><span class="sh">'</span> <span class="o">+</span> <span class="nf">str</span><span class="p">(</span><span class="n">page_no</span><span class="p">)</span> <span class="o">+</span> <span class="sh">'</span><span class="s">.json</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">fp</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">res_content</span><span class="p">)</span>


<span class="c1"># 程序的入口
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="n">start_page</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">input</span><span class="p">(</span><span class="sh">'</span><span class="s">请输入起始的页码</span><span class="sh">'</span><span class="p">))</span>
    <span class="n">end_page</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">input</span><span class="p">(</span><span class="sh">'</span><span class="s">请输入结束的页面</span><span class="sh">'</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">start_page</span><span class="p">,</span> <span class="n">end_page</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1">#         每一页都有自己的请求对象的定制
</span>        <span class="n">request</span> <span class="o">=</span> <span class="nf">create_request</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
        <span class="c1">#         获取响应的数据
</span>        <span class="n">content</span> <span class="o">=</span> <span class="nf">get_content</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="c1">#         下载
</span>        <span class="nf">down_load</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="6ajax的post请求">6.ajax的post请求</h2>

<p>案例：KFC官网</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
</pre></td><td class="rouge-code"><pre><span class="c1"># 1页
# http://www.kfc.com.cn/kfccda/ashx/GetStoreList.ashx?op=cname
# post
# cname: 北京
# pid:
# pageIndex: 1
# pageSize: 10
</span>

<span class="c1"># 2页
# http://www.kfc.com.cn/kfccda/ashx/GetStoreList.ashx?op=cname
# post
# cname: 北京
# pid:
# pageIndex: 2
# pageSize: 10
</span>
<span class="kn">import</span> <span class="n">urllib.request</span>
<span class="kn">import</span> <span class="n">urllib.parse</span>


<span class="k">def</span> <span class="nf">create_request</span><span class="p">(</span><span class="n">page</span><span class="p">):</span>
    <span class="n">base_url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">http://www.kfc.com.cn/kfccda/ashx/GetStoreList.ashx?op=cname</span><span class="sh">'</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">cname</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">北京</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">pid</span><span class="sh">'</span><span class="p">:</span> <span class="sh">''</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">pageIndex</span><span class="sh">'</span><span class="p">:</span> <span class="n">page</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">pageSize</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">10</span><span class="sh">'</span>
    <span class="p">}</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="nf">urlencode</span><span class="p">(</span><span class="n">data</span><span class="p">).</span><span class="nf">encode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) </span><span class="sh">'</span>
                      <span class="sh">'</span><span class="s">Chrome/92.0.4515.159 Safari/537.36</span><span class="sh">'</span>
    <span class="p">}</span>

    <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">base_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">request</span>


<span class="k">def</span> <span class="nf">get_content</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">content</span>


<span class="k">def</span> <span class="nf">down_load</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">kfc_</span><span class="sh">'</span> <span class="o">+</span> <span class="nf">str</span><span class="p">(</span><span class="n">page</span><span class="p">)</span> <span class="o">+</span> <span class="sh">'</span><span class="s">.json</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">fp</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="n">start_page</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">input</span><span class="p">(</span><span class="sh">'</span><span class="s">请输入起始页码</span><span class="sh">'</span><span class="p">))</span>
    <span class="n">end_page</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">input</span><span class="p">(</span><span class="sh">'</span><span class="s">请输入结束页码</span><span class="sh">'</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">start_page</span><span class="p">,</span> <span class="n">end_page</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># 请求对象的定制
</span>        <span class="n">request</span> <span class="o">=</span> <span class="nf">create_request</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
        <span class="c1"># 获取网页源码
</span>        <span class="n">content</span> <span class="o">=</span> <span class="nf">get_content</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="c1"># 下载
</span>        <span class="nf">down_load</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="7urlerrorhttperror">7.URLError\HTTPError</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>简介:
	1.HTTPError类是URLError类的子类
	2.导入的包urllib.error.HTTPError urllib.error.URLError
	3.http错误：http错误是针对浏览器无法连接到服务器而增加出来的错误提示。引导并告诉浏览者该页是哪里出
了问题。
	4.通过urllib发送请求的时候，有可能会发送失败，这个时候如果想让你的代码更加的健壮，可以通过tryexcept
进行捕获异常，异常有两类，URLError\HTTPError
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">urllib.request</span>
<span class="kn">import</span> <span class="n">urllib.error</span>
<span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">https://blog.csdn.net/ityard/article/details/102646738</span><span class="sh">'</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) </span><span class="sh">'</span>
                  <span class="sh">'</span><span class="s">Chrome/111.0.0.0 Safari/537.36 Edg/111.0.1661.51</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">Cookie</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">uuid_tt_dd=10_30844396170-1678371350421-410462; c_adb=1; UserName=Solo_guanggaung; </span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">UserInfo=85bbd718ef3c428485beae0a3c34d10f; UserToken=85bbd718ef3c428485beae0a3c34d10f; </span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">UserNick=%E9%9A%90%E8%BA%AB%E6%89%8D%E6%98%AF%E6%9C%AC%E4%BD%93; AU=434; UN=Solo_guanggaung; </span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">BT=1678376092017; p_uid=U010000; </span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">Hm_up_6bcd52f51e9b3dce32bec4a3997715ac=%7B%22islogin%22%3A%7B%22value%22%3A%221%22%2C%22scope%22%3A1</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">%7D%2C%22isonline%22%3A%7B%22value%22%3A%221%22%2C%22scope%22%3A1%7D%2C%22isvip%22%3A%7B%22value%22%3A</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">%220%22%2C%22scope%22%3A1%7D%2C%22uid_%22%3A%7B%22value%22%3A%22Solo_guanggaung%22%2C%22scope%22%3A1</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">%7D%7D; firstDie=1; Hm_lvt_6bcd52f51e9b3dce32bec4a3997715ac=1678428902,1678886386,1679568376,</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">1679798814; Hm_ct_6bcd52f51e9b3dce32bec4a3997715ac=6525*1*10_30844396170-1678371350421-410462!5744*1</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">*Solo_guanggaung; c_segment=14; dc_sid=5a571b950c4ab749f0ca7cb220c9e13f; </span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">dc_session_id=10_1679815417602.564103; c_first_ref=www.google.com; </span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">c_first_page=https%3A//www.csdn.net/; c_dsid=11_1679817036063.303856; log_Id_view=249; </span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">log_Id_click=26; ssxmod_itna=Qqfx0iwxBDgD2Dl4iwlxjxCTkZRI+KDOI+e53sDBMhY4iNDnD8x7YDv+IvFQQ</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">=e17rKa5Keg2Yqj7jQEApqlA8EXPrDCPGnDB9DrV+DYAkDt4DTD34DYDixibCxi5GRD0KDFF5XUZ9Dm4GW9qDgn4GgDCiD0</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">+Uc3wiD4qDB+rdDKM0cDGY6YmUdpkG=sBhcD0UqxBd4WcGcICcF=iX=56nDaEQDzkHDtut5wMbDC2=/UdiTIiPb+05rU+DFmRhoDg</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">+bUFmTK7hPlKoGFYkr/DQolo1DGSxqmD1xD; </span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">ssxmod_itna2=Qqfx0iwxBDgD2Dl4iwlxjxCTkZRI+KDOI+e5ID8dZ+BxGXdPGazKFIHUuzx8gOIhOqzolyisDNblBrrov1Cxnz</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">+IZjoi+Kx+PAiXxvrGfcoWxbUEaI3MFQSMjYvsId1yBPyttRM0tbA6SqIM4TYDuM4nfxUwtkUvUk2DX+roMqRljLXxN</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">+RX8lUEQnrGbWj0ffIE88G8B2YL0GrNGTdqDnfOHeQdrj23qMc54M=GdjKVW9BGN1I7O9vHuAK=TPU1hbLkVagxN1kv2K7QqVAwpK7</span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">/bX1ra/SuqcCXqsZUNl1yTKYtpdW/aNXOpFP3VENxzicefA6Nrm4DQ94U0q80dzGiUGxebqIitAAPsDinY5ZBqF0eD08DiQqYD===; </span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">csrfToken=bHS_4PaJf46yWMg799xXxgUb; c_pref=https%3A//www.google.com/; c_ref=https%3A//www.csdn.net/; </span><span class="sh">'</span>
              <span class="sh">'</span><span class="s">c_page_id=default; dc_tos=rs4b4l; log_Id_pv=53</span><span class="sh">'</span>
<span class="p">}</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf‐8</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
<span class="k">except</span> <span class="n">urllib</span><span class="p">.</span><span class="n">error</span><span class="p">.</span><span class="n">HTTPError</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="mi">1111</span><span class="p">)</span>
<span class="k">except</span> <span class="n">urllib</span><span class="p">.</span><span class="n">error</span><span class="p">.</span><span class="n">URLError</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="mi">22222</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="8handler处理器">8.Handler处理器</h2>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre> <span class="n">为什么要学习handler</span><span class="err">？</span>
 	<span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
 		<span class="n">不能定制请求头</span>
 	<span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">headers</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
 		<span class="n">可以定制请求头</span>
 	<span class="n">Handler</span>
 		<span class="n">定制更高级的请求头</span><span class="err">（</span><span class="n">随着业务逻辑的复杂</span> <span class="n">请求对象的定制已经满足不了我们的需求</span><span class="err">（</span><span class="n">动态cookie和代理</span>
 <span class="n">不能使用请求对象的定制</span><span class="err">）</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre>

<span class="c1"># 需求 使用handler来访问百度  获取网页源码
</span>
<span class="kn">import</span> <span class="n">urllib.request</span>

<span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">http://www.baidu.com</span><span class="sh">'</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36</span><span class="sh">'</span>
<span class="p">}</span>

<span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">Request</span><span class="p">(</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">,</span><span class="n">headers</span> <span class="o">=</span> <span class="n">headers</span><span class="p">)</span>

<span class="c1"># handler   build_opener  open
</span>
<span class="c1"># （1）获取hanlder对象
</span><span class="n">handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">HTTPHandler</span><span class="p">()</span>

<span class="c1"># （2）获取opener对象
</span><span class="n">opener</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">build_opener</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

<span class="c1"># (3) 调用open方法
</span><span class="n">response</span> <span class="o">=</span> <span class="n">opener</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

<span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="9代理服务器">9.代理服务器</h2>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="mf">1.</span><span class="n">代理的常用功能</span><span class="err">?</span>
	<span class="mf">1.</span><span class="n">突破自身IP访问限制</span><span class="err">，</span><span class="n">访问国外站点</span><span class="err">。</span>
	<span class="mf">2.</span><span class="n">访问一些单位或团体内部资源</span>
		<span class="n">扩展</span><span class="err">：</span><span class="n">某大学FTP</span><span class="p">(</span><span class="n">前提是该代理地址在该资源的允许访问范围之内</span><span class="p">)</span><span class="err">，</span><span class="n">使用教育网内地址段免费代理服务器</span><span class="err">，</span><span class="n">就可以用于对教育网开放的各类FTP下载上传</span><span class="err">，</span><span class="n">以及各类资料查询共享等服务</span><span class="err">。</span>
	<span class="mf">3.</span><span class="n">提高访问速度</span>
		<span class="n">扩展</span><span class="err">：</span><span class="n">通常代理服务器都设置一个较大的硬盘缓冲区</span><span class="err">，</span><span class="n">当有外界的信息通过时</span><span class="err">，</span><span class="n">同时也将其保存到缓冲区中</span><span class="err">，</span><span class="n">当其他用户再访问相同的信息时</span><span class="err">，</span> <span class="n">则直接由缓冲区中取出信息</span><span class="err">，</span><span class="n">传给用户</span><span class="err">，</span><span class="n">以提高访问速度</span><span class="err">。</span>
	<span class="mf">4.</span><span class="n">隐藏真实IP</span>
		<span class="n">扩展</span><span class="err">：</span><span class="n">上网者也可以通过这种方法隐藏自己的IP</span><span class="err">，</span><span class="n">免受攻击</span><span class="err">。</span>
<span class="mf">2.</span><span class="n">代码配置代理</span>
	<span class="n">创建Reuqest对象</span>
	<span class="n">创建ProxyHandler对象</span>
	<span class="n">用handler对象创建opener对象</span>
	<span class="n">使用opener</span><span class="p">.</span><span class="n">open函数发送请求求</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">urllib.request</span>

<span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">http://www.baidu.com/s?wd=ip</span><span class="sh">'</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36</span><span class="sh">'</span>
<span class="p">}</span>

<span class="c1"># 请求对象的定制
</span><span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">Request</span><span class="p">(</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span> <span class="n">headers</span><span class="p">)</span>

<span class="c1"># 模拟浏览器访问服务器
# response = urllib.request.urlopen(request)
</span>
<span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">http</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">118.24.219.151:16817</span><span class="sh">'</span>
<span class="p">}</span>
<span class="c1"># handler  build_opener  open
</span><span class="n">handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">ProxyHandler</span><span class="p">(</span><span class="n">proxies</span> <span class="o">=</span> <span class="n">proxies</span><span class="p">)</span>

<span class="n">opener</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">build_opener</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">opener</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

<span class="c1"># 获取响应的信息
</span><span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># 保存
</span><span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">daili.html</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span><span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">fp</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>扩展：1.代理池
2.快代理</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">urllib.request</span>

<span class="n">proxies_pool</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="sh">'</span><span class="s">http</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">118.24.219.151:16817</span><span class="sh">'</span><span class="p">},</span>
    <span class="p">{</span><span class="sh">'</span><span class="s">http</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">118.24.219.151:16817</span><span class="sh">'</span><span class="p">},</span>
<span class="p">]</span>

<span class="kn">import</span> <span class="n">random</span>

<span class="n">proxies</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">(</span><span class="n">proxies_pool</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">http://www.baidu.com/s?wd=ip</span><span class="sh">'</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36</span><span class="sh">'</span>
<span class="p">}</span>

<span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">Request</span><span class="p">(</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

<span class="n">handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nc">ProxyHandler</span><span class="p">(</span><span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">)</span>

<span class="n">opener</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="nf">build_opener</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">opener</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

<span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span>

<span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">daili.html</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span><span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">fp</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="解析">解析</h1>

<h2 id="xpath">xpath</h2>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="n">xpath使用</span><span class="err">：</span>
<span class="n">注意</span><span class="err">：</span><span class="n">提前安装xpath插件</span>
<span class="err">（</span><span class="mi">1</span><span class="err">）</span><span class="n">打开chrome浏览器</span>
<span class="err">（</span><span class="mi">2</span><span class="err">）</span><span class="n">点击右上角小圆点</span>
<span class="err">（</span><span class="mi">3</span><span class="err">）</span><span class="n">更多工具</span>
<span class="err">（</span><span class="mi">4</span><span class="err">）</span><span class="n">扩展程序</span>
<span class="err">（</span><span class="mi">5</span><span class="err">）</span><span class="n">拖拽xpath插件到扩展程序中</span>
<span class="err">（</span><span class="mi">6</span><span class="err">）</span><span class="n">如果crx文件失效</span><span class="err">，</span><span class="n">需要将后缀修改zip</span>
<span class="err">（</span><span class="mi">7</span><span class="err">）</span><span class="n">再次拖拽</span>
<span class="err">（</span><span class="mi">8</span><span class="err">）</span><span class="n">关闭浏览器重新打开</span>
<span class="err">（</span><span class="mi">9</span><span class="err">）</span><span class="n">ctrl</span> <span class="o">+</span> <span class="n">shift</span> <span class="o">+</span> <span class="n">x</span>
<span class="err">（</span><span class="mi">10</span><span class="err">）</span><span class="n">出现小黑框</span>
<span class="mf">1.</span><span class="n">安装lxml库</span>
	<span class="n">pip</span> <span class="n">install</span> <span class="n">lxml</span> <span class="err">‐</span><span class="n">i</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pypi</span><span class="p">.</span><span class="n">douban</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">simple</span>
<span class="mf">2.</span><span class="n">导入lxml</span><span class="p">.</span><span class="n">etree</span>
	<span class="kn">from</span> <span class="n">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="mf">3.</span><span class="n">etree</span><span class="p">.</span><span class="nf">parse</span><span class="p">()</span> <span class="n">解析本地文件</span>
	<span class="n">html_tree</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="sh">'</span><span class="s">XX.html</span><span class="sh">'</span><span class="p">)</span>
<span class="mf">4.</span><span class="n">etree</span><span class="p">.</span><span class="nc">HTML</span><span class="p">()</span> <span class="n">服务器响应文件</span>
	<span class="n">html_tree</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="nc">HTML</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf‐8</span><span class="sh">'</span><span class="p">)</span>
<span class="mf">5.</span><span class="n">html_tree</span><span class="p">.</span><span class="nf">xpath</span><span class="p">(</span><span class="n">xpath路径</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="n">xpath基本语法</span><span class="err">：</span>
	<span class="mf">1.</span><span class="n">路径查询</span>
		<span class="o">//</span><span class="err">：</span><span class="n">查找所有子孙节点</span><span class="err">，</span><span class="n">不考虑层级关系</span>
		<span class="o">/</span> <span class="err">：</span><span class="n">找直接子节点</span>
	<span class="mf">2.</span><span class="n">谓词查询</span>
		<span class="o">//</span><span class="n">div</span><span class="p">[</span><span class="nd">@id</span><span class="p">]</span>
		<span class="o">//</span><span class="n">div</span><span class="p">[</span><span class="nd">@id</span><span class="o">=</span><span class="sh">"</span><span class="s">maincontent</span><span class="sh">"</span><span class="p">]</span>
	<span class="mf">3.</span><span class="n">属性查询</span>
		<span class="o">//</span><span class="nd">@class</span>
	<span class="mf">4.</span><span class="n">模糊查询</span>
		<span class="o">//</span><span class="n">div</span><span class="p">[</span><span class="nf">contains</span><span class="p">(</span><span class="nd">@id</span><span class="p">,</span> <span class="sh">"</span><span class="s">he</span><span class="sh">"</span><span class="p">)]</span>
		<span class="o">//</span><span class="n">div</span><span class="p">[</span><span class="n">starts</span><span class="err">‐</span><span class="nf">with</span><span class="p">(</span><span class="nd">@id</span><span class="p">,</span> <span class="sh">"</span><span class="s">he</span><span class="sh">"</span><span class="p">)]</span>
	<span class="mf">5.</span><span class="n">内容查询</span>
		<span class="o">//</span><span class="n">div</span><span class="o">/</span><span class="n">h1</span><span class="o">/</span><span class="nf">text</span><span class="p">()</span>
<span class="mf">6.</span><span class="n">逻辑运算</span>
		<span class="o">//</span><span class="n">div</span><span class="p">[</span><span class="nd">@id</span><span class="o">=</span><span class="sh">"</span><span class="s">head</span><span class="sh">"</span> <span class="ow">and</span> <span class="nd">@class</span><span class="o">=</span><span class="sh">"</span><span class="s">s_down</span><span class="sh">"</span><span class="p">]</span>
		<span class="o">//</span><span class="n">title</span> <span class="o">|</span> <span class="o">//</span><span class="n">price</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="jsonpath">JsonPath</h2>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="n">jsonpath的安装及使用方式</span><span class="err">：</span>
	<span class="n">pip安装</span><span class="err">：</span>
		<span class="n">pip</span> <span class="n">install</span> <span class="n">jsonpath</span>
	<span class="n">jsonpath的使用</span><span class="err">：</span>
		<span class="n">obj</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">json文件</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">utf‐8</span><span class="sh">'</span><span class="p">))</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">jsonpath</span><span class="p">.</span><span class="nf">jsonpath</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sh">'</span><span class="s">jsonpath语法</span><span class="sh">'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>xml最大的优点就有大量的工具可以分析，转换，和选择性的提取文档中的数据。XPath是这些最强大的工具之一。</p>

<p>如果可以使用xpath来解析json，以下的问题可以被解决：</p>

<p>1，数据不使用特殊的脚本，可以在客户端交互的发现并取并获取。</p>

<p>2，客户机请求的JSON数据可以减少到服务器上的相关部分，这样可以最大限度地减少服务器响应的带宽使用率。</p>

<p>如果我们愿意，这个可以解析json数据的工具会变得有意义。随之而来的问题是它如何工作，jsonpath的表达式看起来怎么样。</p>

<p>事实上，json是由c系统编程语言表示自然数据，有特定语言的特定语法来访问json数据。</p>

<p>xpath的表达式：</p>

<p>/store/book[1]/title</p>

<p>我们可以看作是：</p>

<p>x.store.book[0].title</p>

<p>在Javascript, Python 和 PHP 中一个变量x表示json数据。经过观察，特定的语言里有内置xpath来解析数据。</p>

<p>JSONPath工具的问题</p>

<p>-依赖某种特定的语言</p>

<p>- 需要依赖XPath 1.0</p>

<p>- 减少代码量和内存的消耗</p>

<p>- 在运行时</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre>JSONPath 表达式

JSONPath 是参照，xpath表达式来解析xml文档的方式，json数据结构通常是匿名的并且不一定需要有根元素。JSONPaht 用一个抽象的名字$来表示最外层对象。

JOSNPath 表达式可以使用.  符号如下：
$.store.book[0].title

或者使用[] 符号
$['store']['book'][0]['title']


从输入路径来看。内部或者输出的路径都会转化成-符号。

JSONPath 允许使用通配符 * 表示所以的子元素名和数组索引。还允许使用 '..' 从E4X参照过来的和数组切分语法 [start:end:step]是从ECMASCRIPT 4 参照过来的。

表达式在下面的脚本语言中可以使用显示的名称或者索引：
$.store.book[(@.length-1)].title


使用'@'符号表示当前的对象，?(&lt;判断表达式&gt;) 使用逻辑表达式来过滤。
$.store.book[?(@.price &lt; 10)].title



这里有个表格，说明JSONPath语法元素和对应XPath元素的对比。

</pre></td></tr></tbody></table></code></pre></div></div>

<table>
  <thead>
    <tr>
      <th><strong>XPath</strong></th>
      <th><strong>JSONPath</strong></th>
      <th><strong>Description</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>/</td>
      <td>$</td>
      <td>表示根元素</td>
    </tr>
    <tr>
      <td>.</td>
      <td>@</td>
      <td>当前元素</td>
    </tr>
    <tr>
      <td>/</td>
      <td>. or []</td>
      <td>子元素</td>
    </tr>
    <tr>
      <td>..</td>
      <td>n/a</td>
      <td>父元素</td>
    </tr>
    <tr>
      <td>//</td>
      <td>..</td>
      <td>递归下降，JSONPath是从E4X借鉴的。</td>
    </tr>
    <tr>
      <td>*</td>
      <td>*</td>
      <td>通配符，表示所有的元素</td>
    </tr>
    <tr>
      <td>@</td>
      <td>n/a</td>
      <td>属性访问字符</td>
    </tr>
    <tr>
      <td>[]</td>
      <td>[]</td>
      <td>子元素操作符</td>
    </tr>
    <tr>
      <td>|</td>
      <td>[,]</td>
      <td>连接操作符在XPath 结果合并其它结点集合。JSONP允许name或者数组索引。</td>
    </tr>
    <tr>
      <td>n/a</td>
      <td>[start: end :step]</td>
      <td>数组分割操作从ES4借鉴。</td>
    </tr>
    <tr>
      <td>[]</td>
      <td>?()</td>
      <td>应用过滤表示式</td>
    </tr>
    <tr>
      <td>n/a</td>
      <td>()</td>
      <td>脚本表达式，使用在脚本引擎下面。</td>
    </tr>
    <tr>
      <td>()</td>
      <td>n/a</td>
      <td>Xpath分组</td>
    </tr>
  </tbody>
</table>

<p>XPath还有很多的语法（本地路径，操作符，和函数）没有列在这里。只要知道xpath和jsonpath脚本之中的不同点就行了。</p>

<ul>
  <li>[]在xpath表达式总是从前面的路径来操作数组，索引是从1开始。</li>
  <li>使用JOSNPath的[]操作符操作一个对象或者数组，索引是从0开始。</li>
</ul>

<p>接下我们看jsonpath表示的例子。下面是一个简单的json数据结构代表一个书店（原始的xml文件是）</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w"> </span><span class="nl">"store"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"book"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> 
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"reference"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Nigel Rees"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Sayings of the Century"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mf">8.95</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fiction"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Evelyn Waugh"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Sword of Honour"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mf">12.99</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fiction"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Herman Melville"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Moby Dick"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"isbn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0-553-21311-3"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mf">8.99</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fiction"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">"J. R. R. Tolkien"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The Lord of the Rings"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"isbn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0-395-19395-8"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mf">22.99</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"bicycle"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"color"</span><span class="p">:</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mf">19.95</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<table>
  <thead>
    <tr>
      <th><strong>XPath</strong></th>
      <th><strong>JSONPath</strong></th>
      <th><strong>结果</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/store/book/author</code></td>
      <td><code class="language-plaintext highlighter-rouge">$.store.book[*].author</code></td>
      <td>书点所有书的作者</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">//author</code></td>
      <td><code class="language-plaintext highlighter-rouge">$..author</code></td>
      <td>所有的作者</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/store/*</code></td>
      <td><code class="language-plaintext highlighter-rouge">$.store.*</code></td>
      <td>store的所有元素。所有的bookst和bicycle</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/store//price</code></td>
      <td><code class="language-plaintext highlighter-rouge">$.store..price</code></td>
      <td>store里面所有东西的price</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">//book[3]</code></td>
      <td><code class="language-plaintext highlighter-rouge">$..book[2]</code></td>
      <td>第三个书</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">//book[last()]</code></td>
      <td><code class="language-plaintext highlighter-rouge">$..book[(@.length-1)]</code></td>
      <td>最后一本书</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">//book[position()&lt;3]</code></td>
      <td><code class="language-plaintext highlighter-rouge">$..book[0,1]</code><code class="language-plaintext highlighter-rouge">$..book[:2]</code></td>
      <td>前面的两本书。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">//book[isbn]</code></td>
      <td><code class="language-plaintext highlighter-rouge">$..book[?(@.isbn)]</code></td>
      <td>过滤出所有的包含isbn的书。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">//book[price&lt;10]</code></td>
      <td><code class="language-plaintext highlighter-rouge">$..book[?(@.price&lt;10)]</code></td>
      <td>过滤出价格低于10的书。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">//*</code></td>
      <td><code class="language-plaintext highlighter-rouge">$..*</code></td>
      <td>所有元素。</td>
    </tr>
  </tbody>
</table>

<p>案例练习:1.淘票票
2.boos直聘
3.中华英才
4.汽车之家</p>

<h2 id="beautifulsoup">BeautifulSoup</h2>

<p>1.基本简介</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="mf">1.</span><span class="n">BeautifulSoup简称</span><span class="err">：</span>
	<span class="n">bs4</span>
<span class="mf">2.</span><span class="n">什么是BeatifulSoup</span><span class="err">？</span>
	<span class="n">BeautifulSoup</span><span class="err">，</span><span class="n">和lxml一样</span><span class="err">，</span><span class="n">是一个html的解析器</span><span class="err">，</span><span class="n">主要功能也是解析和提取数据</span>
<span class="mf">3.</span><span class="n">优缺点</span><span class="err">？</span>
	<span class="n">缺点</span><span class="err">：</span><span class="n">效率没有lxml的效率高</span>
	<span class="n">优点</span><span class="err">：</span><span class="n">接口设计人性化</span><span class="err">，</span><span class="n">使用方便</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>2.安装以及创建</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>1.安装
	pip install bs4
2.导入
	from bs4 import BeautifulSoup
3.创建对象
	服务器响应的文件生成对象
		soup = BeautifulSoup(response.read().decode(), 'lxml')
	本地文件生成对象
		soup = BeautifulSoup(open('1.html'), 'lxml')
		注意：默认打开文件的编码格式gbk所以需要指定打开编码格式
</pre></td></tr></tbody></table></code></pre></div></div>

<p>3.节点定位</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre><span class="mf">1.</span><span class="n">根据标签名查找节点</span>
		<span class="n">soup</span><span class="p">.</span><span class="n">a</span> <span class="err">【</span><span class="n">注</span><span class="err">】</span><span class="n">只能找到第一个a</span>
			<span class="n">soup</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">name</span>
			<span class="n">soup</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">attrs</span>
<span class="mf">2.</span><span class="n">函数</span>
		<span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">find</span><span class="p">(</span><span class="n">返回一个对象</span><span class="p">)</span>
				<span class="nf">find</span><span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">)</span><span class="err">：</span><span class="n">只找到第一个a标签</span>
        		<span class="nf">find</span><span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sh">'</span><span class="s">名字</span><span class="sh">'</span><span class="p">)</span>
				<span class="nf">find</span><span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="sh">'</span><span class="s">名字</span><span class="sh">'</span><span class="p">)</span>
		<span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">find_all</span><span class="p">(</span><span class="n">返回一个列表</span><span class="p">)</span>
				<span class="nf">find_all</span><span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">)</span> <span class="n">查找到所有的a</span>
				<span class="nf">find_all</span><span class="p">([</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">span</span><span class="sh">'</span><span class="p">])</span> <span class="n">返回所有的a和span</span>
				<span class="nf">find_all</span><span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="n">只找前两个a</span>
		<span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nf">select</span><span class="p">(</span><span class="n">根据选择器得到节点对象</span><span class="p">)</span><span class="err">【</span><span class="n">推荐</span><span class="err">】</span>
				<span class="mf">1.</span><span class="n">element</span>
					<span class="n">eg</span><span class="p">:</span><span class="n">p</span>
				<span class="mf">2.</span><span class="p">.</span><span class="k">class</span>
					<span class="nc">eg</span><span class="p">:.</span><span class="n">firstname</span>
				<span class="mf">3.</span><span class="c1">#id
</span>					<span class="n">eg</span><span class="p">:</span><span class="c1">#firstname
</span>				<span class="mf">4.</span><span class="n">属性选择器</span>
					<span class="p">[</span><span class="n">attribute</span><span class="p">]</span>
                    	<span class="n">eg</span><span class="p">:</span><span class="n">li</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="sh">'</span><span class="s">li[class]</span><span class="sh">'</span><span class="p">)</span>
                    <span class="p">[</span><span class="n">attribute</span><span class="o">=</span><span class="n">value</span><span class="p">]</span>
						<span class="n">eg</span><span class="p">:</span><span class="n">li</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="sh">'</span><span class="s">li[class=</span><span class="sh">"</span><span class="s">hengheng1</span><span class="sh">"</span><span class="s">]</span><span class="sh">'</span><span class="p">)</span>
                <span class="mf">5.</span><span class="n">层级选择器</span>
					<span class="n">element</span> <span class="n">element</span>
						<span class="n">div</span> <span class="n">p</span>
					<span class="n">element</span><span class="o">&gt;</span><span class="n">element</span>
						<span class="n">div</span><span class="o">&gt;</span><span class="n">p</span>
					<span class="n">element</span><span class="p">,</span><span class="n">element</span>
						<span class="n">div</span><span class="p">,</span><span class="n">p</span>
							<span class="n">eg</span><span class="p">:</span><span class="n">soup</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="sh">'</span><span class="s">a,span</span><span class="sh">'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>4.节点信息</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">获取节点内容</span><span class="err">：</span><span class="n">适用于标签中嵌套标签的结构</span>
		<span class="n">obj</span><span class="p">.</span><span class="n">string</span>
		<span class="n">obj</span><span class="p">.</span><span class="nf">get_text</span><span class="p">()</span><span class="err">【</span><span class="n">推荐</span><span class="err">】</span>
<span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">节点的属性</span>
		<span class="n">tag</span><span class="p">.</span><span class="n">name</span> <span class="n">获取标签名</span>
			<span class="n">eg</span><span class="p">:</span><span class="n">tag</span> <span class="o">=</span> <span class="nf">find</span><span class="p">(</span><span class="sh">'</span><span class="s">li)
				print(tag.name)
		tag.attrs将属性值作为一个字典返回
(3).获取节点属性
		obj.attrs.get(</span><span class="sh">'</span><span class="n">title</span><span class="sh">'</span><span class="s">)【常用】
		obj.get(</span><span class="sh">'</span><span class="n">title</span><span class="sh">'</span><span class="s">)
		obj[</span><span class="sh">'</span><span class="n">title</span><span class="sh">'</span><span class="s">]
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>应用实例： 1.股票信息提取（http://quote.stockstar.com/）
2.中华英才网-旧版
3 .腾讯公司招聘需求抓取（https://hr.tencent.com/index.php）</p>

<h1 id="selenium">Selenium</h1>

<p><strong>1.什么是selenium？</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>（1）Selenium是一个用于Web应用程序测试的工具。 
（2）Selenium 测试直接运行在浏览器中，就像真正的用户在操作一样。 
（3）支持通过各种driver（FirfoxDriver，IternetExplorerDriver，OperaDriver，ChromeDriver）驱动 真实浏览器完成测试。 （4）selenium也是支持无界面浏览器操作的。
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>2.为什么使用selenium？</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> 模拟浏览器功能，自动执行网页中的js代码，实现动态加载
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>3.如何安装selenium？</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>（1）操作谷歌浏览器驱动下载地址 http://chromedriver.storage.googleapis.com/index.html 
（2）谷歌驱动和谷歌浏览器版本之间的映射表 http://blog.csdn.net/huilan_same/article/details/51896672 
（3）查看谷歌浏览器版本 谷歌浏览器右上角‐‐&gt;帮助‐‐&gt;关于 
（4）pip install selenium
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>4.selenium的使用步骤？</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre> （1）导入：from selenium import webdriver 
 （2）创建谷歌浏览器操作对象： path = 谷歌浏览器驱动文件路径 browser = webdriver.Chrome(path) 
 （3）访问网址 url = 要访问的网址 browser.get(url)
 
元素定位：自动化要做的就是模拟鼠标和键盘来操作来操作这些元素，点击、输入等等。操作这些元素前首先
要找到它们，WebDriver提供很多定位元素的方法
方法：
1.find_element_by_id
	eg:button = browser.find_element_by_id('su')

2.find_elements_by_name
	eg:name = browser.find_element_by_name('wd')

3.find_elements_by_xpath
	eg:xpath1 = browser.find_elements_by_xpath('//input[@id="su"]')

4.find_elements_by_tag_name
	eg:names = browser.find_elements_by_tag_name('input')

5.find_elements_by_css_selector
	eg:my_input = browser.find_elements_by_css_selector('#kw')[0]
	
6.find_elements_by_link_text
	eg:browser.find_element_by_link_text("新闻")

</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>4‐2:访问元素信息
获取元素属性
	.get_attribute('class')
获取元素文本
	.text
获取标签名
	.tag_name
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>4‐3:交互
	点击:click()
	输入:send_keys()
	后退操作:browser.back()
	前进操作:browser.forword()
	模拟JS滚动:
		js='document.documentElement.scrollTop=100000'
		browser.execute_script(js) 执行js代码
	获取网页代码：page_source
	退出：browser.quit()xxxxxxxxxx 
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>5.Chrome handless</strong></p>

<p>Chrome-headless 模式， Google 针对 Chrome 浏览器 59版 新增加的一种模式，可以让你不打开UI界面的情况下 使用 Chrome 浏览器，所以运行效果与 Chrome 保持完美一致。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>1.系统要求：
		Chrome
				Unix\Linux 系统需要 chrome &gt;= 59
				Windows 系统需要 chrome &gt;= 60
		Python3.6
		Selenium==3.4.*
		ChromeDriver==2.31
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="mf">2.</span><span class="n">配置</span><span class="err">：</span>
<span class="kn">from</span> <span class="n">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="n">chrome_options</span> <span class="o">=</span> <span class="nc">Options</span><span class="p">()</span>
<span class="n">chrome_options</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">‐‐headless</span><span class="sh">'</span><span class="p">)</span>
<span class="n">chrome_options</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">‐‐disable‐gpu</span><span class="sh">'</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="sa">r</span><span class="sh">'</span><span class="s">C:\Program Files (x86)\Google\Chrome\Application\chrome.exe</span><span class="sh">'</span>
<span class="n">chrome_options</span><span class="p">.</span><span class="n">binary_location</span> <span class="o">=</span> <span class="n">path</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="nc">Chrome</span><span class="p">(</span><span class="n">chrome_options</span><span class="o">=</span><span class="n">chrome_options</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">http://www.baidu.com/</span><span class="sh">'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="mf">3.</span><span class="n">配置封装</span><span class="err">：</span>
		<span class="kn">from</span> <span class="n">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
		<span class="c1">#这个是浏览器自带的 不需要我们再做额外的操作
</span>		<span class="kn">from</span> <span class="n">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
		<span class="k">def</span> <span class="nf">share_browser</span><span class="p">():</span>
			<span class="c1">#初始化
</span>			<span class="n">chrome_options</span> <span class="o">=</span> <span class="nc">Options</span><span class="p">()</span>
			<span class="n">chrome_options</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">‐‐headless</span><span class="sh">'</span><span class="p">)</span>
			<span class="n">chrome_options</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">‐‐disable‐gpu</span><span class="sh">'</span><span class="p">)</span>
			<span class="c1">#浏览器的安装路径 打开文件位置
</span>			<span class="c1">#这个路径是你谷歌浏览器的路径
</span>			<span class="n">path</span> <span class="o">=</span> <span class="sa">r</span><span class="sh">'</span><span class="s">C:\Program Files (x86)\Google\Chrome\Application\chrome.exe</span><span class="sh">'</span>
			<span class="n">chrome_options</span><span class="p">.</span><span class="n">binary_location</span> <span class="o">=</span> <span class="n">path</span>
            <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="nc">Chrome</span><span class="p">(</span><span class="n">chrome_options</span><span class="o">=</span><span class="n">chrome_options</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">browser</span>
<span class="n">封装调用</span><span class="err">：</span>
		<span class="kn">from</span> <span class="n">handless</span> <span class="kn">import</span> <span class="n">share_browser</span>
		<span class="n">browser</span> <span class="o">=</span> <span class="nf">share_browser</span><span class="p">()</span>
		<span class="n">browser</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">http://www.baidu.com/</span><span class="sh">'</span><span class="p">)</span>
		<span class="n">browser</span><span class="p">.</span><span class="nf">save_screenshot</span><span class="p">(</span><span class="sh">'</span><span class="s">handless1.png</span><span class="sh">'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="requests">requests</h1>

<p><strong>1.基本使用</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>1.文档：
	官方文档
		http://cn.python‐requests.org/zh_CN/latest/
	快速上手
		http://cn.python‐requests.org/zh_CN/latest/user/quickstart.html
2.安装
	pip install requests
	
3.response的属性以及类型
	类型                          ：models.Response
	r.text 						 : 获取网站源码
	r.encoding                   ：访问或定制编码方式
	r.url                        ：获取请求的url
	r.content                    ：响应的字节类型
	r.status_code                ：响应的状态码
	r.headers                    ：响应的头信息

</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>2.get请求</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>requests.get()
	eg:
		import requests
		url = 'http://www.baidu.com/s?'
	headers = {
			'User‐Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML,
				like Gecko) Chrome/65.0.3325.181 Safari/537.36'
	}
	data = {
		'wd':'北京'
	}
	response = requests.get(url,params=data,headers=headers)
定制参数
	参数使用params传递
	参数无需urlencode编码
	不需要请求对象的定制
	请求资源路径中？可加可不加
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>3.post请求</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">()</span>
<span class="n">百度翻译</span><span class="p">:</span>
	<span class="n">eg</span><span class="p">:</span>
		<span class="kn">import</span> <span class="n">requests</span>
		<span class="n">post_url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">http://fanyi.baidu.com/sug</span><span class="sh">'</span>
		<span class="n">headers</span><span class="o">=</span><span class="p">{</span>
			<span class="sh">'</span><span class="s">User‐Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
				(KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36</span><span class="sh">'</span>
		<span class="p">}</span>
		<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
			<span class="sh">'</span><span class="s">kw</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">eye</span><span class="sh">'</span>
		<span class="p">}</span>
		<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">url</span> <span class="o">=</span> <span class="n">post_url</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>6：get和post区别？
	1： get请求的参数名字是params post请求的参数的名字是data
	2： 请求资源路径后面可以不加?
	3： 不需要手动编解码
	4： 不需要做请求对象的定制

</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>4.代理</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre>7：proxy定制
	在请求中设置proxies参数
	参数类型是一个字典类型
	eg:
		import requests
		url = 'http://www.baidu.com/s?'
		headers = {
			'user‐agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML,
		like Gecko) Chrome/65.0.3325.181 Safari/537.36'
		}
		data = {
			'wd':'ip'
		}
		proxy = {
			'http':'219.149.59.250:9797'
		}
		r = requests.get(url=url,params=data,headers=headers,proxies=proxy)
		with open('proxy.html','w',encoding='utf‐8') as fp:
		fp.write(r.text)
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>5.cookie定制</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>8:cookie定制
	应用案例：
		（1）古诗文网（需要验证）
		（2）云打码平台
			用户登陆 actionuser action
			开发者登陆 actioncode action

</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="scrapy">scrapy</h1>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>（1）scrapy是什么？
		Scrapy是一个为了爬取网站数据，提取结构性数据而编写的应用框架。 可以应用在包括数据挖掘，信息处理
或存储历史数据等一系列的程序中。

</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre>（2）安装scrapy：
			pip install scrapy
	安装过程中出错：
			如果安装有错误！！！！
			pip install Scrapy
			building 'twisted.test.raiser' extension
			error: Microsoft Visual C++ 14.0 is required. Get it with "Microsoft Visual C++
			Build Tools": http://landinghub.visualstudio.com/visual‐cpp‐build‐tools
	解决方案：
			http://www.lfd.uci.edu/~gohlke/pythonlibs/#twisted
			下载twisted对应版本的whl文件（如我的Twisted‐17.5.0‐cp36‐cp36m‐win_amd64.whl），cp后面是
			python版本，amd64代表64位，运行命令：
			pip install C:\Users\...\Twisted‐17.5.0‐cp36‐cp36m‐win_amd64.whl
			pip install Scrapy
	如果再报错
			python ‐m pip install ‐‐upgrade pip
	如果再报错 win32
	解决方法：
			pip install pypiwin32
    再报错：使用anaconda
	使用步骤：
		打开anaconda
		点击environments
		点击not installed
		输入scrapy
		apply
		在pycharm中选择anaconda的环境
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="1scrapy项目的创建以及运行">1.scrapy项目的创建以及运行</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>1.创建scrapy项目：
	终端输入 scrapy startproject 项目名称
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>2.项目组成：
	spiders
		__init__.py
		自定义的爬虫文件.py ‐‐‐》由我们自己创建，是实现爬虫核心功能的文件
	__init__.py
	items.py ‐‐‐》定义数据结构的地方，是一个继承自scrapy.Item的类
	middlewares.py ‐‐‐》中间件 代理
	pipelines.py ‐‐‐》管道文件，里面只有一个类，用于处理下载数据的后续处理默认是300优先级，值越小优先级越高（1‐1000）
	settings.py ‐‐‐》配置文件 比如：是否遵守robots协议，User‐Agent定义等

</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>3.创建爬虫文件：
			（1）跳转到spiders文件夹 cd 目录名字/目录名字/spiders
			（2）scrapy genspider 爬虫名字 网页的域名
爬虫文件的基本组成：
			继承scrapy.Spider类
					name = 'baidu' ‐‐‐》 运行爬虫文件时使用的名字
					allowed_domains ‐‐‐》 爬虫允许的域名，在爬取的时候，如果不是此域名之下的url，会被过滤掉
					start_urls ‐‐‐》 声明了爬虫的起始地址，可以写多个url，一般是一个
					parse(self, response) ‐‐‐》解析数据的回调函数
								response.text ‐‐‐》响应的是字符串
								response.body ‐‐‐》响应的是二进制文件
								response.xpath()‐》xpath方法的返回值类型是selector列表
								extract() ‐‐‐》提取的是selector对象的是data
								extract_first() ‐‐‐》提取的是selector列表中的第一个数据
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>4.运行爬虫文件：
	scrapy crawl 爬虫名称
	注意：应在spiders文件夹内执行
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>3.scrapy架构组成</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>	（1）引擎 ‐‐‐》自动运行，无需关注，会自动组织所有的请求对象，分发给下载器
	（2）下载器 ‐‐‐》从引擎处获取到请求对象后，请求数据
	（3）spiders ‐‐‐》Spider类定义了如何爬取某个(或某些)网站。包括了爬取的动作(例如:是否跟进链接)以及如何从网页的内容中提取结构化数据(爬取item)。 换句话说，Spider就是您定义爬取的动作及分析某个网页(或者是有些网页)的地方。
	（4）调度器 ‐‐‐》有自己的调度规则，无需关注
	（5）管道（Item pipeline） ‐‐‐》最终处理数据的管道，会预留接口供我们处理数据
当Item在Spider中被收集之后，它将会被传递到Item Pipeline，一些组件会按照一定的顺序执行对Item的处理。
每个item pipeline组件(有时称之为“Item Pipeline”)是实现了简单方法的Python类。他们接收到Item并通过它执行
一些行为，同时也决定此Item是否继续通过pipeline，或是被丢弃而不再进行处理。
		以下是item pipeline的一些典型应用：
				1. 清理HTML数据
				2. 验证爬取的数据(检查item包含某些字段)
				3. 查重(并丢弃)
				4. 将爬取结果保存到数据库中
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>4.scrapy工作原理</strong></p>

<p><img src="https://procon-note.oss-cn-guangzhou.aliyuncs.com/typora/image-20230410151719563.png" alt="image-20230410151719563" /></p>

<h2 id="2scrapy-shell">2.scrapy shell</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>1.什么是scrapy shell？
	Scrapy终端，是一个交互终端，供您在未启动spider的情况下尝试及调试您的爬取代码。 其本意是用来测试提取数据的代码，不过您可以将其作为正常的Python终端，在上面测试任何的Python代码。
	该终端是用来测试XPath或CSS表达式，查看他们的工作方式及从爬取的网页中提取的数据。 在编写您的spider时，该终端提供了交互性测试您的表达式代码的功能，免去了每次修改后运行spider的麻烦。
	一旦熟悉了Scrapy终端后，您会发现其在开发和调试spider时发挥的巨大作用。

</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>2.安装ipython
	安装：pip install ipython
	简介：如果您安装了 IPython ，Scrapy终端将使用 IPython (替代标准Python终端)。 IPython 终端与其他相
比更为强大，提供智能的自动补全，高亮输出，及其他特性。
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre>3.应用： （1）scrapy shell www.baidu.com
		（2）scrapy shell http://www.baidu.com
		 (3) scrapy shell "http://www.baidu.com"
		 (4) scrapy shell "www.baidu.com"
  语法：
  		（1）response对象：
					response.body
					response.text
					response.url
					response.status
		（2）response的解析：
					response.xpath() （常用）
							使用xpath路径查询特定元素，返回一个selector列表对象
					response.css()
							使用css_selector查询元素，返回一个selector列表对象
							获取内容 ：response.css('#su::text').extract_first()
							获取属性 ：response.css('#su::attr(“value”)').extract_first()
		（3）selector对象（通过xpath方法调用返回的是seletor列表）
					extract()
								提取selector对象的值
								如果提取不到值 那么会报错
								使用xpath请求到的对象是一个selector对象，需要进一步使用extract()方法拆包，转换为									unicode字符串
					extract_first()
								提取seletor列表中的第一个值
								如果提取不到值 会返回一个空值
								返回第一个解析到的值，如果列表为空，此种方法也不会报错，会返回一个空值
					xpath()
					css()
								注意：每一个selector对象可以再次的去使用xpath或者css方法

</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="3yield">3.yield</h2>

<ol>
  <li>带有 yield 的函数不再是一个普通函数，而是一个生成器generator，可用于迭代</li>
  <li>
    <p>yield 是一个类似 return 的关键字，迭代一次遇到yield时就返回yield后面(右边)的值。重点是：下一次迭代 时，从上一次迭代遇到的yield后面的代码(下一行)开始执行</p>
  </li>
  <li>简要理解：yield就是 return 返回一个值，并且记住这个返回的位置，下次迭代就从这个位置后(下一行)开始</li>
</ol>

<h2 id="4pymysql的使用步骤">4.pymysql的使用步骤</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>1.pip install pymysql
2.pymysql.connect(host,port,user,password,db,charset)
3.conn.cursor()
4.cursor.execute()
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="5crawlspider">5.CrawlSpider</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>1.继承自scrapy.Spider
2.独门秘笈
	CrawlSpider可以定义规则，再解析html内容的时候，可以根据链接规则提取出指定的链接，然后再向这些链接发送请求
	所以，如果有需要跟进链接的需求，意思就是爬取了网页之后，需要提取链接再次爬取，使用CrawlSpider是非常合适的
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>3.提取链接
	链接提取器，在这里就可以写规则提取指定链接
scrapy.linkextractors.LinkExtractor(
	allow = (), 			# 正则表达式 提取符合正则的链接
	deny = (), 				# (不用)正则表达式 不提取符合正则的链接
	allow_domains = (), 	# （不用）允许的域名
	deny_domains = (),  	# （不用）不允许的域名
	restrict_xpaths = (), 	# xpath，提取符合xpath规则的链接
	restrict_css = () 		# 提取符合选择器规则的链接)
4.模拟使用
		正则用法：links1 = LinkExtractor(allow=r'list_23_\d+\.html')
		xpath用法：links2 = LinkExtractor(restrict_xpaths=r'//div[@class="x"]')
		css用法：links3 = LinkExtractor(restrict_css='.x')
5.提取连接
		link.extract_links(response)
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>6.注意事项
	【注1】callback只能写函数名字符串, callback='parse_item'
	【注2】在基本的spider中，如果重新发送请求，那里的callback写的是 callback=self.parse_item 【注‐‐稍后看】follow=true 是否跟进 就是按照提取连接规则进行提取
</pre></td></tr></tbody></table></code></pre></div></div>

<p>运行原理：</p>

<p><img src="https://procon-note.oss-cn-guangzhou.aliyuncs.com/typora/image-20230410152841465.png" alt="image-20230410152841465" /></p>

<h2 id="6crawlspider案例">6.CrawlSpider案例</h2>

<p>需求：读书网数据入库</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>1.创建项目：scrapy startproject dushuproject
2.跳转到spiders路径 cd\dushuproject\dushuproject\spiders
3.创建爬虫类：scrapy genspider ‐t crawl read www.dushu.com
4.items
5.spiders
6.settings
7.pipelines
		数据保存到本地
		数据保存到mysql数据库

</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="7数据入库">7.数据入库</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td><td class="rouge-code"><pre><span class="err">（</span><span class="mi">1</span><span class="err">）</span><span class="n">settings配置参数</span><span class="err">：</span>
			<span class="n">DB_HOST</span> <span class="o">=</span> <span class="sh">'</span><span class="s">192.168.231.128</span><span class="sh">'</span>
			<span class="n">DB_PORT</span> <span class="o">=</span> <span class="mi">3306</span>
			<span class="n">DB_USER</span> <span class="o">=</span> <span class="sh">'</span><span class="s">root</span><span class="sh">'</span>
			<span class="n">DB_PASSWORD</span> <span class="o">=</span> <span class="sh">'</span><span class="s">1234</span><span class="sh">'</span>
			<span class="n">DB_NAME</span> <span class="o">=</span> <span class="sh">'</span><span class="s">test</span><span class="sh">'</span>
			<span class="n">DB_CHARSET</span> <span class="o">=</span> <span class="sh">'</span><span class="s">utf8</span><span class="sh">'</span>
<span class="err">（</span><span class="mi">2</span><span class="err">）</span><span class="n">管道配置</span>
			<span class="kn">from</span> <span class="n">scrapy.utils.project</span> <span class="kn">import</span> <span class="n">get_project_settings</span>
			<span class="kn">import</span> <span class="n">pymysql</span>
			<span class="k">class</span> <span class="nc">MysqlPipeline</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
			<span class="c1">#__init__方法和open_spider的作用是一样的
</span>			<span class="c1">#init是获取settings中的连接参数
</span>				<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
					<span class="n">settings</span> <span class="o">=</span> <span class="nf">get_project_settings</span><span class="p">()</span>
					<span class="n">self</span><span class="p">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="sh">'</span><span class="s">DB_HOST</span><span class="sh">'</span><span class="p">]</span>
					<span class="n">self</span><span class="p">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="sh">'</span><span class="s">DB_PORT</span><span class="sh">'</span><span class="p">]</span>
					<span class="n">self</span><span class="p">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="sh">'</span><span class="s">DB_USER</span><span class="sh">'</span><span class="p">]</span>
					<span class="n">self</span><span class="p">.</span><span class="n">pwd</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="sh">'</span><span class="s">DB_PWD</span><span class="sh">'</span><span class="p">]</span>
					<span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="sh">'</span><span class="s">DB_NAME</span><span class="sh">'</span><span class="p">]</span>
					<span class="n">self</span><span class="p">.</span><span class="n">charset</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="sh">'</span><span class="s">DB_CHARSET</span><span class="sh">'</span><span class="p">]</span>
					<span class="n">self</span><span class="p">.</span><span class="nf">connect</span><span class="p">()</span>
			<span class="c1"># 连接数据库并且获取cursor对象
</span>				<span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
					<span class="n">self</span><span class="p">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">pymysql</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">port</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">user</span><span class="p">,</span>
												<span class="n">password</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">pwd</span><span class="p">,</span><span class="n">db</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="n">charset</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">charset</span><span class="p">)</span>
					<span class="n">self</span><span class="p">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">conn</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
				<span class="k">def</span> <span class="nf">process_item</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
					<span class="n">sql</span> <span class="o">=</span> <span class="sh">'</span><span class="s">insert into book(image_url, book_name, author, info) values(</span><span class="sh">"</span><span class="s">%s</span><span class="sh">"</span><span class="s">,</span><span class="sh">"</span><span class="s">%s</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">%s</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">%s</span><span class="sh">"</span><span class="s">)</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">image_url</span><span class="sh">'</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">book_name</span><span class="sh">'</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">author</span><span class="sh">'</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">info</span><span class="sh">'</span><span class="p">])</span>
					<span class="n">sql</span> <span class="o">=</span> <span class="sh">'</span><span class="s">insert into book(image_url,book_name,author,info) values
(</span><span class="sh">"</span><span class="s">{}</span><span class="sh">"</span><span class="s">,</span><span class="sh">"</span><span class="s">{}</span><span class="sh">"</span><span class="s">,</span><span class="sh">"</span><span class="s">{}</span><span class="sh">"</span><span class="s">,</span><span class="sh">"</span><span class="s">{}</span><span class="sh">"</span><span class="s">)</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">image_url</span><span class="sh">'</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">book_name</span><span class="sh">'</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">author</span><span class="sh">'</span><span class="p">],</span>
<span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">info</span><span class="sh">'</span><span class="p">])</span>
<span class="c1"># 执行sql语句
</span>					<span class="n">self</span><span class="p">.</span><span class="n">cursor</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
					<span class="n">self</span><span class="p">.</span><span class="n">conn</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
					<span class="k">return</span> <span class="n">item</span>
				<span class="k">def</span> <span class="nf">close_spider</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
					<span class="n">self</span><span class="p">.</span><span class="n">conn</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
					<span class="n">self</span><span class="p">.</span><span class="n">cursor</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="8日志信息和日志等级">8.日志信息和日志等级</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>（1）日志级别：
		CRITICAL：严重错误
		ERROR： 一般错误
		WARNING： 警告
		INFO: 一般信息
		DEBUG： 调试信息
		默认的日志等级是DEBUG
		只要出现了DEBUG或者DEBUG以上等级的日志
		那么这些日志将会打印
（2）settings.py文件设置：
		默认的级别为DEBUG，会显示上面所有的信息
		在配置文件中 settings.py
		LOG_FILE : 将屏幕显示的信息全部记录到文件中，屏幕不再显示，注意文件后缀一定是.log
		LOG_LEVEL : 设置日志显示的等级，就是显示哪些，不显示哪些

</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="9scrapy的post请求">9.scrapy的post请求</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>（1）重写start_requests方法：
		def start_requests(self)
(2) start_requests的返回值：
		scrapy.FormRequest(url=url, headers=headers, callback=self.parse_item, formdata=data)
				url: 要发送的post地址
				headers：可以定制头信息
				callback: 回调函数
				formdata: post所携带的数据，这是一个字典	
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="10代理">10.代理</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>（1）到settings.py中，打开一个选项
	DOWNLOADER_MIDDLEWARES = {
		'postproject.middlewares.Proxy': 543,
	}
（2）到middlewares.py中写代码
	def process_request(self, request, spider):
		request.meta['proxy'] = 'https://113.68.202.10:9999'
		return None
</pre></td></tr></tbody></table></code></pre></div></div>



                <hr style="visibility: hidden;">
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2020/04/01/python%E5%9F%BA%E7%A1%80/" data-toggle="tooltip" data-placement="top" title="python基础">
                        Previous<br>
                        <span>python基础</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2020/07/01/JetBrains-Idea%E5%BF%AB%E6%8D%B7%E9%94%AE/" data-toggle="tooltip" data-placement="top" title="Jetbrains Idea快捷键">
                        Next<br>
                        <span>Jetbrains Idea快捷键</span>
                        </a>
                    </li>
                    
                </ul>
                <hr style="visibility: hidden;">

                <!-- Gitalk 评论 start  -->
                
                <!-- Link Gitalk 的支持文件  -->
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
                <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

                <div id="gitalk-container"></div>
                <script type="text/javascript">
                    var gitalk = new Gitalk({

                        // gitalk的主要参数
                        clientID: '2542452a44c3a8034a35',
                        clientSecret: '3119b189eb567a7a89c2440917078889d1689226',
                        repo: 'xprocon.github.io',
                        owner: 'xprocon',
                        admin: ['xprocon'],
                        id: 'post',
                        distractionFreeMode: true,  //是否启用评论全屏遮罩.
                        createIssueManually: true, //如果当前页面没有相应的 isssue ，且登录的用户属于 admin，则会自动创建 issue。如果设置为 true，则显示一个初始化页面，创建 issue 需要点击 init 按钮。
                        perPage: 15 //每页多少个评论
                    });
                    gitalk.render('gitalk-container');
                </script>
                
                <!-- Gitalk end -->

                

                
            </div>  

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                


<section>
    
        <hr class="hidden-sm hidden-xs">
    
    <h5><a href="/archive/">FEATURED TAGS</a></h5>
    <div class="tags">
        
        
        
        
        
        
                <a data-sort="0042" 
                    href="/archive/?tag=Java"
                    title="Java"
                    rel="6">Java</a>
        
                <a data-sort="0032" 
                    href="/archive/?tag=linux"
                    title="linux"
                    rel="16">linux</a>
        
                <a data-sort="0035" 
                    href="/archive/?tag=%E8%BF%90%E7%BB%B4"
                    title="运维"
                    rel="13">运维</a>
        
                <a data-sort="0036" 
                    href="/archive/?tag=%E5%AD%A6%E4%B9%A0"
                    title="学习"
                    rel="12">学习</a>
        
                <a data-sort="0037" 
                    href="/archive/?tag=java"
                    title="java"
                    rel="11">java</a>
        
                <a data-sort="0039" 
                    href="/archive/?tag=centos"
                    title="centos"
                    rel="9">centos</a>
        
                <a data-sort="0043" 
                    href="/archive/?tag=%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"
                    title="开发环境"
                    rel="5">开发环境</a>
        
                <a data-sort="0043" 
                    href="/archive/?tag=nginx"
                    title="nginx"
                    rel="5">nginx</a>
        
                <a data-sort="0044" 
                    href="/archive/?tag=%E5%AE%B9%E5%99%A8%E5%8C%96"
                    title="容器化"
                    rel="4">容器化</a>
        
                <a data-sort="0044" 
                    href="/archive/?tag=git"
                    title="git"
                    rel="4">git</a>
        
                <a data-sort="0044" 
                    href="/archive/?tag=spring"
                    title="spring"
                    rel="4">spring</a>
        
                <a data-sort="0045" 
                    href="/archive/?tag=%E4%BA%91%E5%8E%9F%E7%94%9F"
                    title="云原生"
                    rel="3">云原生</a>
        
                <a data-sort="0045" 
                    href="/archive/?tag=%E5%9F%BA%E7%A1%80"
                    title="基础"
                    rel="3">基础</a>
        
                <a data-sort="0045" 
                    href="/archive/?tag=jetbrains"
                    title="jetbrains"
                    rel="3">jetbrains</a>
        
                <a data-sort="0045" 
                    href="/archive/?tag=python"
                    title="python"
                    rel="3">python</a>
    </div>
</section>


                <!-- Friends Blog -->
                
<hr>
<h5>FRIENDS</h5>
<ul class="list-inline">
  
  <li><a href="https://www.baidu.com/">百度（baidu）</a></li>
  
  <li><a href="http://10.175.194.215:8080/">IT工具箱（ittools）</a></li>
  
  <li><a href="https://www.emojiall.com/zh-hans">emoji（emoji搜索）</a></li>
  
  <li><a href="https://www.v2ex.com/">v2ex（v2ex论坛）</a></li>
  
  <li><a href="https://www.reddit.com/r/China_irl/">reddit（流浪防区）</a></li>
  
</ul>

            </div>
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->









<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'right',
          // icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                


<ul class="list-inline text-center">


  
  
  <li>
    <a href="https://twitter.com/xprocon">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  <li>
    <a target="_blank" href="https://www.zhihu.com/people/procon">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa  fa-stack-1x fa-inverse">知</i>
      </span>
    </a>
  </li>
  
  
  <li>
    <a target="_blank" href="http://weibo.com/huangpuguang1ni">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  
  <li>
    <a target="_blank" href="https://github.com/xprocon">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
</ul>

                <p class="copyright text-muted">
                    Copyright &copy; Procon's Tech Life Blog 2024
                    <br>
                    Powered by <a href="https://blog.procon.cc">Procon Blog</a>
<!--                    <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="100px"-->
<!--                        height="20px"-->
<!--                        src="https://ghbtns.com/github-btn.html?user=huxpro&repo=huxpro.github.io&type=star&count=true">-->
<!--                    </iframe>-->
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>

<!-- Simple Jekyll Search -->
<script src="/js/simple-jekyll-search.min.js"></script>

<!-- Service Worker -->


<!-- async load function -->
<script>
    function async(u, c) {
        var d = document, t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
        s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->







<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function () {
        var $nav = document.querySelector("nav");
        if ($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->



<!-- Baidu Tongji -->



<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog(selector) {

        // interop with multilangual 
        if ('' == 'true') {
            _containerSelector = 'div.post-container.active'
        } else {
            _containerSelector = 'div.post-container'
        }

        // init
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        // clean
        $(selector).html('')

        // appending
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>



<!-- Multi-Lingual -->


<!-- Simple Jekyll Search -->
<script>
    // https://stackoverflow.com/questions/1912501/unescape-html-entities-in-javascript
    function htmlDecode(input) {
        var e = document.createElement('textarea');
        e.innerHTML = input;
        // handle case of empty input
        return e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
    }

    SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('search-results'),
        json: '/search.json',
        searchResultTemplate: '<div class="post-preview item"><a href="{url}"><h2 class="post-title">{title}</h2><h3 class="post-subtitle">{subtitle}</h3><hr></a></div>',
        noResultsText: 'No results',
        limit: 50,
        fuzzy: false,
        // a hack to get escaped subtitle unescaped. for some reason, 
        // post.subtitle w/o escape filter nuke entire search.
        templateMiddleware: function (prop, value, template) {
            if (prop === 'subtitle' || prop === 'title') {
                if (value.indexOf("code")) {
                    return htmlDecode(value);
                } else {
                    return value;
                }
            }
        }
    });

    $(document).ready(function () {
        var $searchPage = $('.search-page');
        var $searchOpen = $('.search-icon');
        var $searchClose = $('.search-icon-close');
        var $searchInput = $('#search-input');
        var $body = $('body');

        $searchOpen.on('click', function (e) {
            e.preventDefault();
            $searchPage.toggleClass('search-active');
            var prevClasses = $body.attr('class') || '';
            setTimeout(function () {
                $body.addClass('no-scroll');
            }, 400)

            if ($searchPage.hasClass('search-active')) {
                $searchClose.on('click', function (e) {
                    e.preventDefault();
                    $searchPage.removeClass('search-active');
                    $body.attr('class', prevClasses);  // from closure 
                });
                $searchInput.focus();
            }
        });
    });
</script>


<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
