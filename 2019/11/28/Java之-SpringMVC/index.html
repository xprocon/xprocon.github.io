<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="这里是 @Procon普光 的个人博客，与你一起发现更大的世界">
    <meta name="keywords" content="普光, Procon普光, 博客, 个人网站, 互联网, Java , 后端">
    <meta name="theme-color" content="#000000">

    <!-- Open Graph -->
    <meta property="og:title"
        content="SpringMVC - Procon's Tech Life Blog">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="一、SpringMVC简介
">
    
    <meta property="article:published_time" content=" 2019-11-28T12:00:00Z">
    
    
    <meta property="article:author" content="Procon">
    
    
    <meta property="article:tag" content="java">
    
    <meta property="article:tag" content="spring">
    
    <meta property="article:tag" content="学习">
    
    
    <meta property="og:image" content="https://blog.procon.cchttps://procon-note.oss-cn-guangzhou.aliyuncs.com/typora/avatar_m.jpg">
    <meta property="og:url" content="https://blog.procon.cc/2019/11/28/Java%E4%B9%8B-SpringMVC/">
    <meta property="og:site_name" content="Procon's Tech Life Blog">

    <title>SpringMVC - Procon's Tech Life Blog</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://blog.procon.cc/2019/11/28/Java%E4%B9%8B-SpringMVC/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href=" /css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href=" /css/hux-blog.min.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet"
        type="text/css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>

    <!-- Google AdSense -->
    <script data-ad-client="ca-pub-6487568398225121" async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->

<nav class="navbar navbar-default navbar-custom navbar-fixed-top invert">
    
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Procon's Tech Life Blog</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div id="huxblog_navbar">
                <div class="navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="/">Home</a>
                        </li>
                        
                        
                        
                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                        
                        
                        <li>
                            <a href="/archive/">Archive</a>
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <li class="search-icon">
                            <a href="javascript:void(0)">
                                <i class="fa fa-search"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <script>
        // Drop Bootstarp low-performance Navbar
        // Use customize navbar with high-quality material design animation
        // in high-perf jank-free CSS3 implementation
        var $body = document.body;
        var $toggle = document.querySelector('.navbar-toggle');
        var $navbar = document.querySelector('#huxblog_navbar');
        var $collapse = document.querySelector('.navbar-collapse');

        var __HuxNav__ = {
            close: function () {
                $navbar.className = " ";
                // wait until animation end.
                setTimeout(function () {
                    // prevent frequently toggle
                    if ($navbar.className.indexOf('in') < 0) {
                        $collapse.style.height = "0px"
                    }
                }, 400)
            },
            open: function () {
                $collapse.style.height = "auto"
                $navbar.className += " in";
            }
        }

        // Bind Event
        $toggle.addEventListener('click', function (e) {
            if ($navbar.className.indexOf('in') > 0) {
                __HuxNav__.close()
            } else {
                __HuxNav__.open()
            }
        })

        /**
         * Since Fastclick is used to delegate 'touchstart' globally
         * to hack 300ms delay in iOS by performing a fake 'click',
         * Using 'e.stopPropagation' to stop 'touchstart' event from 
         * $toggle/$collapse will break global delegation.
         * 
         * Instead, we use a 'e.target' filter to prevent handler
         * added to document close HuxNav.  
         *
         * Also, we use 'click' instead of 'touchstart' as compromise
         */
        document.addEventListener('click', function (e) {
            if (e.target == $toggle) return;
            if (e.target.className == 'icon-bar') return;
            __HuxNav__.close();
        })
    </script>
    <!-- Search -->
<div class="search-page">
  <div class="search-icon-close-container">
    <span class="search-icon-close">
      <i class="fa fa-chevron-down"></i>
    </span>
  </div>
  <div class="search-main container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <form></form>
        <input type="text" id="search-input" placeholder="$ grep...">
        </form>
        <div id="search-results" class="mini-post-list"></div>
      </div>
    </div>
  </div>
</div>

    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/home-bg-geek.jpg" width="0" height="0"> -->

<!-- Post Header -->



<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/home-bg-geek.jpg');
        background: ;
    }

    
</style>




<header class="intro-header style-text" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=java" title="java">java</a>
                        
                        <a class="tag" href="/archive/?tag=spring" title="spring">spring</a>
                        
                        <a class="tag" href="/archive/?tag=%E5%AD%A6%E4%B9%A0" title="学习">学习</a>
                        
                    </div>
                    <h1>SpringMVC</h1>
                    
                    <h2 class="subheading"></h2>
                    <span class="meta">Posted by Procon on November 28, 2019</span>
                </div>
            </div>
        </div>
    </div>
</header>







<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

				<h1 id="一springmvc简介">一、SpringMVC简介</h1>

<h3 id="1什么是mvc">1、什么是MVC</h3>

<p>MVC是一种软件架构的思想，将软件按照模型、视图、控制器来划分</p>

<p>M：Model，模型层，指工程中的JavaBean，作用是处理数据</p>

<p>JavaBean分为两类：</p>

<ul>
  <li>一类称为实体类Bean：专门存储业务数据的，如 Student、User 等</li>
  <li>一类称为业务处理 Bean：指 Service 或 Dao 对象，专门用于处理业务逻辑和数据访问。</li>
</ul>

<p>V：View，视图层，指工程中的html或jsp等页面，作用是与用户进行交互，展示数据</p>

<p>C：Controller，控制层，指工程中的servlet，作用是接收请求和响应浏览器</p>

<p>MVC的工作流程：
用户通过视图层发送请求到服务器，在服务器中请求被Controller接收，Controller调用相应的Model层处理请求，处理完毕将结果返回到Controller，Controller再根据请求处理的结果找到相应的View视图，渲染数据后最终响应给浏览器</p>

<h3 id="2什么是springmvc">2、什么是SpringMVC</h3>

<p>SpringMVC是Spring的一个后续产品，是Spring的一个子项目</p>

<p>SpringMVC 是 Spring 为表述层开发提供的一整套完备的解决方案。在表述层框架历经 Strust、WebWork、Strust2 等诸多产品的历代更迭之后，目前业界普遍选择了 SpringMVC 作为 Java EE 项目表述层开发的<strong>首选方案</strong>。</p>

<blockquote>
  <p>注：三层架构分为表述层（或表示层）、业务逻辑层、数据访问层，表述层表示前台页面和后台servlet</p>
</blockquote>

<h3 id="3springmvc的特点">3、SpringMVC的特点</h3>

<ul>
  <li><strong>Spring 家族原生产品</strong>，与 IOC 容器等基础设施无缝对接</li>
  <li><strong>基于原生的Servlet</strong>，通过了功能强大的<strong>前端控制器DispatcherServlet</strong>，对请求和响应进行统一处理</li>
  <li>表述层各细分领域需要解决的问题<strong>全方位覆盖</strong>，提供<strong>全面解决方案</strong></li>
  <li><strong>代码清新简洁</strong>，大幅度提升开发效率</li>
  <li>内部组件化程度高，可插拔式组件<strong>即插即用</strong>，想要什么功能配置相应组件即可</li>
  <li><strong>性能卓著</strong>，尤其适合现代大型、超大型互联网项目要求</li>
</ul>

<h1 id="二helloworld">二、HelloWorld</h1>

<h3 id="1开发环境">1、开发环境</h3>

<p>IDE：idea 2019.2</p>

<p>构建工具：maven3.5.4</p>

<p>服务器：tomcat7</p>

<p>Spring版本：5.3.1</p>

<h3 id="2创建maven工程">2、创建maven工程</h3>

<h5 id="a添加web模块">a&gt;添加web模块</h5>

<h5 id="b打包方式war">b&gt;打包方式：war</h5>

<h5 id="c引入依赖">c&gt;引入依赖</h5>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;dependencies&gt;</span>
    <span class="c">&lt;!-- SpringMVC --&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-webmvc<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>5.3.1<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="c">&lt;!-- 日志 --&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>ch.qos.logback<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>logback-classic<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.2.3<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="c">&lt;!-- ServletAPI --&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>javax.servlet-api<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>3.1.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="c">&lt;!-- Spring5和Thymeleaf整合包 --&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.thymeleaf<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>thymeleaf-spring5<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>3.0.12.RELEASE<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
123456789101112131415161718192021222324252627282930
</pre></td></tr></tbody></table></code></pre></div></div>

<p>注：由于 Maven 的传递性，我们不必将所有需要的包全部配置依赖，而是配置最顶端的依赖，其他靠传递性导入。
<img src="https://procon-note.oss-cn-guangzhou.aliyuncs.com/typora/836b26dcd15140e486cb3a566abcc2b0.png" alt="在这里插入图片描述" /></p>

<h3 id="3配置webxml">3、配置web.xml</h3>

<p>注册SpringMVC的前端控制器DispatcherServlet</p>

<h5 id="a默认配置方式">a&gt;默认配置方式</h5>

<p>此配置作用下，SpringMVC的配置文件默认位于WEB-INF下，默认名称为<servlet-name>-servlet.xml，例如，以下配置所对应SpringMVC的配置文件位于WEB-INF下，文件名为springMVC-servlet.xml</servlet-name></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="c">&lt;!-- 配置SpringMVC的前端控制器，对浏览器发送的请求统一进行处理 --&gt;</span>
<span class="nt">&lt;servlet&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>springMVC<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
<span class="nt">&lt;/servlet&gt;</span>
<span class="nt">&lt;servlet-mapping&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>springMVC<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="c">&lt;!--
        设置springMVC的核心控制器所能处理的请求的请求路径
        /所匹配的请求可以是/login或.html或.js或.css方式的请求路径
        但是/不能匹配.jsp请求路径的请求
    --&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/servlet-mapping&gt;</span>
1234567891011121314
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="b扩展配置方式">b&gt;扩展配置方式</h5>

<p>可通过init-param标签设置SpringMVC配置文件的位置和名称，通过load-on-startup标签设置SpringMVC前端控制器DispatcherServlet的初始化时间</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="c">&lt;!-- 配置SpringMVC的前端控制器，对浏览器发送的请求统一进行处理 --&gt;</span>
<span class="nt">&lt;servlet&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>springMVC<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
    <span class="c">&lt;!-- 通过初始化参数指定SpringMVC配置文件的位置和名称 --&gt;</span>
    <span class="nt">&lt;init-param&gt;</span>
        <span class="c">&lt;!-- contextConfigLocation为固定值 --&gt;</span>
        <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
        <span class="c">&lt;!-- 使用classpath:表示从类路径查找配置文件，例如maven工程中的src/main/resources --&gt;</span>
        <span class="nt">&lt;param-value&gt;</span>classpath:springMVC.xml<span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/init-param&gt;</span>
    <span class="c">&lt;!-- 
 		作为框架的核心组件，在启动过程中有大量的初始化操作要做
		而这些操作放在第一次请求时才执行会严重影响访问速度
		因此需要通过此标签将启动控制DispatcherServlet的初始化时间提前到服务器启动时
	--&gt;</span>
    <span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
<span class="nt">&lt;/servlet&gt;</span>
<span class="nt">&lt;servlet-mapping&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>springMVC<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="c">&lt;!--
        设置springMVC的核心控制器所能处理的请求的请求路径
        /所匹配的请求可以是/login或.html或.js或.css方式的请求路径
        但是/不能匹配.jsp请求路径的请求
    --&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/servlet-mapping&gt;</span>
123456789101112131415161718192021222324252627
</pre></td></tr></tbody></table></code></pre></div></div>

<blockquote>
  <p>注：</p>

  <url-pattern>标签中使用/和/*的区别：

/所匹配的请求可以是/login或.html或.js或.css方式的请求路径，但是/不能匹配.jsp请求路径的请求

因此就可以避免在访问jsp页面时，该请求被DispatcherServlet处理，从而找不到相应的页面

/*则能够匹配所有请求，例如在使用过滤器时，若需要对所有请求进行过滤，就需要使用/*的写法
</url-pattern>
</blockquote>

<h3 id="4创建请求控制器">4、创建请求控制器</h3>

<p>由于前端控制器对浏览器发送的请求进行了统一的处理，但是具体的请求有不同的处理过程，因此需要创建处理具体请求的类，即请求控制器</p>

<p>请求控制器中每一个处理请求的方法成为控制器方法</p>

<p>因为SpringMVC的控制器由一个POJO（普通的Java类）担任，因此需要通过@Controller注解将其标识为一个控制层组件，交给Spring的IoC容器管理，此时SpringMVC才能够识别控制器的存在</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloController</span> <span class="o">{</span>
    
<span class="o">}</span>
<span class="mi">1234</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="5创建springmvc的配置文件">5、创建springMVC的配置文件</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre></td><td class="rouge-code"><pre><span class="c">&lt;!-- 自动扫描包 --&gt;</span>
<span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">"com.atguigu.mvc.controller"</span><span class="nt">/&gt;</span>

<span class="c">&lt;!-- 配置Thymeleaf视图解析器 --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"viewResolver"</span> <span class="na">class=</span><span class="s">"org.thymeleaf.spring5.view.ThymeleafViewResolver"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"order"</span> <span class="na">value=</span><span class="s">"1"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"characterEncoding"</span> <span class="na">value=</span><span class="s">"UTF-8"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"templateEngine"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.thymeleaf.spring5.SpringTemplateEngine"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"templateResolver"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.thymeleaf.spring5.templateresolver.SpringResourceTemplateResolver"</span><span class="nt">&gt;</span>
    
                    <span class="c">&lt;!-- 视图前缀 --&gt;</span>
                    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"prefix"</span> <span class="na">value=</span><span class="s">"/WEB-INF/templates/"</span><span class="nt">/&gt;</span>
    
                    <span class="c">&lt;!-- 视图后缀 --&gt;</span>
                    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"suffix"</span> <span class="na">value=</span><span class="s">".html"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"templateMode"</span> <span class="na">value=</span><span class="s">"HTML5"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"characterEncoding"</span> <span class="na">value=</span><span class="s">"UTF-8"</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;/bean&gt;</span>
            <span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="c">&lt;!-- 
   处理静态资源，例如html、js、css、jpg
  若只设置该标签，则只能访问静态资源，其他请求则无法访问
  此时必须设置&lt;mvc:annotation-driven/&gt;解决问题
 --&gt;</span>
<span class="nt">&lt;mvc:default-servlet-handler/&gt;</span>

<span class="c">&lt;!-- 开启mvc注解驱动 --&gt;</span>
<span class="nt">&lt;mvc:annotation-driven&gt;</span>
    <span class="nt">&lt;mvc:message-converters&gt;</span>
        <span class="c">&lt;!-- 处理响应中文内容乱码 --&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.springframework.http.converter.StringHttpMessageConverter"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"defaultCharset"</span> <span class="na">value=</span><span class="s">"UTF-8"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"supportedMediaTypes"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;list&gt;</span>
                    <span class="nt">&lt;value&gt;</span>text/html<span class="nt">&lt;/value&gt;</span>
                    <span class="nt">&lt;value&gt;</span>application/json<span class="nt">&lt;/value&gt;</span>
                <span class="nt">&lt;/list&gt;</span>
            <span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;/mvc:message-converters&gt;</span>
<span class="nt">&lt;/mvc:annotation-driven&gt;</span>
1234567891011121314151617181920212223242526272829303132333435363738394041424344454647
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="6测试helloworld">6、测试HelloWorld</h3>

<h5 id="a实现对首页的访问">a&gt;实现对首页的访问</h5>

<p>在请求控制器中创建处理请求的方法</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c1">// @RequestMapping注解：处理请求和控制器方法之间的映射关系</span>
<span class="c1">// @RequestMapping注解的value属性可以通过请求地址匹配请求，/表示的当前工程的上下文路径</span>
<span class="c1">// localhost:8080/springMVC/</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">index</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">//设置视图名称</span>
    <span class="k">return</span> <span class="s">"index"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">12345678</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="b通过超链接跳转到指定页面">b&gt;通过超链接跳转到指定页面</h5>

<p>在主页index.html中设置超链接</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span> <span class="na">xmlns:th=</span><span class="s">"http://www.thymeleaf.org"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>首页<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>首页<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{/hello}"</span><span class="nt">&gt;</span>HelloWorld<span class="nt">&lt;/a&gt;&lt;br/&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
1234567891011
</pre></td></tr></tbody></table></code></pre></div></div>

<p>在请求控制器中创建处理请求的方法</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/hello"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">HelloWorld</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"target"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">1234</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="7总结">7、总结</h3>

<p>浏览器发送请求，若请求地址符合前端控制器的url-pattern，该请求就会被前端控制器DispatcherServlet处理。前端控制器会读取SpringMVC的核心配置文件，通过扫描组件找到控制器，将请求地址和控制器中@RequestMapping注解的value属性值进行匹配，若匹配成功，该注解所标识的控制器方法就是处理请求的方法。处理请求的方法需要返回一个字符串类型的视图名称，该视图名称会被视图解析器解析，加上前缀和后缀组成视图的路径，通过Thymeleaf对视图进行渲染，最终转发到视图所对应页面</p>

<h1 id="三requestmapping注解">三、@RequestMapping注解</h1>

<h3 id="1requestmapping注解的功能">1、@RequestMapping注解的功能</h3>

<p>从注解名称上我们可以看到，@RequestMapping注解的作用就是将请求和处理请求的控制器方法关联起来，建立映射关系。</p>

<p>SpringMVC 接收到指定的请求，就会来找到在映射关系中对应的控制器方法来处理这个请求。</p>

<h3 id="2requestmapping注解的位置">2、@RequestMapping注解的位置</h3>

<p>@RequestMapping标识一个类：设置映射请求的请求路径的初始信息</p>

<p>@RequestMapping标识一个方法：设置映射请求请求路径的具体信息</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/test"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RequestMappingController</span> <span class="o">{</span>

	<span class="c1">//此时请求映射所映射的请求的请求路径为：/test/testRequestMapping</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/testRequestMapping"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">testRequestMapping</span><span class="o">(){</span>
        <span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
<span class="mi">1234567891011</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3requestmapping注解的value属性">3、@RequestMapping注解的value属性</h3>

<p>@RequestMapping注解的value属性通过请求的请求地址匹配请求映射</p>

<p>@RequestMapping注解的value属性是一个字符串类型的数组，表示该请求映射能够匹配多个请求地址所对应的请求</p>

<p>@RequestMapping注解的value属性必须设置，至少通过请求地址匹配请求映射</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{/testRequestMapping}"</span><span class="nt">&gt;</span>测试@RequestMapping的value属性--&gt;/testRequestMapping<span class="nt">&lt;/a&gt;&lt;br&gt;</span>
<span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{/test}"</span><span class="nt">&gt;</span>测试@RequestMapping的value属性--&gt;/test<span class="nt">&lt;/a&gt;&lt;br&gt;</span>
12
@RequestMapping(
        value = {"/testRequestMapping", "/test"}
)
public String testRequestMapping(){
    return "success";
}
123456
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="4requestmapping注解的method属性">4、@RequestMapping注解的method属性</h3>

<p>@RequestMapping注解的method属性通过请求的请求方式（get或post）匹配请求映射</p>

<p>@RequestMapping注解的method属性是一个RequestMethod类型的数组，表示该请求映射能够匹配多种请求方式的请求</p>

<p>若当前请求的请求地址满足请求映射的value属性，但是请求方式不满足method属性，则浏览器报错405：Request method ‘POST’ not supported</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{/test}"</span><span class="nt">&gt;</span>测试@RequestMapping的value属性--&gt;/test<span class="nt">&lt;/a&gt;&lt;br&gt;</span>
<span class="nt">&lt;form</span> <span class="na">th:action=</span><span class="s">"@{/test}"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
1234
@RequestMapping(
        value = {"/testRequestMapping", "/test"},
        method = {RequestMethod.GET, RequestMethod.POST}
)
public String testRequestMapping(){
    return "success";
}
1234567
</pre></td></tr></tbody></table></code></pre></div></div>

<blockquote>
  <p>注：</p>

  <p>1、对于处理指定请求方式的控制器方法，SpringMVC中提供了@RequestMapping的派生注解</p>

  <p>处理get请求的映射–&gt;@GetMapping</p>

  <p>处理post请求的映射–&gt;@PostMapping</p>

  <p>处理put请求的映射–&gt;@PutMapping</p>

  <p>处理delete请求的映射–&gt;@DeleteMapping</p>

  <p>2、常用的请求方式有get，post，put，delete</p>

  <p>但是目前浏览器只支持get和post，若在form表单提交时，为method设置了其他请求方式的字符串（put或delete），则按照默认的请求方式get处理</p>

  <p>若要发送put和delete请求，则需要通过spring提供的过滤器HiddenHttpMethodFilter，在RESTful部分会讲到</p>
</blockquote>

<h3 id="5requestmapping注解的params属性了解">5、@RequestMapping注解的params属性（了解）</h3>

<p>@RequestMapping注解的params属性通过请求的请求参数匹配请求映射</p>

<p>@RequestMapping注解的params属性是一个字符串类型的数组，可以通过四种表达式设置请求参数和请求映射的匹配关系</p>

<p>“param”：要求请求映射所匹配的请求必须携带param请求参数</p>

<p>“!param”：要求请求映射所匹配的请求必须不能携带param请求参数</p>

<p>“param=value”：要求请求映射所匹配的请求必须携带param请求参数且param=value</p>

<p>“param!=value”：要求请求映射所匹配的请求必须携带param请求参数但是param!=value</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{/test(username='admin',password=123456)"</span><span class="nt">&gt;</span>测试@RequestMapping的params属性--&gt;/test<span class="nt">&lt;/a&gt;&lt;br&gt;</span>
1
@RequestMapping(
        value = {"/testRequestMapping", "/test"}
        ,method = {RequestMethod.GET, RequestMethod.POST}
        ,params = {"username","password!=123456"}
)
public String testRequestMapping(){
    return "success";
}
12345678
</pre></td></tr></tbody></table></code></pre></div></div>

<blockquote>
  <p>注：</p>

  <p>若当前请求满足@RequestMapping注解的value和method属性，但是不满足params属性，此时页面回报错400：Parameter conditions “username, password!=123456” not met for actual request parameters: username={admin}, password={123456}</p>
</blockquote>

<h3 id="6requestmapping注解的headers属性了解">6、@RequestMapping注解的headers属性（了解）</h3>

<p>@RequestMapping注解的headers属性通过请求的请求头信息匹配请求映射</p>

<p>@RequestMapping注解的headers属性是一个字符串类型的数组，可以通过四种表达式设置请求头信息和请求映射的匹配关系</p>

<p>“header”：要求请求映射所匹配的请求必须携带header请求头信息</p>

<p>“!header”：要求请求映射所匹配的请求必须不能携带header请求头信息</p>

<p>“header=value”：要求请求映射所匹配的请求必须携带header请求头信息且header=value</p>

<p>“header!=value”：要求请求映射所匹配的请求必须携带header请求头信息且header!=value</p>

<p>若当前请求满足@RequestMapping注解的value和method属性，但是不满足headers属性，此时页面显示404错误，即资源未找到</p>

<h3 id="7springmvc支持ant风格的路径">7、SpringMVC支持ant风格的路径</h3>

<p>？：表示任意的单个字符</p>

<p>*：表示任意的0个或多个字符</p>

<p>**：表示任意的一层或多层目录</p>

<p>注意：在使用<strong>时，只能使用/</strong>/xxx的方式</p>

<h3 id="8springmvc支持路径中的占位符重点">8、SpringMVC支持路径中的占位符（重点）</h3>

<p>原始方式：/deleteUser?id=1</p>

<p>rest方式：/deleteUser/1</p>

<p>SpringMVC路径中的占位符常用于RESTful风格中，当请求路径中将某些数据通过路径的方式传输到服务器中，就可以在相应的@RequestMapping注解的value属性中通过占位符{xxx}表示传输的数据，在通过@PathVariable注解，将占位符所表示的数据赋值给控制器方法的形参</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{/testRest/1/admin}"</span><span class="nt">&gt;</span>测试路径中的占位符--&gt;/testRest<span class="nt">&lt;/a&gt;&lt;br&gt;</span>
1
@RequestMapping("/testRest/{id}/{username}")
public String testRest(@PathVariable("id") String id, @PathVariable("username") String username){
    System.out.println("id:"+id+",username:"+username);
    return "success";
}
//最终输出的内容为--&gt;id:1,username:admin
123456
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="四springmvc获取请求参数">四、SpringMVC获取请求参数</h1>

<h3 id="1通过servletapi获取">1、通过ServletAPI获取</h3>

<p>将HttpServletRequest作为控制器方法的形参，此时HttpServletRequest类型的参数表示封装了当前请求的请求报文的对象</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/testParam"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">testParam</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
    <span class="nc">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"username"</span><span class="o">);</span>
    <span class="nc">String</span> <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"password"</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"username:"</span><span class="o">+</span><span class="n">username</span><span class="o">+</span><span class="s">",password:"</span><span class="o">+</span><span class="n">password</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">1234567</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2通过控制器方法的形参获取请求参数">2、通过控制器方法的形参获取请求参数</h3>

<p>在控制器方法的形参位置，设置和请求参数同名的形参，当浏览器发送请求，匹配到请求映射时，在DispatcherServlet中就会将请求参数赋值给相应的形参</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{/testParam(username='admin',password=123456)}"</span><span class="nt">&gt;</span>测试获取请求参数--&gt;/testParam<span class="nt">&lt;/a&gt;&lt;br&gt;</span>
1
@RequestMapping("/testParam")
public String testParam(String username, String password){
    System.out.println("username:"+username+",password:"+password);
    return "success";
}
12345
</pre></td></tr></tbody></table></code></pre></div></div>

<blockquote>
  <p>注：</p>

  <p>若请求所传输的请求参数中有多个同名的请求参数，此时可以在控制器方法的形参中设置字符串数组或者字符串类型的形参接收此请求参数</p>

  <p>若使用字符串数组类型的形参，此参数的数组中包含了每一个数据</p>

  <p>若使用字符串类型的形参，此参数的值为每个数据中间使用逗号拼接的结果</p>
</blockquote>

<h3 id="3requestparam">3、@RequestParam</h3>

<p>@RequestParam是将请求参数和控制器方法的形参创建映射关系</p>

<p>@RequestParam注解一共有三个属性：</p>

<p>value：指定为形参赋值的请求参数的参数名</p>

<p>required：设置是否必须传输此请求参数，默认值为true</p>

<p>若设置为true时，则当前请求必须传输value所指定的请求参数，若没有传输该请求参数，且没有设置defaultValue属性，则页面报错400：Required String parameter ‘xxx’ is not present；若设置为false，则当前请求不是必须传输value所指定的请求参数，若没有传输，则注解所标识的形参的值为null</p>

<p>defaultValue：不管required属性值为true或false，当value所指定的请求参数没有传输或传输的值为”“时，则使用默认值为形参赋值</p>

<h3 id="4requestheader">4、@RequestHeader</h3>

<p>@RequestHeader是将请求头信息和控制器方法的形参创建映射关系</p>

<p>@RequestHeader注解一共有三个属性：value、required、defaultValue，用法同@RequestParam</p>

<h3 id="5cookievalue">5、@CookieValue</h3>

<p>@CookieValue是将cookie数据和控制器方法的形参创建映射关系</p>

<p>@CookieValue注解一共有三个属性：value、required、defaultValue，用法同@RequestParam</p>

<h3 id="6通过pojo获取请求参数">6、通过POJO获取请求参数</h3>

<p>可以在控制器方法的形参位置设置一个实体类类型的形参，此时若浏览器传输的请求参数的参数名和实体类中的属性名一致，那么请求参数就会为此属性赋值</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;form</span> <span class="na">th:action=</span><span class="s">"@{/testpojo}"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
    用户名：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"username"</span><span class="nt">&gt;&lt;br&gt;</span>
    密码：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span><span class="nt">&gt;&lt;br&gt;</span>
    性别：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"sex"</span> <span class="na">value=</span><span class="s">"男"</span><span class="nt">&gt;</span>男<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"sex"</span> <span class="na">value=</span><span class="s">"女"</span><span class="nt">&gt;</span>女<span class="nt">&lt;br&gt;</span>
    年龄：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"age"</span><span class="nt">&gt;&lt;br&gt;</span>
    邮箱：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"email"</span><span class="nt">&gt;&lt;br&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
12345678
@RequestMapping("/testpojo")
public String testPOJO(User user){
    System.out.println(user);
    return "success";
}
//最终结果--&gt;User{id=null, username='张三', password='123', age=23, sex='男', email='123@qq.com'}
123456
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="7解决获取请求参数的乱码问题">7、解决获取请求参数的乱码问题</h3>

<p>解决获取请求参数的乱码问题，可以使用SpringMVC提供的编码过滤器CharacterEncodingFilter，但是必须在web.xml中进行注册</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="c">&lt;!--配置springMVC的编码过滤器--&gt;</span>
<span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="nt">&lt;/filter-class&gt;</span>
    <span class="nt">&lt;init-param&gt;</span>
        <span class="nt">&lt;param-name&gt;</span>encoding<span class="nt">&lt;/param-name&gt;</span>
        <span class="nt">&lt;param-value&gt;</span>UTF-8<span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/init-param&gt;</span>
    <span class="nt">&lt;init-param&gt;</span>
        <span class="nt">&lt;param-name&gt;</span>forceResponseEncoding<span class="nt">&lt;/param-name&gt;</span>
        <span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/init-param&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span>
1234567891011121314151617
</pre></td></tr></tbody></table></code></pre></div></div>

<blockquote>
  <p>注：</p>

  <p>SpringMVC中处理编码的过滤器一定要配置到其他过滤器之前，否则无效</p>
</blockquote>

<h1 id="五域对象共享数据">五、域对象共享数据</h1>

<h3 id="1使用servletapi向request域对象共享数据">1、使用ServletAPI向request域对象共享数据</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/testServletAPI"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">testServletAPI</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
    <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"testScope"</span><span class="o">,</span> <span class="s">"hello,servletAPI"</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">12345</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2使用modelandview向request域对象共享数据">2、使用ModelAndView向request域对象共享数据</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/testModelAndView"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">ModelAndView</span> <span class="nf">testModelAndView</span><span class="o">(){</span>
    <span class="cm">/**
     * ModelAndView有Model和View的功能
     * Model主要用于向请求域共享数据
     * View主要用于设置视图，实现页面跳转
     */</span>
    <span class="nc">ModelAndView</span> <span class="n">mav</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ModelAndView</span><span class="o">();</span>
    <span class="c1">//向请求域共享数据</span>
    <span class="n">mav</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="s">"testScope"</span><span class="o">,</span> <span class="s">"hello,ModelAndView"</span><span class="o">);</span>
    <span class="c1">//设置视图，实现页面跳转</span>
    <span class="n">mav</span><span class="o">.</span><span class="na">setViewName</span><span class="o">(</span><span class="s">"success"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">mav</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">1234567891011121314</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3使用model向request域对象共享数据">3、使用Model向request域对象共享数据</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/testModel"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">testModel</span><span class="o">(</span><span class="nc">Model</span> <span class="n">model</span><span class="o">){</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"testScope"</span><span class="o">,</span> <span class="s">"hello,Model"</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">12345</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="4使用map向request域对象共享数据">4、使用map向request域对象共享数据</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/testMap"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">testMap</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">){</span>
    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"testScope"</span><span class="o">,</span> <span class="s">"hello,Map"</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">12345</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="5使用modelmap向request域对象共享数据">5、使用ModelMap向request域对象共享数据</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/testModelMap"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">testModelMap</span><span class="o">(</span><span class="nc">ModelMap</span> <span class="n">modelMap</span><span class="o">){</span>
    <span class="n">modelMap</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"testScope"</span><span class="o">,</span> <span class="s">"hello,ModelMap"</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">12345</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="6modelmodelmapmap的关系">6、Model、ModelMap、Map的关系</h3>

<p>Model、ModelMap、Map类型的参数其实本质上都是 BindingAwareModelMap 类型的</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>public interface Model{}
public class ModelMap extends LinkedHashMap&lt;String, Object&gt; {}
public class ExtendedModelMap extends ModelMap implements Model {}
public class BindingAwareModelMap extends ExtendedModelMap {}
1234
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="7向session域共享数据">7、向session域共享数据</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/testSession"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">testSession</span><span class="o">(</span><span class="nc">HttpSession</span> <span class="n">session</span><span class="o">){</span>
    <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"testSessionScope"</span><span class="o">,</span> <span class="s">"hello,session"</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">12345</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="8向application域共享数据">8、向application域共享数据</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/testApplication"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">testApplication</span><span class="o">(</span><span class="nc">HttpSession</span> <span class="n">session</span><span class="o">){</span>
	<span class="nc">ServletContext</span> <span class="n">application</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">();</span>
    <span class="n">application</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"testApplicationScope"</span><span class="o">,</span> <span class="s">"hello,application"</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">123456</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="六springmvc的视图">六、SpringMVC的视图</h1>

<p>SpringMVC中的视图是View接口，视图的作用渲染数据，将模型Model中的数据展示给用户</p>

<p>SpringMVC视图的种类很多，默认有转发视图和重定向视图</p>

<p>当工程引入jstl的依赖，转发视图会自动转换为JstlView</p>

<p>若使用的视图技术为Thymeleaf，在SpringMVC的配置文件中配置了Thymeleaf的视图解析器，由此视图解析器解析之后所得到的是ThymeleafView</p>

<h3 id="1thymeleafview">1、ThymeleafView</h3>

<p>当控制器方法中所设置的视图名称没有任何前缀时，此时的视图名称会被SpringMVC配置文件中所配置的视图解析器解析，视图名称拼接视图前缀和视图后缀所得到的最终路径，会通过转发的方式实现跳转</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/testHello"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">testHello</span><span class="o">(){</span>
    <span class="k">return</span> <span class="s">"hello"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">1234</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="https://procon-note.oss-cn-guangzhou.aliyuncs.com/typora/781f6b299e6b41a8b006866ecbcb76ba.png" alt="在这里插入图片描述" /></p>

<h3 id="2转发视图">2、转发视图</h3>

<p>SpringMVC中默认的转发视图是InternalResourceView</p>

<p>SpringMVC中创建转发视图的情况：</p>

<p>当控制器方法中所设置的视图名称以”forward:”为前缀时，创建InternalResourceView视图，此时的视图名称不会被SpringMVC配置文件中所配置的视图解析器解析，而是会将前缀”forward:”去掉，剩余部分作为最终路径通过转发的方式实现跳转</p>

<p>例如”forward:/”，“forward:/employee”</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/testForward"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">testForward</span><span class="o">(){</span>
    <span class="k">return</span> <span class="s">"forward:/testHello"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">1234</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="https://procon-note.oss-cn-guangzhou.aliyuncs.com/typora/71526c269bbb447b8701d906b2859965.png" alt="在这里插入图片描述" /></p>

<h3 id="3重定向视图">3、重定向视图</h3>

<p>SpringMVC中默认的重定向视图是RedirectView</p>

<p>当控制器方法中所设置的视图名称以”redirect:”为前缀时，创建RedirectView视图，此时的视图名称不会被SpringMVC配置文件中所配置的视图解析器解析，而是会将前缀”redirect:”去掉，剩余部分作为最终路径通过重定向的方式实现跳转</p>

<p>例如”redirect:/”，“redirect:/employee”</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/testRedirect"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">testRedirect</span><span class="o">(){</span>
    <span class="k">return</span> <span class="s">"redirect:/testHello"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">1234</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="https://procon-note.oss-cn-guangzhou.aliyuncs.com/typora/ec5b5371ea804cafb27e2751231df362.png" alt="在这里插入图片描述" /></p>

<blockquote>
  <p>注：</p>

  <p>重定向视图在解析时，会先将redirect:前缀去掉，然后会判断剩余部分是否以/开头，若是则会自动拼接上下文路径</p>
</blockquote>

<h3 id="4视图控制器view-controller">4、视图控制器view-controller</h3>

<p>当控制器方法中，仅仅用来实现页面跳转，即只需要设置视图名称时，可以将处理器方法使用view-controller标签进行表示</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c">&lt;!--
	path：设置处理的请求地址
	view-name：设置请求地址所对应的视图名称
--&gt;</span>
<span class="nt">&lt;mvc:view-controller</span> <span class="na">path=</span><span class="s">"/testView"</span> <span class="na">view-name=</span><span class="s">"success"</span><span class="nt">&gt;&lt;/mvc:view-controller&gt;</span>
12345
</pre></td></tr></tbody></table></code></pre></div></div>

<blockquote>
  <p>注：</p>

  <p>当SpringMVC中设置任何一个view-controller时，其他控制器中的请求映射将全部失效，此时需要在SpringMVC的核心配置文件中设置开启mvc注解驱动的标签：</p>

  <mvc:annotation-driven />

</blockquote>

<h1 id="七restful">七、RESTful</h1>

<h3 id="1restful简介">1、RESTful简介</h3>

<p>REST：<strong>Re</strong>presentational <strong>S</strong>tate <strong>T</strong>ransfer，表现层资源状态转移。</p>

<h5 id="a资源">a&gt;资源</h5>

<p>资源是一种看待服务器的方式，即，将服务器看作是由很多离散的资源组成。每个资源是服务器上一个可命名的抽象概念。因为资源是一个抽象的概念，所以它不仅仅能代表服务器文件系统中的一个文件、数据库中的一张表等等具体的东西，可以将资源设计的要多抽象有多抽象，只要想象力允许而且客户端应用开发者能够理解。与面向对象设计类似，资源是以名词为核心来组织的，首先关注的是名词。一个资源可以由一个或多个URI来标识。URI既是资源的名称，也是资源在Web上的地址。对某个资源感兴趣的客户端应用，可以通过资源的URI与其进行交互。</p>

<h5 id="b资源的表述">b&gt;资源的表述</h5>

<p>资源的表述是一段对于资源在某个特定时刻的状态的描述。可以在客户端-服务器端之间转移（交换）。资源的表述可以有多种格式，例如HTML/XML/JSON/纯文本/图片/视频/音频等等。资源的表述格式可以通过协商机制来确定。请求-响应方向的表述通常使用不同的格式。</p>

<h5 id="c状态转移">c&gt;状态转移</h5>

<p>状态转移说的是：在客户端和服务器端之间转移（transfer）代表资源状态的表述。通过转移和操作资源的表述，来间接实现操作资源的目的。</p>

<h3 id="2restful的实现">2、RESTful的实现</h3>

<p>具体说，就是 HTTP 协议里面，四个表示操作方式的动词：GET、POST、PUT、DELETE。</p>

<p>它们分别对应四种基本操作：GET 用来获取资源，POST 用来新建资源，PUT 用来更新资源，DELETE 用来删除资源。</p>

<p>REST 风格提倡 URL 地址使用统一的风格设计，从前到后各个单词使用斜杠分开，不使用问号键值对方式携带请求参数，而是将要发送给服务器的数据作为 URL 地址的一部分，以保证整体风格的一致性。</p>

<table>
  <thead>
    <tr>
      <th>操作</th>
      <th>传统方式</th>
      <th>REST风格</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>查询操作</td>
      <td>getUserById?id=1</td>
      <td>user/1–&gt;get请求方式</td>
    </tr>
    <tr>
      <td>保存操作</td>
      <td>saveUser</td>
      <td>user–&gt;post请求方式</td>
    </tr>
    <tr>
      <td>删除操作</td>
      <td>deleteUser?id=1</td>
      <td>user/1–&gt;delete请求方式</td>
    </tr>
    <tr>
      <td>更新操作</td>
      <td>updateUser</td>
      <td>user–&gt;put请求方式</td>
    </tr>
  </tbody>
</table>

<h3 id="3hiddenhttpmethodfilter">3、HiddenHttpMethodFilter</h3>

<p>由于浏览器只支持发送get和post方式的请求，那么该如何发送put和delete请求呢？</p>

<p>SpringMVC 提供了 <strong>HiddenHttpMethodFilter</strong> 帮助我们<strong>将 POST 请求转换为 DELETE 或 PUT 请求</strong></p>

<p><strong>HiddenHttpMethodFilter</strong> 处理put和delete请求的条件：</p>

<p>a&gt;当前请求的请求方式必须为post</p>

<p>b&gt;当前请求必须传输请求参数_method</p>

<p>满足以上条件，<strong>HiddenHttpMethodFilter</strong> 过滤器就会将当前请求的请求方式转换为请求参数_method的值，因此请求参数_method的值才是最终的请求方式</p>

<p>在web.xml中注册<strong>HiddenHttpMethodFilter</strong></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>HiddenHttpMethodFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="nt">&lt;/filter-class&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>HiddenHttpMethodFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span>
12345678
</pre></td></tr></tbody></table></code></pre></div></div>

<blockquote>
  <p>注：</p>

  <p>目前为止，SpringMVC中提供了两个过滤器：CharacterEncodingFilter和HiddenHttpMethodFilter</p>

  <p>在web.xml中注册时，必须先注册CharacterEncodingFilter，再注册HiddenHttpMethodFilter</p>

  <p>原因：</p>

  <ul>
    <li>
      <p>在 CharacterEncodingFilter 中通过 request.setCharacterEncoding(encoding) 方法设置字符集的</p>
    </li>
    <li>
      <p>request.setCharacterEncoding(encoding) 方法要求前面不能有任何获取请求参数的操作</p>
    </li>
    <li>
      <p>而 HiddenHttpMethodFilter 恰恰有一个获取请求方式的操作：</p>
    </li>
    <li>
      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>String paramValue = request.getParameter(this.methodParam);
1
</pre></td></tr></tbody></table></code></pre></div>      </div>
    </li>
  </ul>
</blockquote>

<h1 id="八restful案例">八、RESTful案例</h1>

<h3 id="1准备工作">1、准备工作</h3>

<p>和传统 CRUD 一样，实现对员工信息的增删改查。</p>

<ul>
  <li>
    <p>搭建环境</p>
  </li>
  <li>
    <p>准备实体类</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.atguigu.mvc.bean</span><span class="o">;</span>
  
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>
  
   <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>
   <span class="kd">private</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span>
  
   <span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>
   <span class="c1">//1 male, 0 female</span>
   <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">gender</span><span class="o">;</span>
     
   <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
   <span class="o">}</span>
  
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
   <span class="o">}</span>
  
   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getLastName</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">lastName</span><span class="o">;</span>
   <span class="o">}</span>
  
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLastName</span><span class="o">(</span><span class="nc">String</span> <span class="n">lastName</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">lastName</span> <span class="o">=</span> <span class="n">lastName</span><span class="o">;</span>
   <span class="o">}</span>
  
   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getEmail</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">email</span><span class="o">;</span>
   <span class="o">}</span>
  
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEmail</span><span class="o">(</span><span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
   <span class="o">}</span>
  
   <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">getGender</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">gender</span><span class="o">;</span>
   <span class="o">}</span>
  
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setGender</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">gender</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">gender</span> <span class="o">=</span> <span class="n">gender</span><span class="o">;</span>
   <span class="o">}</span>
  
   <span class="kd">public</span> <span class="nf">Employee</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">,</span> <span class="nc">String</span> <span class="n">email</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">gender</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">super</span><span class="o">();</span>
      <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">lastName</span> <span class="o">=</span> <span class="n">lastName</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">gender</span> <span class="o">=</span> <span class="n">gender</span><span class="o">;</span>
   <span class="o">}</span>
  
   <span class="kd">public</span> <span class="nf">Employee</span><span class="o">()</span> <span class="o">{</span>
   <span class="o">}</span>
<span class="o">}</span>
<span class="mi">123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>准备dao模拟数据</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.atguigu.mvc.dao</span><span class="o">;</span>
  
<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
  
<span class="kn">import</span> <span class="nn">com.atguigu.mvc.bean.Employee</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="o">;</span>
  
  
<span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmployeeDao</span> <span class="o">{</span>
  
   <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Employee</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
     
   <span class="kd">static</span><span class="o">{</span>
      <span class="n">employees</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Employee</span><span class="o">&gt;();</span>
  
      <span class="n">employees</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="mi">1001</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Employee</span><span class="o">(</span><span class="mi">1001</span><span class="o">,</span> <span class="s">"E-AA"</span><span class="o">,</span> <span class="s">"aa@163.com"</span><span class="o">,</span> <span class="mi">1</span><span class="o">));</span>
      <span class="n">employees</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="mi">1002</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Employee</span><span class="o">(</span><span class="mi">1002</span><span class="o">,</span> <span class="s">"E-BB"</span><span class="o">,</span> <span class="s">"bb@163.com"</span><span class="o">,</span> <span class="mi">1</span><span class="o">));</span>
      <span class="n">employees</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="mi">1003</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Employee</span><span class="o">(</span><span class="mi">1003</span><span class="o">,</span> <span class="s">"E-CC"</span><span class="o">,</span> <span class="s">"cc@163.com"</span><span class="o">,</span> <span class="mi">0</span><span class="o">));</span>
      <span class="n">employees</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="mi">1004</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Employee</span><span class="o">(</span><span class="mi">1004</span><span class="o">,</span> <span class="s">"E-DD"</span><span class="o">,</span> <span class="s">"dd@163.com"</span><span class="o">,</span> <span class="mi">0</span><span class="o">));</span>
      <span class="n">employees</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="mi">1005</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Employee</span><span class="o">(</span><span class="mi">1005</span><span class="o">,</span> <span class="s">"E-EE"</span><span class="o">,</span> <span class="s">"ee@163.com"</span><span class="o">,</span> <span class="mi">1</span><span class="o">));</span>
   <span class="o">}</span>
     
   <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Integer</span> <span class="n">initId</span> <span class="o">=</span> <span class="mi">1006</span><span class="o">;</span>
     
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="nc">Employee</span> <span class="n">employee</span><span class="o">){</span>
      <span class="k">if</span><span class="o">(</span><span class="n">employee</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
         <span class="n">employee</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">initId</span><span class="o">++);</span>
      <span class="o">}</span>
      <span class="n">employees</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">employee</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">employee</span><span class="o">);</span>
   <span class="o">}</span>
     
   <span class="kd">public</span> <span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">Employee</span><span class="o">&gt;</span> <span class="nf">getAll</span><span class="o">(){</span>
      <span class="k">return</span> <span class="n">employees</span><span class="o">.</span><span class="na">values</span><span class="o">();</span>
   <span class="o">}</span>
     
   <span class="kd">public</span> <span class="nc">Employee</span> <span class="nf">get</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">){</span>
      <span class="k">return</span> <span class="n">employees</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
   <span class="o">}</span>
     
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">){</span>
      <span class="n">employees</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span>
<span class="mi">12345678910111213141516171819202122232425262728293031323334353637383940414243444546</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
</ul>

<h3 id="2功能清单">2、功能清单</h3>

<table>
  <thead>
    <tr>
      <th>功能</th>
      <th>URL 地址</th>
      <th>请求方式</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>访问首页√</td>
      <td>/</td>
      <td>GET</td>
    </tr>
    <tr>
      <td>查询全部数据√</td>
      <td>/employee</td>
      <td>GET</td>
    </tr>
    <tr>
      <td>删除√</td>
      <td>/employee/2</td>
      <td>DELETE</td>
    </tr>
    <tr>
      <td>跳转到添加数据页面√</td>
      <td>/toAdd</td>
      <td>GET</td>
    </tr>
    <tr>
      <td>执行保存√</td>
      <td>/employee</td>
      <td>POST</td>
    </tr>
    <tr>
      <td>跳转到更新数据页面√</td>
      <td>/employee/2</td>
      <td>GET</td>
    </tr>
    <tr>
      <td>执行更新√</td>
      <td>/employee</td>
      <td>PUT</td>
    </tr>
  </tbody>
</table>

<h3 id="3具体功能访问首页">3、具体功能：访问首页</h3>

<h5 id="a配置view-controller">a&gt;配置view-controller</h5>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;mvc:view-controller</span> <span class="na">path=</span><span class="s">"/"</span> <span class="na">view-name=</span><span class="s">"index"</span><span class="nt">/&gt;</span>
1
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="b创建页面">b&gt;创建页面</h5>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span> <span class="na">xmlns:th=</span><span class="s">"http://www.thymeleaf.org"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Title<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>首页<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{/employee}"</span><span class="nt">&gt;</span>访问员工信息<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
1234567891011
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="4具体功能查询所有员工数据">4、具体功能：查询所有员工数据</h3>

<h5 id="a控制器方法">a&gt;控制器方法</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/employee"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getEmployeeList</span><span class="o">(</span><span class="nc">Model</span> <span class="n">model</span><span class="o">){</span>
    <span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">Employee</span><span class="o">&gt;</span> <span class="n">employeeList</span> <span class="o">=</span> <span class="n">employeeDao</span><span class="o">.</span><span class="na">getAll</span><span class="o">();</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"employeeList"</span><span class="o">,</span> <span class="n">employeeList</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">"employee_list"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">123456</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="b创建employee_listhtml">b&gt;创建employee_list.html</h5>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span> <span class="na">xmlns:th=</span><span class="s">"http://www.thymeleaf.org"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Employee Info<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">th:src=</span><span class="s">"@{/static/js/vue.js}"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

    <span class="nt">&lt;table</span> <span class="na">border=</span><span class="s">"1"</span> <span class="na">cellpadding=</span><span class="s">"0"</span> <span class="na">cellspacing=</span><span class="s">"0"</span> <span class="na">style=</span><span class="s">"text-align: center;"</span> <span class="na">id=</span><span class="s">"dataTable"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;th</span> <span class="na">colspan=</span><span class="s">"5"</span><span class="nt">&gt;</span>Employee Info<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;th&gt;</span>id<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;th&gt;</span>lastName<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;th&gt;</span>email<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;th&gt;</span>gender<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;th&gt;</span>options(<span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{/toAdd}"</span><span class="nt">&gt;</span>add<span class="nt">&lt;/a&gt;</span>)<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;tr</span> <span class="na">th:each=</span><span class="s">"employee : ${employeeList}"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;td</span> <span class="na">th:text=</span><span class="s">"${employee.id}"</span><span class="nt">&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;td</span> <span class="na">th:text=</span><span class="s">"${employee.lastName}"</span><span class="nt">&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;td</span> <span class="na">th:text=</span><span class="s">"${employee.email}"</span><span class="nt">&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;td</span> <span class="na">th:text=</span><span class="s">"${employee.gender}"</span><span class="nt">&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"deleteA"</span> <span class="err">@</span><span class="na">click=</span><span class="s">"deleteEmployee"</span> <span class="na">th:href=</span><span class="s">"@{'/employee/'+${employee.id}}"</span><span class="nt">&gt;</span>delete<span class="nt">&lt;/a&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{'/employee/'+${employee.id}}"</span><span class="nt">&gt;</span>update<span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
123456789101112131415161718192021222324252627282930313233
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="5具体功能删除">5、具体功能：删除</h3>

<h5 id="a创建处理delete请求方式的表单">a&gt;创建处理delete请求方式的表单</h5>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c">&lt;!-- 作用：通过超链接控制表单的提交，将post请求转换为delete请求 --&gt;</span>
<span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"delete_form"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- HiddenHttpMethodFilter要求：必须传输_method请求参数，并且值为最终的请求方式 --&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"_method"</span> <span class="na">value=</span><span class="s">"delete"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
12345
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="b删除超链接绑定点击事件">b&gt;删除超链接绑定点击事件</h5>

<p>引入vue.js</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">th:src=</span><span class="s">"@{/static/js/vue.js}"</span><span class="nt">&gt;&lt;/script&gt;</span>
1
</pre></td></tr></tbody></table></code></pre></div></div>

<p>删除超链接</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"deleteA"</span> <span class="err">@</span><span class="na">click=</span><span class="s">"deleteEmployee"</span> <span class="na">th:href=</span><span class="s">"@{'/employee/'+${employee.id}}"</span><span class="nt">&gt;</span>delete<span class="nt">&lt;/a&gt;</span>
1
</pre></td></tr></tbody></table></code></pre></div></div>

<p>通过vue处理点击事件</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
    <span class="kd">var</span> <span class="nx">vue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Vue</span><span class="p">({</span>
        <span class="na">el</span><span class="p">:</span><span class="dl">"</span><span class="s2">#dataTable</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">methods</span><span class="p">:{</span>
            <span class="c1">//event表示当前事件</span>
            <span class="na">deleteEmployee</span><span class="p">:</span><span class="nf">function </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">//通过id获取表单标签</span>
                <span class="kd">var</span> <span class="nx">delete_form</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">delete_form</span><span class="dl">"</span><span class="p">);</span>
                <span class="c1">//将触发事件的超链接的href属性为表单的action属性赋值</span>
                <span class="nx">delete_form</span><span class="p">.</span><span class="nx">action</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
                <span class="c1">//提交表单</span>
                <span class="nx">delete_form</span><span class="p">.</span><span class="nf">submit</span><span class="p">();</span>
                <span class="c1">//阻止超链接的默认跳转行为</span>
                <span class="nx">event</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
123456789101112131415161718
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="c控制器方法">c&gt;控制器方法</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/employee/{id}"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">DELETE</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">deleteEmployee</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">){</span>
    <span class="n">employeeDao</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">"redirect:/employee"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">12345</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="6具体功能跳转到添加数据页面">6、具体功能：跳转到添加数据页面</h3>

<h5 id="a配置view-controller-1">a&gt;配置view-controller</h5>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;mvc:view-controller</span> <span class="na">path=</span><span class="s">"/toAdd"</span> <span class="na">view-name=</span><span class="s">"employee_add"</span><span class="nt">&gt;&lt;/mvc:view-controller&gt;</span>
1
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="b创建employee_addhtml">b&gt;创建employee_add.html</h5>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span> <span class="na">xmlns:th=</span><span class="s">"http://www.thymeleaf.org"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Add Employee<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

<span class="nt">&lt;form</span> <span class="na">th:action=</span><span class="s">"@{/employee}"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
    lastName:<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"lastName"</span><span class="nt">&gt;&lt;br&gt;</span>
    email:<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"email"</span><span class="nt">&gt;&lt;br&gt;</span>
    gender:<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"gender"</span> <span class="na">value=</span><span class="s">"1"</span><span class="nt">&gt;</span>male
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"gender"</span> <span class="na">value=</span><span class="s">"0"</span><span class="nt">&gt;</span>female<span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"add"</span><span class="nt">&gt;&lt;br&gt;</span>
<span class="nt">&lt;/form&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
123456789101112131415161718
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="7具体功能执行保存">7、具体功能：执行保存</h3>

<h5 id="a控制器方法-1">a&gt;控制器方法</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/employee"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">addEmployee</span><span class="o">(</span><span class="nc">Employee</span> <span class="n">employee</span><span class="o">){</span>
    <span class="n">employeeDao</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">employee</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">"redirect:/employee"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">12345</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="8具体功能跳转到更新数据页面">8、具体功能：跳转到更新数据页面</h3>

<h5 id="a修改超链接">a&gt;修改超链接</h5>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{'/employee/'+${employee.id}}"</span><span class="nt">&gt;</span>update<span class="nt">&lt;/a&gt;</span>
1
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="b控制器方法">b&gt;控制器方法</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/employee/{id}"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getEmployeeById</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">){</span>
    <span class="nc">Employee</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">employeeDao</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"employee"</span><span class="o">,</span> <span class="n">employee</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">"employee_update"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">123456</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="c创建employee_updatehtml">c&gt;创建employee_update.html</h5>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span> <span class="na">xmlns:th=</span><span class="s">"http://www.thymeleaf.org"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Update Employee<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

<span class="nt">&lt;form</span> <span class="na">th:action=</span><span class="s">"@{/employee}"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"_method"</span> <span class="na">value=</span><span class="s">"put"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">th:value=</span><span class="s">"${employee.id}"</span><span class="nt">&gt;</span>
    lastName:<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"lastName"</span> <span class="na">th:value=</span><span class="s">"${employee.lastName}"</span><span class="nt">&gt;&lt;br&gt;</span>
    email:<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">th:value=</span><span class="s">"${employee.email}"</span><span class="nt">&gt;&lt;br&gt;</span>
    <span class="c">&lt;!--
        th:field="${employee.gender}"可用于单选框或复选框的回显
        若单选框的value和employee.gender的值一致，则添加checked="checked"属性
    --&gt;</span>
    gender:<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"gender"</span> <span class="na">value=</span><span class="s">"1"</span> <span class="na">th:field=</span><span class="s">"${employee.gender}"</span><span class="nt">&gt;</span>male
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"gender"</span> <span class="na">value=</span><span class="s">"0"</span> <span class="na">th:field=</span><span class="s">"${employee.gender}"</span><span class="nt">&gt;</span>female<span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"update"</span><span class="nt">&gt;&lt;br&gt;</span>
<span class="nt">&lt;/form&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
123456789101112131415161718192021222324
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="9具体功能执行更新">9、具体功能：执行更新</h3>

<h5 id="a控制器方法-2">a&gt;控制器方法</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/employee"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">PUT</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">updateEmployee</span><span class="o">(</span><span class="nc">Employee</span> <span class="n">employee</span><span class="o">){</span>
    <span class="n">employeeDao</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">employee</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">"redirect:/employee"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">12345</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="八httpmessageconverter">八、HttpMessageConverter</h1>

<p>HttpMessageConverter，报文信息转换器，将请求报文转换为Java对象，或将Java对象转换为响应报文</p>

<p>HttpMessageConverter提供了两个注解和两个类型：@RequestBody，@ResponseBody，RequestEntity，</p>

<p>ResponseEntity</p>

<h3 id="1requestbody">1、@RequestBody</h3>

<p>@RequestBody可以获取请求体，需要在控制器方法设置一个形参，使用@RequestBody进行标识，当前请求的请求体就会为当前注解所标识的形参赋值</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;form</span> <span class="na">th:action=</span><span class="s">"@{/testRequestBody}"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
    用户名：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"username"</span><span class="nt">&gt;&lt;br&gt;</span>
    密码：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span><span class="nt">&gt;&lt;br&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
12345
@RequestMapping("/testRequestBody")
public String testRequestBody(@RequestBody String requestBody){
    System.out.println("requestBody:"+requestBody);
    return "success";
}
12345
</pre></td></tr></tbody></table></code></pre></div></div>

<p>输出结果：</p>

<p>requestBody:username=admin&amp;password=123456</p>

<h3 id="2requestentity">2、RequestEntity</h3>

<p>RequestEntity封装请求报文的一种类型，需要在控制器方法的形参中设置该类型的形参，当前请求的请求报文就会赋值给该形参，可以通过getHeaders()获取请求头信息，通过getBody()获取请求体信息</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/testRequestEntity"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">testRequestEntity</span><span class="o">(</span><span class="nc">RequestEntity</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">requestEntity</span><span class="o">){</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"requestHeader:"</span><span class="o">+</span><span class="n">requestEntity</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">());</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"requestBody:"</span><span class="o">+</span><span class="n">requestEntity</span><span class="o">.</span><span class="na">getBody</span><span class="o">());</span>
    <span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">123456</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>输出结果：
requestHeader:[host:“localhost:8080”, connection:“keep-alive”, content-length:“27”, cache-control:“max-age=0”, sec-ch-ua:”” Not A;Brand”;v=“99”, “Chromium”;v=“90”, “Google Chrome”;v=“90””, sec-ch-ua-mobile:”?0”, upgrade-insecure-requests:“1”, origin:“http://localhost:8080”, user-agent:“Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36”]
requestBody:username=admin&amp;password=123</p>

<h3 id="3responsebody">3、@ResponseBody</h3>

<p>@ResponseBody用于标识一个控制器方法，可以将该方法的返回值直接作为响应报文的响应体响应到浏览器</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/testResponseBody"</span><span class="o">)</span>
<span class="nd">@ResponseBody</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">testResponseBody</span><span class="o">(){</span>
    <span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">12345</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>结果：浏览器页面显示success</p>

<h3 id="4springmvc处理json">4、SpringMVC处理json</h3>

<p>@ResponseBody处理json的步骤：</p>

<p>a&gt;导入jackson的依赖</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>jackson-databind<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.12.1<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
12345
</pre></td></tr></tbody></table></code></pre></div></div>

<p>b&gt;在SpringMVC的核心配置文件中开启mvc的注解驱动，此时在HandlerAdaptor中会自动装配一个消息转换器：MappingJackson2HttpMessageConverter，可以将响应到浏览器的Java对象转换为Json格式的字符串</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>&lt;mvc:annotation-driven /&gt;
1
</pre></td></tr></tbody></table></code></pre></div></div>

<p>c&gt;在处理器方法上使用@ResponseBody注解进行标识</p>

<p>d&gt;将Java对象直接作为控制器方法的返回值返回，就会自动转换为Json格式的字符串</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/testResponseUser"</span><span class="o">)</span>
<span class="nd">@ResponseBody</span>
<span class="kd">public</span> <span class="nc">User</span> <span class="nf">testResponseUser</span><span class="o">(){</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">User</span><span class="o">(</span><span class="mi">1001</span><span class="o">,</span><span class="s">"admin"</span><span class="o">,</span><span class="s">"123456"</span><span class="o">,</span><span class="mi">23</span><span class="o">,</span><span class="s">"男"</span><span class="o">);</span>
<span class="o">}</span>
<span class="mi">12345</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>浏览器的页面中展示的结果：</p>

<p>{“id”:1001,“username”:“admin”,“password”:“123456”,“age”:23,“sex”:“男”}</p>

<h3 id="5springmvc处理ajax">5、SpringMVC处理ajax</h3>

<p>a&gt;请求超链接：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"app"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{/testAjax}"</span> <span class="err">@</span><span class="na">click=</span><span class="s">"testAjax"</span><span class="nt">&gt;</span>testAjax<span class="nt">&lt;/a&gt;&lt;br&gt;</span>
<span class="nt">&lt;/div&gt;</span>
123
</pre></td></tr></tbody></table></code></pre></div></div>

<p>b&gt;通过vue和axios处理点击事件：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">th:src=</span><span class="s">"@{/static/js/vue.js}"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">th:src=</span><span class="s">"@{/static/js/axios.min.js}"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
    <span class="kd">var</span> <span class="nx">vue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Vue</span><span class="p">({</span>
        <span class="na">el</span><span class="p">:</span><span class="dl">"</span><span class="s2">#app</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">methods</span><span class="p">:{</span>
            <span class="na">testAjax</span><span class="p">:</span><span class="nf">function </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">axios</span><span class="p">({</span>
                    <span class="na">method</span><span class="p">:</span><span class="dl">"</span><span class="s2">post</span><span class="dl">"</span><span class="p">,</span>
                    <span class="na">url</span><span class="p">:</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span>
                    <span class="na">params</span><span class="p">:{</span>
                        <span class="na">username</span><span class="p">:</span><span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span><span class="p">,</span>
                        <span class="na">password</span><span class="p">:</span><span class="dl">"</span><span class="s2">123456</span><span class="dl">"</span>
                    <span class="p">}</span>
                <span class="p">}).</span><span class="nf">then</span><span class="p">(</span><span class="nf">function </span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nf">alert</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
                <span class="p">});</span>
                <span class="nx">event</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
12345678910111213141516171819202122
</pre></td></tr></tbody></table></code></pre></div></div>

<p>c&gt;控制器方法：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/testAjax"</span><span class="o">)</span>
<span class="nd">@ResponseBody</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">testAjax</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">,</span> <span class="nc">String</span> <span class="n">password</span><span class="o">){</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"username:"</span><span class="o">+</span><span class="n">username</span><span class="o">+</span><span class="s">",password:"</span><span class="o">+</span><span class="n">password</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">"hello,ajax"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">123456</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="6restcontroller注解">6、@RestController注解</h3>

<p>@RestController注解是springMVC提供的一个复合注解，标识在控制器的类上，就相当于为类添加了@Controller注解，并且为其中的每个方法添加了@ResponseBody注解</p>

<h3 id="7responseentity">7、ResponseEntity</h3>

<p>ResponseEntity用于控制器方法的返回值类型，该控制器方法的返回值就是响应到浏览器的响应报文</p>

<h1 id="九文件上传和下载">九、文件上传和下载</h1>

<h3 id="1文件下载">1、文件下载</h3>

<p>使用ResponseEntity实现下载文件的功能</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/testDown"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="nf">testResponseEntity</span><span class="o">(</span><span class="nc">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="c1">//获取ServletContext对象</span>
    <span class="nc">ServletContext</span> <span class="n">servletContext</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">();</span>
    <span class="c1">//获取服务器中文件的真实路径</span>
    <span class="nc">String</span> <span class="n">realPath</span> <span class="o">=</span> <span class="n">servletContext</span><span class="o">.</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">"/static/img/1.jpg"</span><span class="o">);</span>
    <span class="c1">//创建输入流</span>
    <span class="nc">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="n">realPath</span><span class="o">);</span>
    <span class="c1">//创建字节数组</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">is</span><span class="o">.</span><span class="na">available</span><span class="o">()];</span>
    <span class="c1">//将流读到字节数组中</span>
    <span class="n">is</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>
    <span class="c1">//创建HttpHeaders对象设置响应头信息</span>
    <span class="nc">MultiValueMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HttpHeaders</span><span class="o">();</span>
    <span class="c1">//设置要下载方式以及下载文件的名字</span>
    <span class="n">headers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"Content-Disposition"</span><span class="o">,</span> <span class="s">"attachment;filename=1.jpg"</span><span class="o">);</span>
    <span class="c1">//设置响应状态码</span>
    <span class="nc">HttpStatus</span> <span class="n">statusCode</span> <span class="o">=</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">OK</span><span class="o">;</span>
    <span class="c1">//创建ResponseEntity对象</span>
    <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">responseEntity</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="n">bytes</span><span class="o">,</span> <span class="n">headers</span><span class="o">,</span> <span class="n">statusCode</span><span class="o">);</span>
    <span class="c1">//关闭输入流</span>
    <span class="n">is</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">responseEntity</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">123456789101112131415161718192021222324</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2文件上传">2、文件上传</h3>

<p>文件上传要求form表单的请求方式必须为post，并且添加属性enctype=“multipart/form-data”</p>

<p>SpringMVC中将上传的文件封装到MultipartFile对象中，通过此对象可以获取文件相关信息</p>

<p>上传步骤：</p>

<p>a&gt;添加依赖：</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="c">&lt;!-- https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>commons-fileupload<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>commons-fileupload<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.3.1<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
123456
</pre></td></tr></tbody></table></code></pre></div></div>

<p>b&gt;在SpringMVC的配置文件中添加配置：</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c">&lt;!--必须通过文件解析器的解析才能将文件转换为MultipartFile对象--&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"multipartResolver"</span> <span class="na">class=</span><span class="s">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span><span class="nt">&gt;&lt;/bean&gt;</span>
12
</pre></td></tr></tbody></table></code></pre></div></div>

<p>c&gt;控制器方法：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/testUp"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">testUp</span><span class="o">(</span><span class="nc">MultipartFile</span> <span class="n">photo</span><span class="o">,</span> <span class="nc">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="c1">//获取上传的文件的文件名</span>
    <span class="nc">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">photo</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>
    <span class="c1">//处理文件重名问题</span>
    <span class="nc">String</span> <span class="n">hzName</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">fileName</span><span class="o">.</span><span class="na">lastIndexOf</span><span class="o">(</span><span class="s">"."</span><span class="o">));</span>
    <span class="n">fileName</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">()</span> <span class="o">+</span> <span class="n">hzName</span><span class="o">;</span>
    <span class="c1">//获取服务器中photo目录的路径</span>
    <span class="nc">ServletContext</span> <span class="n">servletContext</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">();</span>
    <span class="nc">String</span> <span class="n">photoPath</span> <span class="o">=</span> <span class="n">servletContext</span><span class="o">.</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">"photo"</span><span class="o">);</span>
    <span class="nc">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">photoPath</span><span class="o">);</span>
    <span class="k">if</span><span class="o">(!</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">()){</span>
        <span class="n">file</span><span class="o">.</span><span class="na">mkdir</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="nc">String</span> <span class="n">finalPath</span> <span class="o">=</span> <span class="n">photoPath</span> <span class="o">+</span> <span class="nc">File</span><span class="o">.</span><span class="na">separator</span> <span class="o">+</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="c1">//实现上传功能</span>
    <span class="n">photo</span><span class="o">.</span><span class="na">transferTo</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">finalPath</span><span class="o">));</span>
    <span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">12345678910111213141516171819</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="十拦截器">十、拦截器</h1>

<h3 id="1拦截器的配置">1、拦截器的配置</h3>

<p>SpringMVC中的拦截器用于拦截控制器方法的执行</p>

<p>SpringMVC中的拦截器需要实现HandlerInterceptor</p>

<p>SpringMVC的拦截器必须在SpringMVC的配置文件中进行配置：</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"com.atguigu.interceptor.FirstInterceptor"</span><span class="nt">&gt;&lt;/bean&gt;</span>
<span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"firstInterceptor"</span><span class="nt">&gt;&lt;/ref&gt;</span>
<span class="c">&lt;!-- 以上两种配置方式都是对DispatcherServlet所处理的所有的请求进行拦截 --&gt;</span>
<span class="nt">&lt;mvc:interceptor&gt;</span>
    <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">"/**"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">"/testRequestEntity"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"firstInterceptor"</span><span class="nt">&gt;&lt;/ref&gt;</span>
<span class="nt">&lt;/mvc:interceptor&gt;</span>
<span class="c">&lt;!-- 
	以上配置方式可以通过ref或bean标签设置拦截器，通过mvc:mapping设置需要拦截的请求，通过mvc:exclude-mapping设置需要排除的请求，即不需要拦截的请求
--&gt;</span>
1234567891011
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2拦截器的三个抽象方法">2、拦截器的三个抽象方法</h3>

<p>SpringMVC中的拦截器有三个抽象方法：</p>

<p>preHandle：控制器方法执行之前执行preHandle()，其boolean类型的返回值表示是否拦截或放行，返回true为放行，即调用控制器方法；返回false表示拦截，即不调用控制器方法</p>

<p>postHandle：控制器方法执行之后执行postHandle()</p>

<p>afterComplation：处理完视图和模型数据，渲染视图完毕之后执行afterComplation()</p>

<h3 id="3多个拦截器的执行顺序">3、多个拦截器的执行顺序</h3>

<p>a&gt;若每个拦截器的preHandle()都返回true</p>

<p>此时多个拦截器的执行顺序和拦截器在SpringMVC的配置文件的配置顺序有关：</p>

<p>preHandle()会按照配置的顺序执行，而postHandle()和afterComplation()会按照配置的反序执行</p>

<p>b&gt;若某个拦截器的preHandle()返回了false</p>

<p>preHandle()返回false和它之前的拦截器的preHandle()都会执行，postHandle()都不执行，返回false的拦截器之前的拦截器的afterComplation()会执行</p>

<h1 id="十一异常处理器">十一、异常处理器</h1>

<h3 id="1基于配置的异常处理">1、基于配置的异常处理</h3>

<p>SpringMVC提供了一个处理控制器方法执行过程中所出现的异常的接口：HandlerExceptionResolver</p>

<p>HandlerExceptionResolver接口的实现类有：DefaultHandlerExceptionResolver和SimpleMappingExceptionResolver</p>

<p>SpringMVC提供了自定义的异常处理器SimpleMappingExceptionResolver，使用方式：</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.springframework.web.servlet.handler.SimpleMappingExceptionResolver"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"exceptionMappings"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;props&gt;</span>
        	<span class="c">&lt;!--
        		properties的键表示处理器方法执行过程中出现的异常
        		properties的值表示若出现指定异常时，设置一个新的视图名称，跳转到指定页面
        	--&gt;</span>
            <span class="nt">&lt;prop</span> <span class="na">key=</span><span class="s">"java.lang.ArithmeticException"</span><span class="nt">&gt;</span>error<span class="nt">&lt;/prop&gt;</span>
        <span class="nt">&lt;/props&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="c">&lt;!--
    	exceptionAttribute属性设置一个属性名，将出现的异常信息在请求域中进行共享
    --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"exceptionAttribute"</span> <span class="na">value=</span><span class="s">"ex"</span><span class="nt">&gt;&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
123456789101112131415
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2基于注解的异常处理">2、基于注解的异常处理</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="c1">//@ControllerAdvice将当前类标识为异常处理的组件</span>
<span class="nd">@ControllerAdvice</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExceptionController</span> <span class="o">{</span>

    <span class="c1">//@ExceptionHandler用于设置所标识方法处理的异常</span>
    <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="nc">ArithmeticException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="c1">//ex表示当前请求处理中出现的异常对象</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">handleArithmeticException</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">ex</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">){</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"ex"</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"error"</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
<span class="mi">12345678910111213</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="十二注解配置springmvc">十二、注解配置SpringMVC</h1>

<p>使用配置类和注解代替web.xml和SpringMVC配置文件的功能</p>

<h3 id="1创建初始化类代替webxml">1、创建初始化类，代替web.xml</h3>

<p>在Servlet3.0环境中，容器会在类路径中查找实现javax.servlet.ServletContainerInitializer接口的类，如果找到的话就用它来配置Servlet容器。
Spring提供了这个接口的实现，名为SpringServletContainerInitializer，这个类反过来又会查找实现WebApplicationInitializer的类并将配置的任务交给它们来完成。Spring3.2引入了一个便利的WebApplicationInitializer基础实现，名为AbstractAnnotationConfigDispatcherServletInitializer，当我们的类扩展了AbstractAnnotationConfigDispatcherServletInitializer并将其部署到Servlet3.0容器的时候，容器会自动发现它，并用它来配置Servlet上下文。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebInit</span> <span class="kd">extends</span> <span class="nc">AbstractAnnotationConfigDispatcherServletInitializer</span> <span class="o">{</span>

    <span class="cm">/**
     * 指定spring的配置类
     * @return
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="nc">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">getRootConfigClasses</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{</span><span class="nc">SpringConfig</span><span class="o">.</span><span class="na">class</span><span class="o">};</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 指定SpringMVC的配置类
     * @return
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="nc">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">getServletConfigClasses</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{</span><span class="nc">WebConfig</span><span class="o">.</span><span class="na">class</span><span class="o">};</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 指定DispatcherServlet的映射规则，即url-pattern
     * @return
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="nc">String</span><span class="o">[]</span> <span class="nf">getServletMappings</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="s">"/"</span><span class="o">};</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 添加过滤器
     * @return
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="nc">Filter</span><span class="o">[]</span> <span class="nf">getServletFilters</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">CharacterEncodingFilter</span> <span class="n">encodingFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CharacterEncodingFilter</span><span class="o">();</span>
        <span class="n">encodingFilter</span><span class="o">.</span><span class="na">setEncoding</span><span class="o">(</span><span class="s">"UTF-8"</span><span class="o">);</span>
        <span class="n">encodingFilter</span><span class="o">.</span><span class="na">setForceRequestEncoding</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="nc">HiddenHttpMethodFilter</span> <span class="n">hiddenHttpMethodFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HiddenHttpMethodFilter</span><span class="o">();</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">Filter</span><span class="o">[]{</span><span class="n">encodingFilter</span><span class="o">,</span> <span class="n">hiddenHttpMethodFilter</span><span class="o">};</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="mi">123456789101112131415161718192021222324252627282930313233343536373839404142</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2创建springconfig配置类代替spring的配置文件">2、创建SpringConfig配置类，代替spring的配置文件</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="o">{</span>
	<span class="c1">//ssm整合之后，spring的配置信息写在此类中</span>
<span class="o">}</span>
<span class="mi">1234</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3创建webconfig配置类代替springmvc的配置文件">3、创建WebConfig配置类，代替SpringMVC的配置文件</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
</pre></td><td class="rouge-code"><pre><span class="nd">@Configuration</span>
<span class="c1">//扫描组件</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="s">"com.atguigu.mvc.controller"</span><span class="o">)</span>
<span class="c1">//开启MVC注解驱动</span>
<span class="nd">@EnableWebMvc</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebConfig</span> <span class="kd">implements</span> <span class="nc">WebMvcConfigurer</span> <span class="o">{</span>

    <span class="c1">//使用默认的servlet处理静态资源</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureDefaultServletHandling</span><span class="o">(</span><span class="nc">DefaultServletHandlerConfigurer</span> <span class="n">configurer</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">configurer</span><span class="o">.</span><span class="na">enable</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">//配置文件上传解析器</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">CommonsMultipartResolver</span> <span class="nf">multipartResolver</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">CommonsMultipartResolver</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">//配置拦截器</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addInterceptors</span><span class="o">(</span><span class="nc">InterceptorRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">FirstInterceptor</span> <span class="n">firstInterceptor</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FirstInterceptor</span><span class="o">();</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="n">firstInterceptor</span><span class="o">).</span><span class="na">addPathPatterns</span><span class="o">(</span><span class="s">"/**"</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="c1">//配置视图控制</span>
    
    <span class="cm">/*@Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController("/").setViewName("index");
    }*/</span>
    
    <span class="c1">//配置异常映射</span>
    <span class="cm">/*@Override
    public void configureHandlerExceptionResolvers(List&lt;HandlerExceptionResolver&gt; resolvers) {
        SimpleMappingExceptionResolver exceptionResolver = new SimpleMappingExceptionResolver();
        Properties prop = new Properties();
        prop.setProperty("java.lang.ArithmeticException", "error");
        //设置异常映射
        exceptionResolver.setExceptionMappings(prop);
        //设置共享异常信息的键
        exceptionResolver.setExceptionAttribute("ex");
        resolvers.add(exceptionResolver);
    }*/</span>

    <span class="c1">//配置生成模板解析器</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">ITemplateResolver</span> <span class="nf">templateResolver</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">WebApplicationContext</span> <span class="n">webApplicationContext</span> <span class="o">=</span> <span class="nc">ContextLoader</span><span class="o">.</span><span class="na">getCurrentWebApplicationContext</span><span class="o">();</span>
        <span class="c1">// ServletContextTemplateResolver需要一个ServletContext作为构造参数，可通过WebApplicationContext 的方法获得</span>
        <span class="nc">ServletContextTemplateResolver</span> <span class="n">templateResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServletContextTemplateResolver</span><span class="o">(</span>
                <span class="n">webApplicationContext</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">());</span>
        <span class="n">templateResolver</span><span class="o">.</span><span class="na">setPrefix</span><span class="o">(</span><span class="s">"/WEB-INF/templates/"</span><span class="o">);</span>
        <span class="n">templateResolver</span><span class="o">.</span><span class="na">setSuffix</span><span class="o">(</span><span class="s">".html"</span><span class="o">);</span>
        <span class="n">templateResolver</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span><span class="s">"UTF-8"</span><span class="o">);</span>
        <span class="n">templateResolver</span><span class="o">.</span><span class="na">setTemplateMode</span><span class="o">(</span><span class="nc">TemplateMode</span><span class="o">.</span><span class="na">HTML</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">templateResolver</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">//生成模板引擎并为模板引擎注入模板解析器</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">SpringTemplateEngine</span> <span class="nf">templateEngine</span><span class="o">(</span><span class="nc">ITemplateResolver</span> <span class="n">templateResolver</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringTemplateEngine</span> <span class="n">templateEngine</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SpringTemplateEngine</span><span class="o">();</span>
        <span class="n">templateEngine</span><span class="o">.</span><span class="na">setTemplateResolver</span><span class="o">(</span><span class="n">templateResolver</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">templateEngine</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">//生成视图解析器并未解析器注入模板引擎</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">ViewResolver</span> <span class="nf">viewResolver</span><span class="o">(</span><span class="nc">SpringTemplateEngine</span> <span class="n">templateEngine</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">ThymeleafViewResolver</span> <span class="n">viewResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ThymeleafViewResolver</span><span class="o">();</span>
        <span class="n">viewResolver</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span><span class="s">"UTF-8"</span><span class="o">);</span>
        <span class="n">viewResolver</span><span class="o">.</span><span class="na">setTemplateEngine</span><span class="o">(</span><span class="n">templateEngine</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">viewResolver</span><span class="o">;</span>
    <span class="o">}</span>


<span class="o">}</span>
<span class="mi">12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="4测试功能">4、测试功能</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">index</span><span class="o">(){</span>
    <span class="k">return</span> <span class="s">"index"</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">1234</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="十三springmvc执行流程">十三、SpringMVC执行流程</h1>

<h3 id="1springmvc常用组件">1、SpringMVC常用组件</h3>

<ul>
  <li>DispatcherServlet：<strong>前端控制器</strong>，不需要工程师开发，由框架提供</li>
</ul>

<p>作用：统一处理请求和响应，整个流程控制的中心，由它调用其它组件处理用户的请求</p>

<ul>
  <li>HandlerMapping：<strong>处理器映射器</strong>，不需要工程师开发，由框架提供</li>
</ul>

<p>作用：根据请求的url、method等信息查找Handler，即控制器方法</p>

<ul>
  <li>Handler：<strong>处理器</strong>，需要工程师开发</li>
</ul>

<p>作用：在DispatcherServlet的控制下Handler对具体的用户请求进行处理</p>

<ul>
  <li>HandlerAdapter：<strong>处理器适配器</strong>，不需要工程师开发，由框架提供</li>
</ul>

<p>作用：通过HandlerAdapter对处理器（控制器方法）进行执行</p>

<ul>
  <li>ViewResolver：<strong>视图解析器</strong>，不需要工程师开发，由框架提供</li>
</ul>

<p>作用：进行视图解析，得到相应的视图，例如：ThymeleafView、InternalResourceView、RedirectView</p>

<ul>
  <li>View：<strong>视图</strong></li>
</ul>

<p>作用：将模型数据通过页面展示给用户</p>

<h3 id="2dispatcherservlet初始化过程">2、DispatcherServlet初始化过程</h3>

<p>DispatcherServlet 本质上是一个 Servlet，所以天然的遵循 Servlet 的生命周期。所以宏观上是 Servlet 生命周期来进行调度。</p>

<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-kphToPhs-1627992919015)(img/img005.png)]</p>

<h5 id="a初始化webapplicationcontext">a&gt;初始化WebApplicationContext</h5>

<p>所在类：org.springframework.web.servlet.FrameworkServlet</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre></td><td class="rouge-code"><pre><span class="kd">protected</span> <span class="nc">WebApplicationContext</span> <span class="nf">initWebApplicationContext</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">WebApplicationContext</span> <span class="n">rootContext</span> <span class="o">=</span>
        <span class="nc">WebApplicationContextUtils</span><span class="o">.</span><span class="na">getWebApplicationContext</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
    <span class="nc">WebApplicationContext</span> <span class="n">wac</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">webApplicationContext</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// A context instance was injected at construction time -&gt; use it</span>
        <span class="n">wac</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">webApplicationContext</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">wac</span> <span class="k">instanceof</span> <span class="nc">ConfigurableWebApplicationContext</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">ConfigurableWebApplicationContext</span> <span class="n">cwac</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ConfigurableWebApplicationContext</span><span class="o">)</span> <span class="n">wac</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">cwac</span><span class="o">.</span><span class="na">isActive</span><span class="o">())</span> <span class="o">{</span>
                <span class="c1">// The context has not yet been refreshed -&gt; provide services such as</span>
                <span class="c1">// setting the parent context, setting the application context id, etc</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">cwac</span><span class="o">.</span><span class="na">getParent</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// The context instance was injected without an explicit parent -&gt; set</span>
                    <span class="c1">// the root application context (if any; may be null) as the parent</span>
                    <span class="n">cwac</span><span class="o">.</span><span class="na">setParent</span><span class="o">(</span><span class="n">rootContext</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="n">configureAndRefreshWebApplicationContext</span><span class="o">(</span><span class="n">cwac</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">wac</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// No context instance was injected at construction time -&gt; see if one</span>
        <span class="c1">// has been registered in the servlet context. If one exists, it is assumed</span>
        <span class="c1">// that the parent context (if any) has already been set and that the</span>
        <span class="c1">// user has performed any initialization such as setting the context id</span>
        <span class="n">wac</span> <span class="o">=</span> <span class="n">findWebApplicationContext</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">wac</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// No context instance is defined for this servlet -&gt; create a local one</span>
        <span class="c1">// 创建WebApplicationContext</span>
        <span class="n">wac</span> <span class="o">=</span> <span class="n">createWebApplicationContext</span><span class="o">(</span><span class="n">rootContext</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">refreshEventReceived</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Either the context is not a ConfigurableApplicationContext with refresh</span>
        <span class="c1">// support or the context injected at construction time had already been</span>
        <span class="c1">// refreshed -&gt; trigger initial onRefresh manually here.</span>
        <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">onRefreshMonitor</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// 刷新WebApplicationContext</span>
            <span class="n">onRefresh</span><span class="o">(</span><span class="n">wac</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">publishContext</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Publish the context as a servlet context attribute.</span>
        <span class="c1">// 将IOC容器在应用域共享</span>
        <span class="nc">String</span> <span class="n">attrName</span> <span class="o">=</span> <span class="n">getServletContextAttributeName</span><span class="o">();</span>
        <span class="n">getServletContext</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="n">attrName</span><span class="o">,</span> <span class="n">wac</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="n">wac</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="b创建webapplicationcontext">b&gt;创建WebApplicationContext</h5>

<p>所在类：org.springframework.web.servlet.FrameworkServlet</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="kd">protected</span> <span class="nc">WebApplicationContext</span> <span class="nf">createWebApplicationContext</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="nc">ApplicationContext</span> <span class="n">parent</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">contextClass</span> <span class="o">=</span> <span class="n">getContextClass</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(!</span><span class="nc">ConfigurableWebApplicationContext</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">contextClass</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">ApplicationContextException</span><span class="o">(</span>
            <span class="s">"Fatal initialization error in servlet with name '"</span> <span class="o">+</span> <span class="n">getServletName</span><span class="o">()</span> <span class="o">+</span>
            <span class="s">"': custom WebApplicationContext class ["</span> <span class="o">+</span> <span class="n">contextClass</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span>
            <span class="s">"] is not of type ConfigurableWebApplicationContext"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// 通过反射创建 IOC 容器对象</span>
    <span class="nc">ConfigurableWebApplicationContext</span> <span class="n">wac</span> <span class="o">=</span>
        <span class="o">(</span><span class="nc">ConfigurableWebApplicationContext</span><span class="o">)</span> <span class="nc">BeanUtils</span><span class="o">.</span><span class="na">instantiateClass</span><span class="o">(</span><span class="n">contextClass</span><span class="o">);</span>

    <span class="n">wac</span><span class="o">.</span><span class="na">setEnvironment</span><span class="o">(</span><span class="n">getEnvironment</span><span class="o">());</span>
    <span class="c1">// 设置父容器</span>
    <span class="n">wac</span><span class="o">.</span><span class="na">setParent</span><span class="o">(</span><span class="n">parent</span><span class="o">);</span>
    <span class="nc">String</span> <span class="n">configLocation</span> <span class="o">=</span> <span class="n">getContextConfigLocation</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">configLocation</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">wac</span><span class="o">.</span><span class="na">setConfigLocation</span><span class="o">(</span><span class="n">configLocation</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">configureAndRefreshWebApplicationContext</span><span class="o">(</span><span class="n">wac</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">wac</span><span class="o">;</span>
<span class="o">}</span>
<span class="mi">1234567891011121314151617181920212223</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="cdispatcherservlet初始化策略">c&gt;DispatcherServlet初始化策略</h5>

<p>FrameworkServlet创建WebApplicationContext后，刷新容器，调用onRefresh(wac)，此方法在DispatcherServlet中进行了重写，调用了initStrategies(context)方法，初始化策略，即初始化DispatcherServlet的各个组件</p>

<p>所在类：org.springframework.web.servlet.DispatcherServlet</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">initStrategies</span><span class="o">(</span><span class="nc">ApplicationContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">initMultipartResolver</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
   <span class="n">initLocaleResolver</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
   <span class="n">initThemeResolver</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
   <span class="n">initHandlerMappings</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
   <span class="n">initHandlerAdapters</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
   <span class="n">initHandlerExceptionResolvers</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
   <span class="n">initRequestToViewNameTranslator</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
   <span class="n">initViewResolvers</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
   <span class="n">initFlashMapManager</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
<span class="o">}</span>
<span class="mi">1234567891011</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3dispatcherservlet调用组件处理请求">3、DispatcherServlet调用组件处理请求</h3>

<h5 id="aprocessrequest">a&gt;processRequest()</h5>

<p>FrameworkServlet重写HttpServlet中的service()和doXxx()，这些方法中调用了processRequest(request, response)</p>

<p>所在类：org.springframework.web.servlet.FrameworkServlet</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td><td class="rouge-code"><pre><span class="kd">protected</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">processRequest</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span>
    <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>

    <span class="kt">long</span> <span class="n">startTime</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
    <span class="nc">Throwable</span> <span class="n">failureCause</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="nc">LocaleContext</span> <span class="n">previousLocaleContext</span> <span class="o">=</span> <span class="nc">LocaleContextHolder</span><span class="o">.</span><span class="na">getLocaleContext</span><span class="o">();</span>
    <span class="nc">LocaleContext</span> <span class="n">localeContext</span> <span class="o">=</span> <span class="n">buildLocaleContext</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>

    <span class="nc">RequestAttributes</span> <span class="n">previousAttributes</span> <span class="o">=</span> <span class="nc">RequestContextHolder</span><span class="o">.</span><span class="na">getRequestAttributes</span><span class="o">();</span>
    <span class="nc">ServletRequestAttributes</span> <span class="n">requestAttributes</span> <span class="o">=</span> <span class="n">buildRequestAttributes</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">previousAttributes</span><span class="o">);</span>

    <span class="nc">WebAsyncManager</span> <span class="n">asyncManager</span> <span class="o">=</span> <span class="nc">WebAsyncUtils</span><span class="o">.</span><span class="na">getAsyncManager</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
    <span class="n">asyncManager</span><span class="o">.</span><span class="na">registerCallableInterceptor</span><span class="o">(</span><span class="nc">FrameworkServlet</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">RequestBindingInterceptor</span><span class="o">());</span>

    <span class="n">initContextHolders</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">localeContext</span><span class="o">,</span> <span class="n">requestAttributes</span><span class="o">);</span>

    <span class="k">try</span> <span class="o">{</span>
		<span class="c1">// 执行服务，doService()是一个抽象方法，在DispatcherServlet中进行了重写</span>
        <span class="n">doService</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">(</span><span class="nc">ServletException</span> <span class="o">|</span> <span class="nc">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">failureCause</span> <span class="o">=</span> <span class="n">ex</span><span class="o">;</span>
        <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">failureCause</span> <span class="o">=</span> <span class="n">ex</span><span class="o">;</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">NestedServletException</span><span class="o">(</span><span class="s">"Request processing failed"</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">finally</span> <span class="o">{</span>
        <span class="n">resetContextHolders</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">previousLocaleContext</span><span class="o">,</span> <span class="n">previousAttributes</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">requestAttributes</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">requestAttributes</span><span class="o">.</span><span class="na">requestCompleted</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">logResult</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">failureCause</span><span class="o">,</span> <span class="n">asyncManager</span><span class="o">);</span>
        <span class="n">publishRequestHandledEvent</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">startTime</span><span class="o">,</span> <span class="n">failureCause</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="mi">123456789101112131415161718192021222324252627282930313233343536373839</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="bdoservice">b&gt;doService()</h5>

<p>所在类：org.springframework.web.servlet.DispatcherServlet</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre></td><td class="rouge-code"><pre><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doService</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="n">logRequest</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>

    <span class="c1">// Keep a snapshot of the request attributes in case of an include,</span>
    <span class="c1">// to be able to restore the original attributes after the include.</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">attributesSnapshot</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="nc">WebUtils</span><span class="o">.</span><span class="na">isIncludeRequest</span><span class="o">(</span><span class="n">request</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">attributesSnapshot</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="nc">Enumeration</span><span class="o">&lt;?&gt;</span> <span class="n">attrNames</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getAttributeNames</span><span class="o">();</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">attrNames</span><span class="o">.</span><span class="na">hasMoreElements</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">String</span> <span class="n">attrName</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">attrNames</span><span class="o">.</span><span class="na">nextElement</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">cleanupAfterInclude</span> <span class="o">||</span> <span class="n">attrName</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="no">DEFAULT_STRATEGIES_PREFIX</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">attributesSnapshot</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">attrName</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">attrName</span><span class="o">));</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">// Make framework objects available to handlers and view objects.</span>
    <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="no">WEB_APPLICATION_CONTEXT_ATTRIBUTE</span><span class="o">,</span> <span class="n">getWebApplicationContext</span><span class="o">());</span>
    <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="no">LOCALE_RESOLVER_ATTRIBUTE</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">localeResolver</span><span class="o">);</span>
    <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="no">THEME_RESOLVER_ATTRIBUTE</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">themeResolver</span><span class="o">);</span>
    <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="no">THEME_SOURCE_ATTRIBUTE</span><span class="o">,</span> <span class="n">getThemeSource</span><span class="o">());</span>

    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">flashMapManager</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">FlashMap</span> <span class="n">inputFlashMap</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">flashMapManager</span><span class="o">.</span><span class="na">retrieveAndUpdate</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">inputFlashMap</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="no">INPUT_FLASH_MAP_ATTRIBUTE</span><span class="o">,</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">unmodifiableMap</span><span class="o">(</span><span class="n">inputFlashMap</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="no">OUTPUT_FLASH_MAP_ATTRIBUTE</span><span class="o">,</span> <span class="k">new</span> <span class="nc">FlashMap</span><span class="o">());</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="no">FLASH_MAP_MANAGER_ATTRIBUTE</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">flashMapManager</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nc">RequestPath</span> <span class="n">requestPath</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">parseRequestPath</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nc">ServletRequestPathUtils</span><span class="o">.</span><span class="na">hasParsedRequestPath</span><span class="o">(</span><span class="n">request</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">requestPath</span> <span class="o">=</span> <span class="nc">ServletRequestPathUtils</span><span class="o">.</span><span class="na">parseAndCache</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="c1">// 处理请求和响应</span>
        <span class="n">doDispatch</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">finally</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="nc">WebAsyncUtils</span><span class="o">.</span><span class="na">getAsyncManager</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">isConcurrentHandlingStarted</span><span class="o">())</span> <span class="o">{</span>
            <span class="c1">// Restore the original attribute snapshot, in case of an include.</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">attributesSnapshot</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">restoreAttributesAfterInclude</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">attributesSnapshot</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">requestPath</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">ServletRequestPathUtils</span><span class="o">.</span><span class="na">clearParsedRequestPath</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="mi">123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="cdodispatch">c&gt;doDispatch()</h5>

<p>所在类：org.springframework.web.servlet.DispatcherServlet</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
</pre></td><td class="rouge-code"><pre><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doDispatch</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">HttpServletRequest</span> <span class="n">processedRequest</span> <span class="o">=</span> <span class="n">request</span><span class="o">;</span>
    <span class="nc">HandlerExecutionChain</span> <span class="n">mappedHandler</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kt">boolean</span> <span class="n">multipartRequestParsed</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

    <span class="nc">WebAsyncManager</span> <span class="n">asyncManager</span> <span class="o">=</span> <span class="nc">WebAsyncUtils</span><span class="o">.</span><span class="na">getAsyncManager</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="nc">ModelAndView</span> <span class="n">mv</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="nc">Exception</span> <span class="n">dispatchException</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">processedRequest</span> <span class="o">=</span> <span class="n">checkMultipart</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
            <span class="n">multipartRequestParsed</span> <span class="o">=</span> <span class="o">(</span><span class="n">processedRequest</span> <span class="o">!=</span> <span class="n">request</span><span class="o">);</span>

            <span class="c1">// Determine handler for the current request.</span>
            <span class="cm">/*
            	mappedHandler：调用链
                包含handler、interceptorList、interceptorIndex
            	handler：浏览器发送的请求所匹配的控制器方法
            	interceptorList：处理控制器方法的所有拦截器集合
            	interceptorIndex：拦截器索引，控制拦截器afterCompletion()的执行
            */</span>
            <span class="n">mappedHandler</span> <span class="o">=</span> <span class="n">getHandler</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">mappedHandler</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">noHandlerFound</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
                <span class="k">return</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="c1">// Determine handler adapter for the current request.</span>
           	<span class="c1">// 通过控制器方法创建相应的处理器适配器，调用所对应的控制器方法</span>
            <span class="nc">HandlerAdapter</span> <span class="n">ha</span> <span class="o">=</span> <span class="n">getHandlerAdapter</span><span class="o">(</span><span class="n">mappedHandler</span><span class="o">.</span><span class="na">getHandler</span><span class="o">());</span>

            <span class="c1">// Process last-modified header, if supported by the handler.</span>
            <span class="nc">String</span> <span class="n">method</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">();</span>
            <span class="kt">boolean</span> <span class="n">isGet</span> <span class="o">=</span> <span class="s">"GET"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">method</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">isGet</span> <span class="o">||</span> <span class="s">"HEAD"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">method</span><span class="o">))</span> <span class="o">{</span>
                <span class="kt">long</span> <span class="n">lastModified</span> <span class="o">=</span> <span class="n">ha</span><span class="o">.</span><span class="na">getLastModified</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">.</span><span class="na">getHandler</span><span class="o">());</span>
                <span class="k">if</span> <span class="o">(</span><span class="k">new</span> <span class="nc">ServletWebRequest</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">).</span><span class="na">checkNotModified</span><span class="o">(</span><span class="n">lastModified</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">isGet</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">return</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
			
            <span class="c1">// 调用拦截器的preHandle()</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">mappedHandler</span><span class="o">.</span><span class="na">applyPreHandle</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">return</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="c1">// Actually invoke the handler.</span>
            <span class="c1">// 由处理器适配器调用具体的控制器方法，最终获得ModelAndView对象</span>
            <span class="n">mv</span> <span class="o">=</span> <span class="n">ha</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">.</span><span class="na">getHandler</span><span class="o">());</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">asyncManager</span><span class="o">.</span><span class="na">isConcurrentHandlingStarted</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">return</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="n">applyDefaultViewName</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">mv</span><span class="o">);</span>
            <span class="c1">// 调用拦截器的postHandle()</span>
            <span class="n">mappedHandler</span><span class="o">.</span><span class="na">applyPostHandle</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mv</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">dispatchException</span> <span class="o">=</span> <span class="n">ex</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">err</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// As of 4.3, we're processing Errors thrown from handler methods as well,</span>
            <span class="c1">// making them available for @ExceptionHandler methods and other scenarios.</span>
            <span class="n">dispatchException</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NestedServletException</span><span class="o">(</span><span class="s">"Handler dispatch failed"</span><span class="o">,</span> <span class="n">err</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="c1">// 后续处理：处理模型数据和渲染视图</span>
        <span class="n">processDispatchResult</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">,</span> <span class="n">mv</span><span class="o">,</span> <span class="n">dispatchException</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">triggerAfterCompletion</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">err</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">triggerAfterCompletion</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">,</span>
                               <span class="k">new</span> <span class="nf">NestedServletException</span><span class="o">(</span><span class="s">"Handler processing failed"</span><span class="o">,</span> <span class="n">err</span><span class="o">));</span>
    <span class="o">}</span>
    <span class="k">finally</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">asyncManager</span><span class="o">.</span><span class="na">isConcurrentHandlingStarted</span><span class="o">())</span> <span class="o">{</span>
            <span class="c1">// Instead of postHandle and afterCompletion</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">mappedHandler</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">mappedHandler</span><span class="o">.</span><span class="na">applyAfterConcurrentHandlingStarted</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">else</span> <span class="o">{</span>
            <span class="c1">// Clean up any resources used by a multipart request.</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">multipartRequestParsed</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">cleanupMultipart</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="mi">123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="dprocessdispatchresult">d&gt;processDispatchResult()</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre></td><td class="rouge-code"><pre><span class="kd">private</span> <span class="kt">void</span> <span class="nf">processDispatchResult</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
                                   <span class="nd">@Nullable</span> <span class="nc">HandlerExecutionChain</span> <span class="n">mappedHandler</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">ModelAndView</span> <span class="n">mv</span><span class="o">,</span>
                                   <span class="nd">@Nullable</span> <span class="nc">Exception</span> <span class="n">exception</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

    <span class="kt">boolean</span> <span class="n">errorView</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">exception</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">exception</span> <span class="k">instanceof</span> <span class="nc">ModelAndViewDefiningException</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"ModelAndViewDefiningException encountered"</span><span class="o">,</span> <span class="n">exception</span><span class="o">);</span>
            <span class="n">mv</span> <span class="o">=</span> <span class="o">((</span><span class="nc">ModelAndViewDefiningException</span><span class="o">)</span> <span class="n">exception</span><span class="o">).</span><span class="na">getModelAndView</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">else</span> <span class="o">{</span>
            <span class="nc">Object</span> <span class="n">handler</span> <span class="o">=</span> <span class="o">(</span><span class="n">mappedHandler</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">mappedHandler</span><span class="o">.</span><span class="na">getHandler</span><span class="o">()</span> <span class="o">:</span> <span class="kc">null</span><span class="o">);</span>
            <span class="n">mv</span> <span class="o">=</span> <span class="n">processHandlerException</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">,</span> <span class="n">exception</span><span class="o">);</span>
            <span class="n">errorView</span> <span class="o">=</span> <span class="o">(</span><span class="n">mv</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">// Did the handler return a view to render?</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">mv</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">mv</span><span class="o">.</span><span class="na">wasCleared</span><span class="o">())</span> <span class="o">{</span>
        <span class="c1">// 处理模型数据和渲染视图</span>
        <span class="n">render</span><span class="o">(</span><span class="n">mv</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">errorView</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">WebUtils</span><span class="o">.</span><span class="na">clearErrorRequestAttributes</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">else</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isTraceEnabled</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">"No view rendering, null ModelAndView returned."</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="nc">WebAsyncUtils</span><span class="o">.</span><span class="na">getAsyncManager</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">isConcurrentHandlingStarted</span><span class="o">())</span> <span class="o">{</span>
        <span class="c1">// Concurrent handling started during a forward</span>
        <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">mappedHandler</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Exception (if any) is already handled..</span>
        <span class="c1">// 调用拦截器的afterCompletion()</span>
        <span class="n">mappedHandler</span><span class="o">.</span><span class="na">triggerAfterCompletion</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="mi">12345678910111213141516171819202122232425262728293031323334353637383940414243</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="4springmvc的执行流程">4、SpringMVC的执行流程</h3>

<ol>
  <li>用户向服务器发送请求，请求被SpringMVC 前端控制器 DispatcherServlet捕获。</li>
  <li>DispatcherServlet对请求URL进行解析，得到请求资源标识符（URI），判断请求URI对应的映射：</li>
</ol>

<p>a) 不存在</p>

<p>i. 再判断是否配置了mvc:default-servlet-handler</p>

<p>ii. 如果没配置，则控制台报映射查找不到，客户端展示404错误</p>

<p><img src="https://procon-note.oss-cn-guangzhou.aliyuncs.com/typora/8df6a30e77184eb0bc1547dae5838f65.png" alt="在这里插入图片描述" /></p>

<p>iii. 如果有配置，则访问目标资源（一般为静态资源，如：JS,CSS,HTML），找不到客户端也会展示404错误</p>

<p><img src="https://procon-note.oss-cn-guangzhou.aliyuncs.com/typora/67d25736b3b74dfe9145acedb0e8656d.png" alt="在这里插入图片描述" /></p>

<p>b) 存在则执行下面的流程</p>

<ol>
  <li>根据该URI，调用HandlerMapping获得该Handler配置的所有相关的对象（包括Handler对象以及Handler对象对应的拦截器），最后以HandlerExecutionChain执行链对象的形式返回。</li>
  <li>DispatcherServlet 根据获得的Handler，选择一个合适的HandlerAdapter。</li>
  <li>如果成功获得HandlerAdapter，此时将开始执行拦截器的preHandler(…)方法【正向】</li>
  <li>提取Request中的模型数据，填充Handler入参，开始执行Handler（Controller)方法，处理请求。在填充Handler的入参过程中，根据你的配置，Spring将帮你做一些额外的工作：</li>
</ol>

<p>a) HttpMessageConveter： 将请求消息（如Json、xml等数据）转换成一个对象，将对象转换为指定的响应信息</p>

<p>b) 数据转换：对请求消息进行数据转换。如String转换成Integer、Double等</p>

<p>c) 数据格式化：对请求消息进行数据格式化。 如将字符串转换成格式化数字或格式化日期等</p>

<p>d) 数据验证： 验证数据的有效性（长度、格式等），验证结果存储到BindingResult或Error中</p>

<ol>
  <li>Handler执行完成后，向DispatcherServlet 返回一个ModelAndView对象。</li>
  <li>此时将开始执行拦截器的postHandle(…)方法【逆向】。</li>
  <li>根据返回的ModelAndView（此时会判断是否存在异常：如果存在异常，则执行HandlerExceptionResolver进行异常处理）选择一个适合的ViewResolver进行视图解析，根据Model和View，来渲染视图。</li>
  <li>渲染视图完毕执行拦截器的afterCompletion(…)方法【逆向】。</li>
  <li>将渲染结果返回给客户端。</li>
</ol>


                <hr style="visibility: hidden;">
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2019/11/03/Linux%E4%B8%AD%E5%AE%89%E8%A3%85Oracle12c/" data-toggle="tooltip" data-placement="top" title="centos安装oracle12c">
                        Previous<br>
                        <span>centos安装oracle12c</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2020/01/04/Java%E4%B9%8BNetty/" data-toggle="tooltip" data-placement="top" title="Netty">
                        Next<br>
                        <span>Netty</span>
                        </a>
                    </li>
                    
                </ul>
                <hr style="visibility: hidden;">

                <!-- Gitalk 评论 start  -->
                
                <!-- Link Gitalk 的支持文件  -->
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
                <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

                <div id="gitalk-container"></div>
                <script type="text/javascript">
                    var gitalk = new Gitalk({

                        // gitalk的主要参数
                        clientID: '2542452a44c3a8034a35',
                        clientSecret: '3119b189eb567a7a89c2440917078889d1689226',
                        repo: 'xprocon.github.io',
                        owner: 'xprocon',
                        admin: ['xprocon'],
                        id: 'post',
                        distractionFreeMode: true,  //是否启用评论全屏遮罩.
                        createIssueManually: true, //如果当前页面没有相应的 isssue ，且登录的用户属于 admin，则会自动创建 issue。如果设置为 true，则显示一个初始化页面，创建 issue 需要点击 init 按钮。
                        perPage: 15 //每页多少个评论
                    });
                    gitalk.render('gitalk-container');
                </script>
                
                <!-- Gitalk end -->

                

                
            </div>  

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                


<section>
    
        <hr class="hidden-sm hidden-xs">
    
    <h5><a href="/archive/">FEATURED TAGS</a></h5>
    <div class="tags">
        
        
        
        
        
        
                <a data-sort="0042" 
                    href="/archive/?tag=Java"
                    title="Java"
                    rel="6">Java</a>
        
                <a data-sort="0032" 
                    href="/archive/?tag=linux"
                    title="linux"
                    rel="16">linux</a>
        
                <a data-sort="0035" 
                    href="/archive/?tag=%E8%BF%90%E7%BB%B4"
                    title="运维"
                    rel="13">运维</a>
        
                <a data-sort="0036" 
                    href="/archive/?tag=%E5%AD%A6%E4%B9%A0"
                    title="学习"
                    rel="12">学习</a>
        
                <a data-sort="0037" 
                    href="/archive/?tag=java"
                    title="java"
                    rel="11">java</a>
        
                <a data-sort="0039" 
                    href="/archive/?tag=centos"
                    title="centos"
                    rel="9">centos</a>
        
                <a data-sort="0043" 
                    href="/archive/?tag=%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"
                    title="开发环境"
                    rel="5">开发环境</a>
        
                <a data-sort="0043" 
                    href="/archive/?tag=nginx"
                    title="nginx"
                    rel="5">nginx</a>
        
                <a data-sort="0044" 
                    href="/archive/?tag=%E5%AE%B9%E5%99%A8%E5%8C%96"
                    title="容器化"
                    rel="4">容器化</a>
        
                <a data-sort="0044" 
                    href="/archive/?tag=git"
                    title="git"
                    rel="4">git</a>
        
                <a data-sort="0044" 
                    href="/archive/?tag=spring"
                    title="spring"
                    rel="4">spring</a>
        
                <a data-sort="0045" 
                    href="/archive/?tag=%E4%BA%91%E5%8E%9F%E7%94%9F"
                    title="云原生"
                    rel="3">云原生</a>
        
                <a data-sort="0045" 
                    href="/archive/?tag=%E5%9F%BA%E7%A1%80"
                    title="基础"
                    rel="3">基础</a>
        
                <a data-sort="0045" 
                    href="/archive/?tag=jetbrains"
                    title="jetbrains"
                    rel="3">jetbrains</a>
        
                <a data-sort="0045" 
                    href="/archive/?tag=python"
                    title="python"
                    rel="3">python</a>
    </div>
</section>


                <!-- Friends Blog -->
                
<hr>
<h5>FRIENDS</h5>
<ul class="list-inline">
  
  <li><a href="https://www.baidu.com/">百度（baidu）</a></li>
  
  <li><a href="http://10.175.194.215:8080/">IT工具箱（ittools）</a></li>
  
  <li><a href="https://www.emojiall.com/zh-hans">emoji（emoji搜索）</a></li>
  
  <li><a href="https://www.v2ex.com/">v2ex（v2ex论坛）</a></li>
  
  <li><a href="https://www.reddit.com/r/China_irl/">reddit（流浪防区）</a></li>
  
</ul>

            </div>
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->









<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'right',
          // icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                


<ul class="list-inline text-center">


  
  
  <li>
    <a href="https://twitter.com/xprocon">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  <li>
    <a target="_blank" href="https://www.zhihu.com/people/procon">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa  fa-stack-1x fa-inverse">知</i>
      </span>
    </a>
  </li>
  
  
  <li>
    <a target="_blank" href="http://weibo.com/huangpuguang1ni">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  
  <li>
    <a target="_blank" href="https://github.com/xprocon">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
</ul>

                <p class="copyright text-muted">
                    Copyright &copy; Procon's Tech Life Blog 2024
                    <br>
                    Powered by <a href="https://blog.procon.cc">Procon Blog</a>
<!--                    <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="100px"-->
<!--                        height="20px"-->
<!--                        src="https://ghbtns.com/github-btn.html?user=huxpro&repo=huxpro.github.io&type=star&count=true">-->
<!--                    </iframe>-->
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>

<!-- Simple Jekyll Search -->
<script src="/js/simple-jekyll-search.min.js"></script>

<!-- Service Worker -->


<!-- async load function -->
<script>
    function async(u, c) {
        var d = document, t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
        s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->







<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function () {
        var $nav = document.querySelector("nav");
        if ($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->



<!-- Baidu Tongji -->



<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog(selector) {

        // interop with multilangual 
        if ('' == 'true') {
            _containerSelector = 'div.post-container.active'
        } else {
            _containerSelector = 'div.post-container'
        }

        // init
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        // clean
        $(selector).html('')

        // appending
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>



<!-- Multi-Lingual -->


<!-- Simple Jekyll Search -->
<script>
    // https://stackoverflow.com/questions/1912501/unescape-html-entities-in-javascript
    function htmlDecode(input) {
        var e = document.createElement('textarea');
        e.innerHTML = input;
        // handle case of empty input
        return e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
    }

    SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('search-results'),
        json: '/search.json',
        searchResultTemplate: '<div class="post-preview item"><a href="{url}"><h2 class="post-title">{title}</h2><h3 class="post-subtitle">{subtitle}</h3><hr></a></div>',
        noResultsText: 'No results',
        limit: 50,
        fuzzy: false,
        // a hack to get escaped subtitle unescaped. for some reason, 
        // post.subtitle w/o escape filter nuke entire search.
        templateMiddleware: function (prop, value, template) {
            if (prop === 'subtitle' || prop === 'title') {
                if (value.indexOf("code")) {
                    return htmlDecode(value);
                } else {
                    return value;
                }
            }
        }
    });

    $(document).ready(function () {
        var $searchPage = $('.search-page');
        var $searchOpen = $('.search-icon');
        var $searchClose = $('.search-icon-close');
        var $searchInput = $('#search-input');
        var $body = $('body');

        $searchOpen.on('click', function (e) {
            e.preventDefault();
            $searchPage.toggleClass('search-active');
            var prevClasses = $body.attr('class') || '';
            setTimeout(function () {
                $body.addClass('no-scroll');
            }, 400)

            if ($searchPage.hasClass('search-active')) {
                $searchClose.on('click', function (e) {
                    e.preventDefault();
                    $searchPage.removeClass('search-active');
                    $body.attr('class', prevClasses);  // from closure 
                });
                $searchInput.focus();
            }
        });
    });
</script>


<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
